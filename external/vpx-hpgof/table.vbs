'                                                                        `+ssyyyhhdddmmd:                                                             
'                                                                          `+MMMMMMNo++hMNo`                                                           
'                 `......--`                           `s-                  `NMMMMMN-  +MMMh.                    :/                                    
'                 -hNNNNNm+`               `/-       `+mM: `:.               hMMMMMN-  /MMMMm/                 .sNo      `:                            
'    `/yhhhhhy:    .MMMMMo               -smMo `:. `+mMMM+omMh`              oMMMMMN-  :NMMMMd               `omMMo     .yh                            
'     `+MMMMMs`    .MMMMM+    `-++`   `/hNMMMhsmNm-`yMMMMhmMMMo              :MMMMMN-  -NMMMMd             .omMMMMdoo` -dMd`                  -o` `-   
'      :MMMMMo     .MMMMM+ `:sdNMMd/  `-:dMMMmhMMMh`+MMMM::MMMN-             .NMMMMN:  -NMMMMh            :shdMMMMNyy-oNMMd`      .++-      -sNN+ymNo  
'      :MMMMMo     .MMMMM+ oNMMMMmNNy.   yMMMd-NMMM++MMMM:`mNy:`            ``dMMMMN:  .NMMMMs     `:oy+. ```:NMMMy`/dMMMMNdhh. -smsmNds: -sNMMMmNMMN+ 
'      :MMMMMo     .MMMMM+ :mMNy:`sMMm+  sMMMm.yMMd/+MMMM:-o-`      ./:::-  /dmMMMMN/.-/NMMMMo `-ohmdyNMms-  -NMMMs`-:dMMMN+:::yNMd -NMMN:-hMMMM:oMMMN/
'      :MMMMMo     .MMMMM+  -d/`  +MMMN: sMMMm.oy:` oMMMM:-:::::.   `yNNN:  -MMMMMMMmdydMMMMM+`hNMN//dMMMMm/ -NMMMo   hMMMN. `dMMMh  /NMMd`sMMMM:`dMMh.
'      :MMMMMo     .MMMMM+   .`   /MMMM+ sMMMN-``   oMMMM::NNMMm.   -mMM+   `NMMMMMMsdshMMMNhyhMMMNyyshMMMMy -NMMM+   hMMMN. `mMMMh-..oMMM+sMMMM:.hy:` 
'      :MMMMMo     .MMMMMy+ooosss/:MMMM+ oMMMN-     oMMMM:`dMMMM/  `hMMs`    dMMMMMM+-hmdyo-``:MMMN-  /MMMMh`-NMMM/   yMMMN- `mMMMdsyhdNNy.oMMMM/.-`   
'.:/-` :MMMMMo     -MMMMMmsosdMMs`:NMMMo oMMMM:     sMMMM: +MMMMh``yMMy`     yMMMMMM+ ```     :MMMN-  -NMMMd`-NMMM/   yMMMN- .NMMMo ``.--` oMMMM/      
'sN+`  :MMMMMo   -omMMMMMy oNMMM+ -NMMMo +MMMM/     sMMMM: .NMMMN:sMMh.      +MMMMMMo         :MMMN-  .NMMMd`-NMMM:   sMMMN- .NMMMs        +MMMM+      
'.sho-`:MMMMMs-+hNMNMMMMMs sMMMMs .NMMMo +MMMM+     sMMMM:  yMMMMmMMd.       -MMMMMMs         -MMMN-  .mMMMd`-NMMM-   sMMMN: -NMMMy   ..   +MMMM+      
' `-sdhhMMMMMNNNmh+-NMMMMs :NMMMh`.NMMMs +MMMMs     yMMMM/  :MMMMMMd-        `NMMMNdy         .MMMN-  `mMMMd`-NMMM-   oMMMM: -NMMMh   yd:  /MMMMo      
'    ./yMMMMMh/-.`  NMMMMs `hMMMm..NMMMm:+MMMMy`  `+hddddy. `dMMMMd-         `hMMMm-s`        `mMMN:  .mMMMd`-NMMM.   oMMMM/ `+mMMd` -NN/  /MMMMo      
'      :MMMMMo      NMMMMs  /MMMMhhMMMNs/ydddhy+`  ``   ``` `hMMMd-         `shMMMm`.`         .smMo` -mMMmo`-NMMM`   oMMMM/   .omNd/hd:   +MMMMs      
'      :MMMMMo      NMMMMs  `ymds//mmh- ```.--...          `sMMMd.           mMMMMm`             -odyyddy/.  -NMMM`   +MMMM/     -+ooo.  `:mMMMMd`     
'      :MMMMMo      NMMMMs   `.`   ..`    /dNmho:`         +MMMh.            yMMMMm.               .:/-`     `ymNN.   +MMMM/ ``````      -ohdmNNNy/-`  
'      :MMMMMo      NMMMMs               /NMMy.           /NMMh.             oMMMMm.                           .:ss/` .sdmNs.:/+yho.        `..-::/:-` 
'      :MMMMMo      NMMMMs               odNMyoo++//::---/NMMy`              :MMMMN.     -/``::`..-..:`           `-.   `./oss+omo`                    
'      /MMMMMo     `NMMMMs                `-+hmNNMMMMMMNNMMMy`               .NMMMN.      0000 0  0 000   0000 0  0 0000    
'    `+dNNNNNy.    :MMMMMy                    `-:/osyhdmmNNs`                `mMMMN.      0  0 00`0 0  0   00  0  0 0                          
'    `...---:/:`  -dMMMMMN:                            ``..                   hMN+s.    ``0000 0 00 0  0   00  0000 000                          
'                :hddhhhddd+`                                                 oMm`       .0  0`0 `0`000    00  0  0 0000            
'                         `.                                                  /Md                        
'                                                                             .Ny         XXX     GOBLET OF FIRE     XXX              
'                                                                             `mo                     
'                                                                              h+         -------  By ScottyWic   ------   
'                                                                              o:          
'                                                                              :.                       
''
Option Explicit
Randomize
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  Player Options
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X 

	'orbital scoreboard
	Dim osbactive:osbactive = 0 'set to 0 for off, 1 for only player 1 to be sent, 2 for all scores to be sent.
	Dim osbid:osbid ="" ' your orbital scoreboard login name
	Dim osbkey:osbkey="" ' your orbital scoreboard api key
	Dim osbdefinit:osbdefinit = "" ' your default initials to use 
	'standard player rules
	turnoffrules = 0 ' change to 1 to take off the backglass helper rules text during a game
	turnondmd = 2 ' 0 = off, 1=regular dmd size 2 = double tall size // this now uses pinup. No ultradmd anymore
	ballrolleron = 1 ' set to 0 to turn off the ball roller if you use the "c" key in your cabinet
	gibase = 60 'brightness of your gis
	dim vsvol: vsvol = 90 ' set the volume of the cinematic videos
	dim vovol: vovol = 80 ' set the volume of the voice over callouts
	Dim sndtrk:sndtrk = 1 ' 0 = British 90s Rock, 1 = Goblet of Fire Theatrical Score
	dim sndtrkvol:sndtrkvol = 90 ' set volume of sound track
	dim help:help = 1 ' switch to 0 to turn off the helpful callouts about rules
	Dim eyeFollowS : eyeFollowS=8  'ms timer interval of eye follow speed try 5-20 range
	dim nofunmode:nofunmode = 0 ' switch to 1 if you hate fun or just have a low end pc. it'll turn off the animations
	dim notinus : notinus = 0 ' set this if you're not from the USA and it'll make sure your backglass numbers have commas


'**************************
'   PinUp Player USER Config
'**************************
    dim usePuPDMD       : usePuPDMD=true       ' set to false to not use PuPDMD for a DMD (different that BG scoring)
	dim PuPDMDDriverType: PuPDMDDriverType=0   ' 0=LCD DMD, 1=RealDMD 2=FULLDMD (large/High LCD)
	dim useRealDMDScale : useRealDMDScale=0    ' 0 or 1 for RealDMD scaling.  Choose which one you prefer.
	dim useDMDVideos    : useDMDVideos=true   ' true or false to use DMD splash videos.
	Dim pGameName       : pGameName="hpgof"    'pupvideos foldername, probably set to cGameName in realworld


	dim dmdver : dmdver = PuPDMDDriverType
	if dmdver = 2 Then
	Else
		dmdver = 1
	end if

	dim dragonmod: dragonmod=1
	if nofunmode = 0 Then
		dragonmod = 1
	Else
		dragonmod = 0
	end if


'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  FRAMEWORK Options
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  

	Const typefont = "Dumbledor 1"
	Const numberfont = "Dumbledor 1"
	Const zoomfont = "Magic School One"
	Const zoombgfont = "Magic School One" ' needs to be an outline of the zoomfont
	Const cGameName = "hpgof"
	Const TableName = "hpgof"
	Const myVersion = "0.51"

	Dim songs
	If sndtrk = 1 Then
		songs = "audiobg"
	Else
		songs = "audiobgrock"
	End If


'********************************************************************************************************************************************
'********************************************************************************************************************************************
'********************************************************************************************************************************************
'********************************************************************************************************************************************
'********************************************************************************************************************************************
'FRAMEWORK BASE CODE STARTS HERE
'********************************************************************************************************************************************
'********************************************************************************************************************************************
'********************************************************************************************************************************************
'********************************************************************************************************************************************
'********************************************************************************************************************************************

'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  VARIABLES
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 	

	'Constructions
	Const BallSize = 50
	Const MaxPlayers = 4
	Const BallSaverTime = 15
	Const MaxMultiplier = 6 
	Const MaxMultiballs = 10
	Const bpgcurrent = 3  

	' Define Global Variables

	Dim turnondmd
	Dim toppervideo
	Dim ballrolleron
	Dim turnoffrules
	Dim PlayersPlayingGame
	Dim CurrentPlayer
	Dim Credits
	Dim gibase
	Dim BonusPoints(4)
	Dim BonusHeldPoints(4)
	Dim BonusMultiplier(4)
	Dim bBonusHeld
	Dim BallsRemaining(4)
	Dim ExtraBallsAwards(4)
	Dim Score(4)
	Dim HighScore(4)
	Dim HighScoreName(4)
	Dim WaffleScore(4)
	Dim WaffleScoreName(4)
	Dim Jackpot
	Dim SuperJackpot
	Dim Tilt
	Dim TiltSensitivity
	Dim Tilted
	Dim TotalGamesPlayed
	Dim mBalls2Eject
	Dim SkillshotValue
	Dim bAutoPlunger
	Dim bInstantInfo
	Dim bromconfig
	Dim bAttractMode
	Dim LastSwitchHit
	Dim BallsOnPlayfield
	Dim BallsInHole
	Dim bFreePlay
	Dim bGameInPlay
	Dim bOnTheFirstBall
	Dim bBallInPlungerLane
	Dim bBallSaverActive
	Dim bBallSaverReady
	Dim bMultiBallMode
	Dim bMusicOn
	Dim bSkillshotReady
	Dim bExtraBallWonThisBall
	Dim bJustStarted
	Dim bballfirstball

	LoadCoreFiles
	Sub LoadCoreFiles
		On Error Resume Next
		ExecuteGlobal GetTextFile("core.vbs")
		If Err Then MsgBox "Can't open core.vbs"
		On Error Goto 0
	End Sub

	Dim EnableBallControl
	EnableBallControl = false 'Change to true to enable manual ball control (or press C in-game) via the arrow keys and B (boost movement) keys

	Sub table1_Exit
		Controller.stop
	End Sub

'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  Controller VBS stuff, but with b2s not started
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'***Controller.vbs version 1.2***'
'

Const directory = "HKEY_CURRENT_USER\SOFTWARE\Visual Pinball\Controller\"
Dim objShell
Dim PopupMessage
Dim B2SController
Dim Controller
Const DOFContactors = 1
Const DOFKnocker = 2
Const DOFChimes = 3
Const DOFBell = 4
Const DOFGear = 5
Const DOFShaker = 6
Const DOFFlippers = 7
Const DOFTargets = 8
Const DOFDropTargets = 9
Const DOFOff = 0
Const DOFOn = 1
Const DOFPulse = 2

Dim DOFeffects(9)
Dim B2SOn
Dim B2SOnALT

Sub LoadEM
	LoadController("EM")
End Sub

Sub LoadPROC(VPMver, VBSfile, VBSver)
	LoadVBSFiles VPMver, VBSfile, VBSver
	LoadController("PROC")
End Sub

Sub LoadVPM(VPMver, VBSfile, VBSver)
	LoadVBSFiles VPMver, VBSfile, VBSver
	LoadController("VPM")
End Sub

Sub LoadVPMALT(VPMver, VBSfile, VBSver)
	LoadVBSFiles VPMver, VBSfile, VBSver
	LoadController("VPMALT")
End Sub

Sub LoadVBSFiles(VPMver, VBSfile, VBSver)
	On Error Resume Next
	If ScriptEngineMajorVersion < 5 Then MsgBox "VB Script Engine 5.0 or higher required"
	ExecuteGlobal GetTextFile(VBSfile)
	If Err Then MsgBox "Unable to open " & VBSfile & ". Ensure that it is in the same folder as this table. " & vbNewLine & Err.Description	
	InitializeOptions
End Sub

Sub LoadVPinMAME
	Set Controller = CreateObject("VPinMAME.Controller")
	If Err Then MsgBox "Can't load VPinMAME." & vbNewLine & Err.Description
	If VPMver > "" Then If Controller.Version < VPMver Or Err Then MsgBox "VPinMAME ver " & VPMver & " required."
	If VPinMAMEDriverVer < VBSver Or Err Then MsgBox VBSFile & " ver " & VBSver & " or higher required."
	On Error Goto 0
End Sub

Sub LoadController(TableType)
	Dim FileObj
	Dim DOFConfig
	Dim TextStr2
	Dim tempC
	Dim count
	Dim ISDOF
	Dim Answer
	
	B2SOn = False
	B2SOnALT = False
	tempC = 0
	on error resume next
	tempC = 0 'objShell.RegRead(directory & "ForceDisableB2S")
	DOFeffects(1)=2 'objShell.RegRead(directory & "DOFContactors")
	DOFeffects(2)=2 'objShell.RegRead(directory & "DOFKnocker")
	DOFeffects(3)=2 'objShell.RegRead(directory & "DOFChimes")
	DOFeffects(4)=2 'objShell.RegRead(directory & "DOFBell")
	DOFeffects(5)=2 'objShell.RegRead(directory & "DOFGear")
	DOFeffects(6)=2 'objShell.RegRead(directory & "DOFShaker")
	DOFeffects(7)=2 'objShell.RegRead(directory & "DOFFlippers")
	DOFeffects(8)=2 'objShell.RegRead(directory & "DOFTargets")
	DOFeffects(9)=2 'objShell.RegRead(directory & "DOFDropTargets")

	If TableType = "PROC" or TableType = "VPMALT" Then
		If TableType = "PROC" Then
			Set Controller = CreateObject("VPROC.Controller")
			If Err Then MsgBox "Can't load PROC"
		Else
			LoadVPinMAME
		End If		
		If tempC = 0 Then
			On Error Resume Next
			If Controller is Nothing Then
				Err.Clear
			Else
				Set B2SController = CreateObject("B2S.Server")
				If B2SController is Nothing Then
					Err.Clear
				Else
					B2SController.B2SName = B2ScGameName
					B2SController.Run()
					On Error Goto 0
					B2SOn = True
					B2SOnALT = True
				End If
			End If
		End If
	Else
		If tempC = 0 Then
			On Error Resume Next
			Set Controller = CreateObject("B2S.Server")
			If Controller is Nothing Then
				Err.Clear
				If TableType = "VPM" Then 
					LoadVPinMAME
				End If
			Else
				Controller.B2SName = cGameName
				If TableType = "EM" Then
					Controller.Run()
				End If
				On Error Goto 0
				B2SOn = True
			End If
		Else
			If TableType = "VPM" Then 
				LoadVPinMAME
			End If
		End If
		Set DOFConfig=Nothing
		Set FileObj=Nothing
	End If
End sub

Function SoundFX (Sound, Effect)
	If ((Effect = 0 And B2SOn) Or DOFeffects(Effect)=1) Then
		SoundFX = ""
	Else
		SoundFX = Sound
	End If
End Function

Function SoundFXDOF (Sound, DOFevent, State, Effect)
	If DOFeffects(Effect)=1 Then
		SoundFXDOF = ""
		DOF DOFevent, State
	ElseIf DOFeffects(Effect)=2 Then
		SoundFXDOF = Sound
		DOF DOFevent, State
	Else
		SoundFXDOF = Sound
	End If
End Function

Function SoundFXDOFALT (Sound, DOFevent, State, Effect)
	If DOFeffects(Effect)=1 Then
		SoundFXDOFALT = ""
		DOFALT DOFevent, State
	ElseIf DOFeffects(Effect)=2 Then
		SoundFXDOFALT = Sound
		DOFALT DOFevent, State
	Else
		SoundFXDOFALT = Sound
	End If
End Function


Sub DOF(DOFevent, State)
	If B2SOn Then
		If State = 2 Then
			Controller.B2SSetData DOFevent, 1:Controller.B2SSetData DOFevent, 0
		Else
			Controller.B2SSetData DOFevent, State
		End If
	End If
End Sub

Sub DOFALT(DOFevent, State)
	If B2SOnALT Then
		If State = 2 Then
			B2SController.B2SSetData DOFevent, 1:B2SController.B2SSetData DOFevent, 0
		Else
			B2SController.B2SSetData DOFevent, State
		End If
	End If
End Sub




'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'   TABLE INITS & MATHS
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  


	Sub Table1_Init()
		if notinus = 1 then
			setlocale(1033)
		end If
		resetbackglass
		LoadEM
		Dim i
		Randomize
		Loadhs
		bAttractMode = False
		bOnTheFirstBall = False
		bBallInPlungerLane = False
		bBallSaverActive = False
		bBallSaverReady = False
		bMultiBallMode = False
		bGameInPlay = False
		bAutoPlunger = False
		bMusicOn = True
		BallsOnPlayfield = 0
		BallsInHole = 0
		LastSwitchHit = ""
		Tilt = 0
		TiltSensitivity = 6
		Tilted = False
		bBonusHeld = False
		bJustStarted = True
		GiOff
		'PuPlayer.SendMSG "{ ""mt"":301, ""SN"": 2, ""FN"":4, ""FS"":1 }"
	    if usePUPDMD Then 
			PUPInit
		Else 
			pupDMDupdate.enabled=0  'init pupdmd driver
        End if
		StartAttractMode
	End Sub


	'********************
	' MATHS
	'********************

	Function RndNum(min,max)
	 RndNum = Int(Rnd()*(max-min+1))+min     ' Sets a random number between min AND max
	End Function


		Dim BIP
		BIP = 0







'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'   KEYS
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  


	dim quickrestart:quickrestart=0

	Sub Table1_KeyDown(ByVal Keycode)

		If keycode = PlungerKey Then
			PlaySoundAt "fx_plungerpull", Plunger
			Plunger.Pullback
		End If

		If hsbModeActive = True Then
			EnterHighScoreKey(keycode)
		elseif bGameInPlay Then
			If keycode = LeftTiltKey Then Nudge 90, 6:PlaySound SoundFX("fx_nudge",0), 0, 1, -0.1, 0.25:CheckTilt
			If keycode = RightTiltKey Then Nudge 270, 6:PlaySound SoundFX("fx_nudge",0), 0, 1, 0.1, 0.25:CheckTilt
			If keycode = CenterTiltKey Then Nudge 0, 7:PlaySound SoundFX("fx_nudge",0), 0, 1, 1, 0.25:CheckTilt

			If NOT Tilted Then
				If keycode = LeftFlipperKey Then
						if retimct=1 Then
						retimct=0:pupDMDDisplay "-","Quick Restart^Cancelled",dmdnote,3,0,30
						end if
					if PuPGameRunning Then
						PuPGameInfo= PuPlayer.GameUpdate("PupMiniGame", 1 , 83 , "")  'w
					Else
						LeftFlipper.RotateToEnd:LeftFlipper1.RotateToEnd
						if confus = 1 Then
							RightFlipper.RotateToEnd
						end if
						ldown = 1
						checkdown
						movelanesleft
						PlaySound SoundFX("flipup2",DOFFlippers), 0, .67, AudioPan(LeftFlipper), 0.05,0,0,1,AudioFade(LeftFlipper)
						DOF 101, DOFOn
					end if
				End If
				If keycode = RightFlipperKey Then
						if retimct=1 Then
						retimct=0:pupDMDDisplay "-","Quick Restart^Cancelled",dmdnote,3,0,30
						end if
					if PuPGameRunning Then
						PuPGameInfo= PuPlayer.GameUpdate("PupMiniGame", 1 , 87 , "")  'w
					Else
						RightFlipper.RotateToEnd
						if confus = 1 Then
							LeftFlipper.RotateToEnd:LeftFlipper1.RotateToEnd
						end if
						rdown = 1
						checkdown
						movelanesright
						PlaySound SoundFX("flipup2",DOFFlippers), 0, .67, AudioPan(RightFlipper), 0.05,0,0,1,AudioFade(RightFlipper)
						DOF 102, DOFOn
					end if
				End If

				If keycode = StartGameKey Then

					if canstart = 1 then exit sub

					If (bOnTheFirstBall = false) Then
						if retimct=1 Then
						endthisgame
						end if
						if retimct=0 Then
						wanttoend
						end if
					End if

					If((PlayersPlayingGame <MaxPlayers) AND(bOnTheFirstBall = True) ) Then
							PlayersPlayingGame = PlayersPlayingGame + 1
							If PlayersPlayingGame = 1 Then
							playmedia "player1.wav","audiocallouts",pCallouts,"",1000,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
							'pupDMDDisplay "-","Player^One",dmdnote,3,0,10
					End If

					If PlayersPlayingGame = 2 Then
						PuPlayer.LabelSet pBackglass,"Play2","PLAYER 2",1,"{'mt':2}"
						pUpdateScores
						playmedia "player2.wav","audiocallouts",pCallouts,"",1000,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
						'pupDMDDisplay "-","Player^Two",dmdnote,3,0,10
					End If

					If PlayersPlayingGame = 3 Then
						PuPlayer.LabelSet pBackglass,"Play3","PLAYER 3",1,"{'mt':2}"
						pUpdateScores
						playmedia "player3.wav","audiocallouts",pCallouts,"",1000,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
						'pupDMDDisplay "-","Player^Three",dmdnote,3,0,10
					End If

					If PlayersPlayingGame = 4 Then
						PuPlayer.LabelSet pBackglass,"Play4","PLAYER 4",1,"{'mt':2}"
						pUpdateScores	
						playmedia "player4.wav","audiocallouts",pCallouts,"",1000,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
						'pupDMDDisplay "-","Player^Four",dmdnote,3,0,10
					End If

					TotalGamesPlayed = TotalGamesPlayed + 1
					savegp
				End If
			End If
		End If
			Else
			If NOT Tilted Then

				If keycode = LeftFlipperKey Then helptime.enabled = true:DMDintroloop:introtime = 0
				If keycode = RightFlipperKey Then helptime.enabled = true:DMDintroloop:introtime = 0
				If keycode = StartGameKey Then
					if bAttractMode = false Then
						pupDMDDisplay "-","Please Wait^Game Resetting",dmdnote,3,0,10
						pNote "Please wait","game resetting"
					else
						ResetForNewGame()
					end if 
				End If
			End If
			End If 
	End Sub


	dim retimct:retimct=0
	sub wanttoend
		retimct = 1
		pupDMDDisplay "-","start to restart^flipper to cancel",dmdnote,3,0,20
		pNote "start to resart","flip to cancel"
	end Sub

	sub endthisgame
		EndOfGame()
		StartAttractMode
		canstart=1
		retimct=0
		vpmtimer.addtimer 4000, "startagain '"
		pupDMDDisplay "-","Quick Restart^Wait 4 Secs",dmdnote,3,0,10
			Plunger.Pullback
			vpmtimer.addtimer 200, "fireit '"
	end Sub

	dim canstart:canstart=0
	sub startagain
		canstart=0
	end Sub

	Sub Table1_KeyUp(ByVal keycode)


		If keycode = PlungerKey Then
			PlaySoundAt "fx_launchball", Plunger
			PlaySoundAt "fx_plunger", Plunger
			Plunger.Fire
		End If

		' Table specific

		If bGameInPLay and hsbModeActive <> True Then

			If keycode = LeftFlipperKey Then
				if PuPGameRunning Then
					PuPGameInfo= PuPlayer.GameUpdate("PupMiniGame", 2 , 83 , "")  'w
				else
					ldown = 0
					LeftFlipper.RotateToStart:LeftFlipper1.RotateToStart
					if confus = 1 Then
						RightFlipper.RotateToStart
					end if
					DOF 101, DOFOff
					PlaySound SoundFX("flipdown",DOFFlippers), 0, 1, AudioPan(LeftFlipper), 0.05,0,0,1,AudioFade(LeftFlipper)
				end if
			End If
			If keycode = RightFlipperKey Then
				if PuPGameRunning Then
					PuPGameInfo= PuPlayer.GameUpdate("PupMiniGame", 2 , 87 , "")  'w
				Else
					rdown = 0
					RightFlipper.RotateToStart
					if confus = 1 Then
					LeftFlipper.RotateToStart:LeftFlipper1.RotateToStart
					end if
					DOF 102, DOFOff
					PlaySound SoundFX("flipdown",DOFFlippers), 0, 1, AudioPan(RightFlipper), 0.05,0,0,1,AudioFade(RightFlipper)
				end if
			End If
		Else
			If keycode = LeftFlipperKey Then helptime.enabled = false
			If keycode = RightFlipperKey Then helptime.enabled = false
		End If

	End Sub








'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'   SHADOWS
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  


	'*****************************************
	'	ninuzzu's	FLIPPER SHADOWS
	'*****************************************

	sub FlipperTimer_Timer()
		FlipperLSh.RotZ = LeftFlipper.currentangle
		FlipperRSh.RotZ = RightFlipper.currentangle
		'FlipperLSh1.RotZ = LeftFlipper1.currentangle

	End Sub

	'*****************************************
	'	ninuzzu's	BALL SHADOW
	'*****************************************
	Dim BallShadow
	BallShadow = Array (BallShadow1,BallShadow2,BallShadow3,BallShadow4,BallShadow5,BallShadow6,BallShadow7,BallShadow8,BallShadow9,BallShadow10)

	Sub BallShadowUpdate_timer()
		Dim BOT, b
		BOT = GetBalls
		' hide shadow of deleted balls
		If UBound(BOT)<(tnob-1) Then
			For b = (UBound(BOT) + 1) to (tnob-1)
				BallShadow(b).visible = 0
			Next
		End If
		' exit the Sub if no balls on the table
		If UBound(BOT) = -1 Then Exit Sub
		' render the shadow for each ball
		For b = 0 to UBound(BOT)
			If BOT(b).X < Table1.Width/2 Then
				BallShadow(b).X = ((BOT(b).X) - (Ballsize/6) + ((BOT(b).X - (Table1.Width/2))/7)) + 6
			Else
				BallShadow(b).X = ((BOT(b).X) + (Ballsize/6) + ((BOT(b).X - (Table1.Width/2))/7)) - 6
			End If
			ballShadow(b).Y = BOT(b).Y + 12
			If BOT(b).Z > 20 Then
				BallShadow(b).visible = 1
			Else
				BallShadow(b).visible = 0
			End If
		Next
	End Sub


'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'   TILT
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  


	'NOTE: The TiltDecreaseTimer Subtracts .01 from the "Tilt" variable every round

	Sub CheckTilt                                    'Called when table is nudged
		Tilt = Tilt + TiltSensitivity                'Add to tilt count
		TiltDecreaseTimer.Enabled = True
		If(Tilt> TiltSensitivity) AND(Tilt <15) Then 'show a warning
			pNote "CAREFUL!","TILT WARNING"
			pupDMDDisplay "-","Tilt^Warning!",dmdnote,3,0,10
				'PlaySound "buzz"
			PuPlayer.playlistplayex pBackglass,"videotilt","",100,1
			DOF 311, DOFPulse  'DOF MX - Tilt Warning
		End if
		If Tilt> 15 Then 'If more that 15 then TILT the table
			Tilted = True
			pNote "TILT",""
			pupDMDDisplay "-","TILT^TILT",dmdnote,3,0,10
				'PlaySound "powerdownn"
			playmedia "brilliant that makes me feel loads better.mp4","videodrains",pBackglass,"",3000,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			DOF 310, DOFPulse   'DOF MX - TILT
			DisableTable True
			tilttableclear.enabled = true
			TiltRecoveryTimer.Enabled = True 'start the Tilt delay to check for all the balls to be drained
		End If
	End Sub

	Dim tilttime:tilttime = 0

	sub tilttableclear_timer
		tilttime = tilttime + 1
		Select Case tilttime
			Case 10
				tableclearing
		End Select
	End Sub

	Sub tableclearing

	End Sub

	Sub posttiltreset

	End Sub

	Sub TiltDecreaseTimer_Timer
		' DecreaseTilt
		If Tilt> 0 Then
			Tilt = Tilt - 0.1
		Else
			TiltDecreaseTimer.Enabled = False
		End If
	End Sub

	Sub DisableTable(Enabled)
		If Enabled Then
			GiOff
			LightSeqTilt.Play SeqAllOff
			LeftFlipper.RotateToStart
			LeftFlipper1.RotateToStart
			RightFlipper.RotateToStart
			LeftSlingshot.Disabled = 1
			RightSlingshot.Disabled = 1
			'PuPlayer.playresume 4
			'playbgaudio
			playclear pMusic
		Else
			GiOn
			spotson
			LightSeqTilt.StopPlay
			LeftSlingshot.Disabled = 0
			RightSlingshot.Disabled = 0
		End If
	End Sub

	Sub TiltRecoveryTimer_Timer()
		If(BallsOnPlayfield = 0) Then
			EndOfBall()
			TiltRecoveryTimer.Enabled = False
		End If
	End Sub



'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'   SOUND FUNCTIONS
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  


	'*********************************************************************
	'                 Positional Sound Playback Functions
	'*********************************************************************

	' Play a sound, depending on the X,Y position of the table element (especially cool for surround speaker setups, otherwise stereo panning only)
	' parameters (defaults): loopcount (1), volume (1), randompitch (0), pitch (0), useexisting (0), restart (1))
	' Note that this will not work (currently) for walls/slingshots as these do not feature a simple, single X,Y position
	Sub PlayXYSound(soundname, tableobj, loopcount, volume, randompitch, pitch, useexisting, restart)
		PlaySound soundname, loopcount, volume, AudioPan(tableobj), randompitch, pitch, useexisting, restart, AudioFade(tableobj)
	End Sub

	' Similar subroutines that are less complicated to use (e.g. simply use standard parameters for the PlaySound call)
	Sub PlaySoundAt(soundname, tableobj)
		PlaySound soundname, 1, 1, AudioPan(tableobj), 0,0,0, 1, AudioFade(tableobj)
	End Sub

	Sub PlaySoundAtBall(soundname)
		PlaySoundAt soundname, ActiveBall
	End Sub


	'*********************************************************************
	'                     Supporting Ball & Sound Functions
	'*********************************************************************

	Function AudioFade(tableobj) ' Fades between front and back of the table (for surround systems or 2x2 speakers, etc), depending on the Y position on the table. "table1" is the name of the table
		Dim tmp
		tmp = tableobj.y * 2 / table1.height-1
		If tmp > 0 Then
			AudioFade = Csng(tmp ^10)
		Else
			AudioFade = Csng(-((- tmp) ^10) )
		End If
	End Function

	Function AudioPan(tableobj) ' Calculates the pan for a tableobj based on the X position on the table. "table1" is the name of the table
		Dim tmp
		tmp = tableobj.x * 2 / table1.width-1
		If tmp > 0 Then
			AudioPan = Csng(tmp ^10)
		Else
			AudioPan = Csng(-((- tmp) ^10) )
		End If
	End Function

	Function Vol(ball) ' Calculates the Volume of the sound based on the ball speed
		Vol = Csng(BallVel(ball) ^2 / 2000)
	End Function

	Function Pitch(ball) ' Calculates the pitch of the sound based on the ball speed
		Pitch = BallVel(ball) * 20
	End Function

	Function BallVel(ball) 'Calculates the ball speed
		BallVel = INT(SQR((ball.VelX ^2) + (ball.VelY ^2) ) )
	End Function

	Function Pan(ball) ' Calculates the pan for a ball based on the X position on the table. "table1" is the name of the table
		Dim tmp
		tmp = ball.x * 2 / table1.width-1
		If tmp> 0 Then
			Pan = Csng(tmp ^10)
		Else
			Pan = Csng(-((- tmp) ^10) )
		End If
	End Function



	'*****************************************
	'      JP's VP10 Rolling Sounds
	'*****************************************

	Const tnob = 10 ' total number of balls
	ReDim rolling(tnob)
	InitRolling

	Sub InitRolling
		Dim i
		For i = 0 to tnob
			rolling(i) = False
		Next
	End Sub

	Sub RollingTimer_Timer()
		Dim BOT, b
		BOT = GetBalls
		dim fball:fball=false

		' stop the sound of deleted balls
		For b = UBound(BOT) + 1 to tnob
			rolling(b) = False
			StopSound("fx_ballrolling" & b)
		Next

		' exit the sub if no balls on the table
		If UBound(BOT) = -1 Then Exit Sub

		' play the rolling sound for each ball
		For b = 0 to UBound(BOT)
            If BallVel(BOT(b) ) > 1  Then 'grab first moving ball as tracking ball.
                if fball=false Then                
                   curBallX = BOT(b).x
  	               curBallY = BOT(b).y 
                   checkeyeball       		       
                   fball=true
                End If
            End If

			If BallVel(BOT(b) ) > 1 AND BOT(b).z < 30 Then
				rolling(b) = True
				PlaySound("fx_ballrolling" & b), -1, Vol(BOT(b)), AudioPan(BOT(b)), 0, Pitch(BOT(b)), 1, 0, AudioFade(BOT(b))
			Else
				If rolling(b) = True Then
					StopSound("fx_ballrolling" & b)
					rolling(b) = False
				End If
			End If

		' Ball can "rest" on the ramps, lets try to nudge it off.
		' dead spot right between x 530.5 y 225.5 & x 554.4 y 213.4
		' dead spot left between x 248.5 y 243.5 & x 186.5 y 245.5
		if BOT(b).Y > 200 and BOT(b).Y < 260 and BallVel(BOT(b)) < .01 Then
			'spot right
			if Bot(B).X > 450 and Bot(B).X < 590 then
				debug.print "tried right"
				BOT(b).VelX = -1
				BOT(b).VelY = -1
			end if
			'spot left
			if Bot(B).X > 180 and Bot(B).X < 250 then
				debug.print "tried left"
				BOT(b).VelX = 1
				BOT(b).VelY = 1
			end if 
		end if

		'harry on broom
		If broomdone = 0 Then
			if BOT(b).X > 1030 and BOT(b).Y > 648 Then
				If BOT(b).Y <= 649 Then
					hbreturn.enabled = 1
					broomdone = 1
				Else
					harrybroom.Y = BOT(b).Y
				End If
			
			end If
		end If


		Next

	End Sub


sub ballonem_timer
		Dim BOTT
		BOTT = GetBalls
		'debug.print UBound(BOTT)
end sub


	'**********************
	' Ball Collision Sound
	'**********************

	Sub OnBallBallCollision(ball1, ball2, velocity)
		PlaySound("fx_collide"), 0, Csng(velocity) ^2 / 2000, AudioPan(ball1), 0, Pitch(ball1), 0, 0, AudioFade(ball1)
	End Sub

	'**************************************
	' Explanation of the collision routine
	'**************************************

	' The collision is built in VP.
	' You only need to add a Sub OnBallBallCollision(ball1, ball2, velocity) and when two balls collide they 
	' will call this routine. What you add in the sub is up to you. As an example is a simple Playsound with volume and paning
	' depending of the speed of the collision.


	Sub Pins_Hit (idx)
		PlaySound "pinhit_low", 0, Vol(ActiveBall), AudioPan(ActiveBall), 0, Pitch(ActiveBall), 0, 0, AudioFade(ActiveBall)
	End Sub

	Sub triggers_Hit (idx)
		'debug.print "triggers"
		PlaySound "rollover", 0, Vol(ActiveBall), AudioPan(ActiveBall), 0, Pitch(ActiveBall), 0, 0, AudioFade(ActiveBall)
	End Sub

	Sub Targets_Hit (idx)
		PlaySound "fx_target", 0, Vol(ActiveBall), AudioPan(ActiveBall), 0, Pitch(ActiveBall), 0, 0, AudioFade(ActiveBall)
	End Sub

	Sub Metals_Thin_Hit (idx)
		PlaySound "metalhit_thin", 0, Vol(ActiveBall), AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
	End Sub

	Sub Metals_Medium_Hit (idx)
		PlaySound "metalhit_medium", 0, Vol(ActiveBall), AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
	End Sub

	Sub Metals2_Hit (idx)
		PlaySound "metalhit2", 0, Vol(ActiveBall), AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
	End Sub

	Sub Gates_Hit (idx)
		PlaySound "gate4", 0, Vol(ActiveBall), AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
	End Sub

	Sub Spinner_Spin
		PlaySound "fx_spinner", 0, .25, AudioPan(Spinner), 0.25, 0, 0, 1, AudioFade(Spinner)
	End Sub

	Sub Rubbers_Hit(idx)
		'debug.print "rubber"
		dim finalspeed
		finalspeed=SQR(activeball.velx * activeball.velx + activeball.vely * activeball.vely)
		If finalspeed > 20 then 
			PlaySound "rubberloud", 0, Vol(ActiveBall), AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		End if
		If finalspeed >= 6 AND finalspeed <= 20 then
			RandomSoundRubber()
		End If
	End Sub

	Sub Posts_Hit(idx)
		dim finalspeed
		finalspeed=SQR(activeball.velx * activeball.velx + activeball.vely * activeball.vely)
		If finalspeed > 16 then 
			PlaySound "rubberloud", 0, Vol(ActiveBall), AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		End if
		If finalspeed >= 6 AND finalspeed <= 16 then
			RandomSoundRubber()
		End If
	End Sub

	Sub RandomSoundRubber()
		Select Case Int(Rnd*3)+1
			Case 1 : PlaySound "rubber_hit_1", 0, Vol(ActiveBall), AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
			Case 2 : PlaySound "rubber_hit_2", 0, Vol(ActiveBall), AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
			Case 3 : PlaySound "rubber_hit_3", 0, Vol(ActiveBall), AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		End Select
	End Sub

	Sub LeftFlipper_Collide(parm)
		RandomSoundFlipper()
	End Sub

	Sub RightFlipper_Collide(parm)
		RandomSoundFlipper()
	End Sub

	Sub RandomSoundFlipper()
		Select Case Int(Rnd*3)+1
			Case 1 : PlaySound "flip_hit_1", 0, Vol(ActiveBall), AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
			Case 2 : PlaySound "flip_hit_2", 0, Vol(ActiveBall), AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
			Case 3 : PlaySound "flip_hit_3", 0, Vol(ActiveBall), AudioPan(ActiveBall), 0, Pitch(ActiveBall), 1, 0, AudioFade(ActiveBall)
		End Select
	End Sub

	Dim NextOrbitHit:NextOrbitHit = 0

	Sub PlasticRampBumps_Hit(idx)
		'debug.print "plasticrampbump"
		if BallVel(ActiveBall) > .3 and Timer > NextOrbitHit then
			RandomBump 10, -20000
			' Schedule the next possible sound time.  This prevents it from rapid-firing noises too much. 
			' Lowering these numbers allow more closely-spaced clunks.
			NextOrbitHit = Timer + .1 + (Rnd * .2)
		end if 
	End Sub

	Sub PlasticBumps_Hit(idx)
		'debug.print "plasticbump"
		PlaySoundAtBall "fx_plastichit"
	End Sub

	Sub MetalWallBumps_Hit(idx)
		'debug.print "MetalWall"
		if BallVel(ActiveBall) > .3 and Timer > NextOrbitHit then
			RandomBump 3, 20000 'Increased pitch to simulate metal wall
			' Schedule the next possible sound time.  This prevents it from rapid-firing noises too much. 
			' Lowering these numbers allow more closely-spaced clunks.
			NextOrbitHit = Timer + .2 + (Rnd * .2)
		end if 
	End Sub

	Sub WireRampBumps_Hit(idx)
		'debug.print "wirebump"
		if BallVel(ActiveBall) > .3 and Timer > NextOrbitHit then
			dim BumpSnd:BumpSnd= "wirerampbump" & CStr(Int(Rnd*5)+1)
			PlaySound BumpSnd, 0, Vol(ActiveBall) * .5, Pan(ActiveBall), 0, 30000, 0, 1, AudioFade(ActiveBall)
			NextOrbitHit = Timer + .2 + (Rnd * .2)
		end if 
	End Sub

	Sub RandomBump(voladj, freq)
		'debug.print "randombump"
		dim BumpSnd:BumpSnd= "rampbump" & CStr(Int(Rnd*7)+1)
		PlaySound BumpSnd, 0, Vol(ActiveBall)*voladj, Pan(ActiveBall), 0, freq, 0, 1, AudioFade(ActiveBall)
	End Sub

	' Requires rampbump1 to 7 in Sound Manager
	Sub RandomBump(voladj, freq)
		dim BumpSnd:BumpSnd= "rampbump" & CStr(Int(Rnd*7)+1)
		PlaySound BumpSnd, 0, Vol(ActiveBall)*voladj, Pan(ActiveBall), 0, freq, 0, 1, AudioFade(ActiveBall)
	End Sub

	

	' Stop Bump Sounds
	Sub BumpSTOPMetal ()
		'debug.print "bumpstopmetal"
	dim i:for i=1 to 7:StopSound "RampBump" & i:next
	NextOrbitHit = Timer + 1
	End Sub

	Sub BumpSTOPWire ()
		'debug.print "bumpstopwire"
	dim i:for i=1 to 4:StopSound "WireRampBump" & i:next
	NextOrbitHit = Timer + 1
	End Sub






'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'   START GAME, END GANE
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  

'
	Sub ResetForNewGame()
		Dim i
		bGameInPLay = True
		StopAttractMode
		GiOn
		spotson
		TotalGamesPlayed = TotalGamesPlayed + 1
		savegp
		CurrentPlayer = 1
		PlayersPlayingGame = 1
		BallsOnPlayfield = 0
		bOnTheFirstBall = True
		For i = 1 To MaxPlayers
			Score(i) = 0
			BonusPoints(i) = 0
			BonusHeldPoints(i) = 0
			BonusMultiplier(i) = 1
			BallsRemaining(i) = 3
			ExtraBallsAwards(i) = 0
		Next
		Tilt = 0
		Game_Init()
		pDMDStartGame
		vpmtimer.addtimer 1500, "FirstBall '"
	End Sub


	Sub EndOfGame()
		LeftFlipper.RotateToStart:LeftFlipper1.RotateToStart:RightFlipper.RotateToStart
		closemaze
		playclear pMusic
		pNote "GAME OVER","PLAY AGAIN"
		'pupDMDDisplay "-","Game Over^Play Again",dmdnote,3,0,10
			PuPlayer.LabelSet pBackglass,"HighScore","",1,""
			PuPlayer.LabelSet pBackglass,"HighScoreL1","",1,""
			PuPlayer.LabelSet pBackglass,"HighScoreL2","",1,""
			PuPlayer.LabelSet pBackglass,"HighScoreL3","",1,""
			PuPlayer.LabelSet pBackglass,"high1name","",1,""
			PuPlayer.LabelSet pBackglass,"high1score","",1,""
			PuPlayer.LabelSet pBackglass,"high2name","",1,""
			PuPlayer.LabelSet pBackglass,"high2score","",1,""
			PuPlayer.LabelSet pBackglass,"high3name","",1,""
			PuPlayer.LabelSet pBackglass,"high3score","",1,""
			PuPlayer.LabelSet pBackglass,"high4name","",1,""
			PuPlayer.LabelSet pBackglass,"high4score","",1,""
		emptymerlocks
		'bAttractMode = True
		'PuPlayer.playlistplayex pBackglass,"videogo","",vsvol,1
		gameovervids
		pDMDGameOver
		'pupDMDDisplay "attract","","intro" & dmdver &".mp4",71,0,1
		'StartAttractMode
		introposition = 0
		bGameInPLay = False
		bJustStarted = False
		hsbModeActive = False
		'pDMDStartGame
		Dim i
		GiOff
		helpful.enabled = 0
		GetScores
	End Sub

	sub gameovervids
		GiOff
		StartLightSeq
		cineon = 1
		StartRainbow alights
		StartRainbow2 GI
		DMDattract.Enabled = 1
		'bAttractMode = True
		dim govdnum:govdnum=RndNum(1,2)
		select case govdnum
			case 1
				playmedia "dark and difficult times lie ahead.mp4","videogo",pBackglass,"",0,"",1,9
				vpmtimer.addtimer 26000, "StartAttractMode() '"
			case 2
				playmedia "everythings gonna change now isnt it.mp4","videogo",pBackglass,"",0,"",1,9
				vpmtimer.addtimer 14000, "StartAttractMode() '"
		end Select
	end Sub


'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'   Pinup Active Backglass
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  

'**************************
'   PinUp Player Config
'   Change HasPuP = True if using PinUp Player Videos
'**************************

	Dim HasPup:HasPuP = True

	Dim PuPlayer

	Const pTopper=0
	Const pDMD=1
	Const pBackglass=2
	Const pPlayfield=3
	Const pMusic=4
	Const pAudio=6
	Const pAudio2=7
	Const pCallouts=8
	Const pOvervid=14

	if HasPuP Then
	on error resume next
	Set PuPlayer = CreateObject("PinUpPlayer.PinDisplay") 
	PuPlayer.B2SInit "", pGameName   'use new method to startup pup with dmd via puppack
	on error goto 0
	if not IsObject(PuPlayer) then HasPuP = False
	end If

	
	PuPlayer.LabelInit pBackglass

	'Setup Pages.  Note if you use fonts they must be in FONTS folder of the pupVideos\tablename\FONTS
	'syntax - PuPlayer.LabelNew <screen# or pDMD>,<Labelname>,<fontName>,<size%>,<colour>,<rotation>,<xAlign>,<yAlign>,<xpos>,<ypos>,<PageNum>,<visible>

	'Page 1 (default score display)
	'colors
	'dark - 2697513
	'light - 15066597

	'top
	PuPlayer.LabelNew pBackglass,"potionnum",typefont,			3,15066597  ,0,0,1,23,81,1,0
	PuPlayer.LabelNew pBackglass,"potionname",typefont,			3,15066597  ,0,0,1,23,81,1,0
	PuPlayer.LabelNew pBackglass,"egghits",typefont,			3,2697513  	,0,0,1,23,81,1,0
	PuPlayer.LabelNew pBackglass,"egglocks",typefont,			3,2697513  	,0,0,1,23,81,1,0
	PuPlayer.LabelNew pBackglass,"lakespins",typefont,			3,2697513  	,0,0,1,23,81,1,0
	PuPlayer.LabelNew pBackglass,"lakejack",typefont,			3,2697513  	,0,0,1,23,81,1,0
	PuPlayer.LabelNew pBackglass,"mazeramp",typefont,			3,2697513  	,0,0,1,23,81,1,0
	PuPlayer.LabelNew pBackglass,"mazejacks",typefont,			3,2697513  	,0,0,1,23,81,1,0
	PuPlayer.LabelNew pBackglass,"spellname",typefont,			3,15066597  ,0,0,1,23,81,1,0
	PuPlayer.LabelNew pBackglass,"spellnum",typefont,			3,15066597  ,0,0,1,23,81,1,0

	'bottom

	PuPlayer.LabelNew pBackglass,"gobletnum",typefont,			3,2697513  	,0,0,1,23,81,1,0
	PuPlayer.LabelNew pBackglass,"deatheaternum",typefont,		3,2697513  	,0,0,1,23,81,1,0
	PuPlayer.LabelNew pBackglass,"modenum",typefont,			3,2697513  	,0,0,1,23,81,1,0
	PuPlayer.LabelNew pBackglass,"combonum",typefont,			3,2697513  	,0,0,1,23,81,1,0
	PuPlayer.LabelNew pBackglass,"modetimernum",typefont,		3,2697513  	,0,0,1,23,81,1,0
	PuPlayer.LabelNew pBackglass,"Ball",typefont,				2,2697513 	,0,1,1,50,81,1,1
	PuPlayer.LabelNew pBackglass,"curplayer",typefont,			3,2697513	,0,1,1,50,93,1,1
	PuPlayer.LabelNew pBackglass,"curscore",numberfont,			7,2697513	,0,1,1,50,87,1,1
	PuPlayer.LabelNew pBackglass,"Play1score",numberfont,		3,2697513  	,0,0,1,31,81,1,0
	PuPlayer.LabelNew pBackglass,"Play2score",numberfont,		3,2697513  	,0,0,1,31,85,1,0
	PuPlayer.LabelNew pBackglass,"Play3score",numberfont,		3,2697513  	,0,0,1,31,89,1,0
	PuPlayer.LabelNew pBackglass,"Play4score",numberfont,		3,2697513  	,0,0,1,31,93,1,0
	PuPlayer.LabelNew pBackglass,"ruletitle",numberfont,		3,15066597  ,0,1,1,50,12,1,1
	PuPlayer.LabelNew pBackglass,"rulecopy1",typefont,			2,15066597 	,0,1,1,50,15,1,1
	PuPlayer.LabelNew pBackglass,"rulecopy2",typefont,			2,15066597 	,0,1,1,50,15,1,1


	
	'onverlay
	PuPlayer.LabelNew pBackglass,"titleimg",zoomfont,			6,16777215 	,0,1,1, 0,0,1,1
	PuPlayer.LabelSet pBackglass,"titleimg","DMDImages\\popframe.png",1,"{'mt':2,'width': 0, 'height': 0, 'yalign': 0}"
	PuPlayer.LabelNew pBackglass,"titlebg",zoombgfont,			9,0  		,0,1,1,50,50,1,1
	PuPlayer.LabelNew pBackglass,"title",zoomfont,				9,16777215 	,0,1,1,50,50,1,1
	PuPlayer.LabelNew pBackglass,"titlebg2",zoombgfont,			6,0  		,0,1,1,50,50,1,1
	PuPlayer.LabelNew pBackglass,"title2",zoomfont,				6,16777215 	,0,1,1,50,50,1,1
	PuPlayer.LabelNew pBackglass,"mgscore",numberfont,			9,15066597	,0,1,1,50,47,1,1


	'attract
	PuPlayer.LabelNew pBackglass,"high1name",typefont,			5,16777215  ,0,1,1,22,30,1,1
	PuPlayer.LabelNew pBackglass,"high1score",numberfont,		5,16777215  ,0,1,1,36,30,1,1
	PuPlayer.LabelNew pBackglass,"high2name",typefont,			5,16777215  ,0,1,1,22,38,1,1
	PuPlayer.LabelNew pBackglass,"high2score",numberfont,		5,16777215  ,0,1,1,36,38,1,1
	PuPlayer.LabelNew pBackglass,"high3name",typefont,			5,16777215  ,0,1,1,22,46,1,1
	PuPlayer.LabelNew pBackglass,"high3score",numberfont,		5,16777215  ,0,1,1,36,46,1,1
	PuPlayer.LabelNew pBackglass,"high4name",typefont,			5,16777215  ,0,1,1,22,54,1,1
	PuPlayer.LabelNew pBackglass,"high4score",numberfont,		5,16777215  ,0,1,1,36,54,1,1
	PuPlayer.LabelNew pBackglass,"HighScore",typefont,			6,16777215	,0,0,1,20,30,1,1
	PuPlayer.LabelNew pBackglass,"HighScoreL1",numberfont,		8,16777215	,0,0,1,20,40,1,1
	PuPlayer.LabelNew pBackglass,"HighScoreL2",numberfont,		8,16777215	,0,0,1,24,40,1,1
	PuPlayer.LabelNew pBackglass,"HighScoreL3",numberfont,		8,16777215	,0,0,1,28,40,1,1
	PuPlayer.LabelNew pBackglass,"HighScoreL4",numberfont,		4,16777215	,0,0,1,20,50,1,1
	PuPlayer.LabelNew pBackglass,"CurImage","Arial",			50,391231   ,0,1,1, 0, 0,1,1  'new image type

	'obslabels
	'week
	PuPlayer.LabelNew pBackglass,"wh1n",typefont,				5,16777215  ,0,1,1,22,30,1,1
	PuPlayer.LabelNew pBackglass,"wh1s",numberfont,				5,16777215  ,0,1,1,36,30,1,1
	PuPlayer.LabelNew pBackglass,"wh2n",typefont,				5,16777215  ,0,1,1,22,30,1,1
	PuPlayer.LabelNew pBackglass,"wh2s",numberfont,				5,16777215  ,0,1,1,36,30,1,1
	PuPlayer.LabelNew pBackglass,"wh3n",typefont,				5,16777215  ,0,1,1,22,30,1,1
	PuPlayer.LabelNew pBackglass,"wh3s",numberfont,				5,16777215  ,0,1,1,36,30,1,1
	PuPlayer.LabelNew pBackglass,"wh4n",typefont,				5,16777215  ,0,1,1,22,30,1,1
	PuPlayer.LabelNew pBackglass,"wh4s",numberfont,				5,16777215  ,0,1,1,36,30,1,1
	PuPlayer.LabelNew pBackglass,"wh5n",typefont,				5,16777215  ,0,1,1,22,30,1,1
	PuPlayer.LabelNew pBackglass,"wh5s",numberfont,				5,16777215  ,0,1,1,36,30,1,1
	PuPlayer.LabelNew pBackglass,"wh6n",typefont,				5,16777215  ,0,1,1,22,30,1,1
	PuPlayer.LabelNew pBackglass,"wh6s",numberfont,				5,16777215  ,0,1,1,36,30,1,1
	PuPlayer.LabelNew pBackglass,"wh7n",typefont,				5,16777215  ,0,1,1,22,30,1,1
	PuPlayer.LabelNew pBackglass,"wh7s",numberfont,				5,16777215  ,0,1,1,36,30,1,1
	PuPlayer.LabelNew pBackglass,"wh8n",typefont,				5,16777215  ,0,1,1,22,30,1,1
	PuPlayer.LabelNew pBackglass,"wh8s",numberfont,				5,16777215  ,0,1,1,36,30,1,1
	PuPlayer.LabelNew pBackglass,"wh9n",typefont,				5,16777215  ,0,1,1,22,30,1,1
	PuPlayer.LabelNew pBackglass,"wh9s",numberfont,				5,16777215  ,0,1,1,36,30,1,1
	PuPlayer.LabelNew pBackglass,"wh10n",typefont,				5,16777215  ,0,1,1,22,30,1,1
	PuPlayer.LabelNew pBackglass,"wh10s",numberfont,			5,16777215  ,0,1,1,36,30,1,1
	' all-time
	PuPlayer.LabelNew pBackglass,"ah1n",typefont,				5,16777215  ,0,1,1,22,30,1,1
	PuPlayer.LabelNew pBackglass,"ah1s",numberfont,				5,16777215  ,0,1,1,36,30,1,1
	PuPlayer.LabelNew pBackglass,"ah2n",typefont,				5,16777215  ,0,1,1,22,30,1,1
	PuPlayer.LabelNew pBackglass,"ah2s",numberfont,				5,16777215  ,0,1,1,36,30,1,1
	PuPlayer.LabelNew pBackglass,"ah3n",typefont,				5,16777215  ,0,1,1,22,30,1,1
	PuPlayer.LabelNew pBackglass,"ah3s",numberfont,				5,16777215  ,0,1,1,36,30,1,1
	PuPlayer.LabelNew pBackglass,"ah4n",typefont,				5,16777215  ,0,1,1,22,30,1,1
	PuPlayer.LabelNew pBackglass,"ah4s",numberfont,				5,16777215  ,0,1,1,36,30,1,1
	PuPlayer.LabelNew pBackglass,"ah5n",typefont,				5,16777215  ,0,1,1,22,30,1,1
	PuPlayer.LabelNew pBackglass,"ah5s",numberfont,				5,16777215  ,0,1,1,36,30,1,1
	PuPlayer.LabelNew pBackglass,"ah6n",typefont,				5,16777215  ,0,1,1,22,30,1,1
	PuPlayer.LabelNew pBackglass,"ah6s",numberfont,				5,16777215  ,0,1,1,36,30,1,1
	PuPlayer.LabelNew pBackglass,"ah7n",typefont,				5,16777215  ,0,1,1,22,30,1,1
	PuPlayer.LabelNew pBackglass,"ah7s",numberfont,				5,16777215  ,0,1,1,36,30,1,1
	PuPlayer.LabelNew pBackglass,"ah8n",typefont,				5,16777215  ,0,1,1,22,30,1,1
	PuPlayer.LabelNew pBackglass,"ah8s",numberfont,				5,16777215  ,0,1,1,36,30,1,1
	PuPlayer.LabelNew pBackglass,"ah9n",typefont,				5,16777215  ,0,1,1,22,30,1,1
	PuPlayer.LabelNew pBackglass,"ah9s",numberfont,				5,16777215  ,0,1,1,36,30,1,1
	PuPlayer.LabelNew pBackglass,"ah10n",typefont,				5,16777215  ,0,1,1,22,30,1,1
	PuPlayer.LabelNew pBackglass,"ah10s",numberfont,			5,16777215  ,0,1,1,36,30,1,1

	'called on table load
	Sub resetbackglass
	PuPlayer.LabelSet pBackglass,"titleimg","",1,"{'mt':2,'color':111111, 'width': 0, 'height': 0, 'yalign': 0}"
	PuPlayer.LabelShowPage pBackglass,1,0,""
	'PuPlayer.playlistplayex pBackglass,"backglass","base.mp4",0,1  'should be an attract background (no text is displayed)
	'PuPlayer.SetBackground pBackglass,1	
	'top
	PuPlayer.LabelSet pBackglass,"potionnum",0,1,"{'mt':2,'color':15066597, 'size': 4, 'xpos': 6.5, 'xalign': 1, 'ypos': 5.4, 'yalign': 1}"
	PuPlayer.LabelSet pBackglass,"egghits",0 & "/" & 5,1,"{'mt':2,'color':2697513, 'size': 3, 'xpos': 35.8, 'xalign': 1, 'ypos': 6.2, 'yalign': 1}"
	PuPlayer.LabelSet pBackglass,"egglocks",0,1,"{'mt':2,'color':2697513, 'size': 3, 'xpos': 35.8, 'xalign': 1, 'ypos': 11.9, 'yalign': 1}"
	PuPlayer.LabelSet pBackglass,"lakespins",75,1,"{'mt':2,'color':2697513, 'size': 3, 'xpos': 50, 'xalign': 1, 'ypos': 6.2, 'yalign': 1}"
	PuPlayer.LabelSet pBackglass,"lakejack",mermultivalue / 1000000 & "m",1,"{'mt':2,'color':2697513, 'size': 3, 'xpos': 50, 'xalign': 1, 'ypos': 11.9, 'yalign': 1}"
	PuPlayer.LabelSet pBackglass,"mazeramp",0 & "/" & 8,1,"{'mt':2,'color':2697513, 'size': 3, 'xpos': 64.2, 'xalign': 1, 'ypos': 6.2, 'yalign': 1}"
	PuPlayer.LabelSet pBackglass,"mazejacks",0,1,"{'mt':2,'color':2697513, 'size': 3, 'xpos': 64.2, 'xalign': 1, 'ypos': 11.9, 'yalign': 1}"
	PuPlayer.LabelSet pBackglass,"spellnum",0,1,"{'mt':2,'color':15066597, 'size': 4, 'xpos': 93.6, 'xalign': 1, 'ypos': 5.4, 'yalign': 1}"
	'bottom
	PuPlayer.LabelSet pBackglass,"gobletnum",0,1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 8.8, 'xalign': 1, 'ypos': 88.8, 'yalign': 1}"
	PuPlayer.LabelSet pBackglass,"deatheaternum",0,1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 17.1, 'xalign': 1, 'ypos': 88.8, 'yalign': 1}"
	PuPlayer.LabelSet pBackglass,"modenum",0,1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 25.8, 'xalign': 1, 'ypos': 88.8, 'yalign': 1}"
	PuPlayer.LabelSet pBackglass,"combonum",0,1,"{'mt':2,'color':15066597, 'size': 4, 'xpos': 38.9, 'xalign': 1, 'ypos': 74.8, 'yalign': 1}"
	PuPlayer.LabelSet pBackglass,"modetimernum",0,1,"{'mt':2,'color':15066597, 'size': 4, 'xpos': 61.4, 'xalign': 1, 'ypos': 74.8, 'yalign': 1}"
	PuPlayer.LabelSet pBackglass,"curplayer","Player 1",1,"{'mt':2,'color':2697513, 'size': 2, 'xpos': 45, 'xalign': 1, 'ypos': 81.2, 'yalign': 0}"
	PuPlayer.LabelSet pBackglass,"Ball","Ball 0",1,"{'mt':2,'color':2697513, 'size': 2, 'xpos': 48, 'xalign': 0, 'ypos': 81.2, 'yalign': 0}"
	PuPlayer.LabelSet pBackglass,"curscore","x",1,"{'mt':2,'color':2697513, 'size': 6.2, 'xpos': 50, 'xalign': 1, 'ypos': 87.2, 'yalign': 1}"
	PuPlayer.LabelSet pBackglass,"Play1score","",1,"{'mt':2,'color':2697513, 'size': 2, 'xpos': 40.1, 'xalign': 1, 'ypos': 91.9, 'yalign': 1}"
	PuPlayer.LabelSet pBackglass,"Play2score","",1,"{'mt':2,'color':2697513, 'size': 2, 'xpos': 46.8, 'xalign': 1, 'ypos': 91.9, 'yalign': 1}"
	PuPlayer.LabelSet pBackglass,"Play3score","",1,"{'mt':2,'color':2697513, 'size': 2, 'xpos': 53.6, 'xalign': 1, 'ypos': 91.9, 'yalign': 1}"
	PuPlayer.LabelSet pBackglass,"Play4score","",1,"{'mt':2,'color':2697513, 'size': 2, 'xpos': 60.1, 'xalign': 1, 'ypos': 91.9, 'yalign': 1}"
	PuPlayer.LabelSet pBackglass,"ruletitle","Harry Potter && the Goblet of Fire",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 86.8, 'yalign': 1}"
	PuPlayer.LabelSet pBackglass,"rulecopy1","Games Played: " & TotalGamesPlayed,1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 89.8, 'yalign': 1}"
	PuPlayer.LabelSet pBackglass,"rulecopy2","This is a fan game meant only for fun.",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 92.8, 'yalign': 1}"




	End Sub

	'called each time a player changes
	Sub currentplayerbackglass
		puPlayer.LabelSet pBackglass,"titleimg","",1,"{'mt':2,'color':111111, 'width': 0, 'height': 0, 'yalign': 0}"
		PuPlayer.LabelSet pBackglass,"potionnum",potneeded - potions(CurrentPlayer),1,"{'mt':2,'color':15066597, 'size': 4, 'xpos': 6.5, 'xalign': 1, 'ypos': 5.4, 'yalign': 1}"
		PuPlayer.LabelSet pBackglass,"egglocks",dragonlock(CurrentPlayer),1,"{'mt':2,'color':2697513, 'size': 3, 'xpos': 35.8, 'xalign': 1, 'ypos': 11.9, 'yalign': 1}"
		PuPlayer.LabelSet pBackglass,"mazejacks",mazejacks(CurrentPlayer),1,"{'mt':2,'color':2697513, 'size': 3, 'xpos': 64.2, 'xalign': 1, 'ypos': 11.9, 'yalign': 1}"
		
		If goblets(CurrentPlayer) > 15 Then
		PuPlayer.LabelSet pBackglass,"gobletnum",0,1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 8.8, 'xalign': 1, 'ypos': 88.8, 'yalign': 1}"
		Else
		PuPlayer.LabelSet pBackglass,"gobletnum",15 - goblets(CurrentPlayer),1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 8.8, 'xalign': 1, 'ypos': 88.8, 'yalign': 1}"
		end If

		If totalbumps(CurrentPlayer) < 75 Then
			PuPlayer.LabelSet pBackglass,"deatheaternum",75 - totalbumps(CurrentPlayer),1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 17.1, 'xalign': 1, 'ypos': 88.8, 'yalign': 1}"
		Else
			PuPlayer.LabelSet pBackglass,"deatheaternum",0,1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 17.1, 'xalign': 1, 'ypos': 88.8, 'yalign': 1}"
			checkmerlinsecond
		end if

		PuPlayer.LabelSet pBackglass,"combonum",10 - totalcombo(CurrentPlayer),1,"{'mt':2,'color':15066597, 'size': 4, 'xpos': 38.9, 'xalign': 1, 'ypos': 74.8, 'yalign': 1}"

		if modescompleted(CurrentPlayer) > 3 Then
			PuPlayer.LabelSet pBackglass,"modenum",0,1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 25.8, 'xalign': 1, 'ypos': 88.8, 'yalign': 1}"
		Else
			PuPlayer.LabelSet pBackglass,"modenum",3-modescompleted(CurrentPlayer),1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 25.8, 'xalign': 1, 'ypos': 88.8, 'yalign': 1}"
		end if
		setpotionname
	End Sub



	Dim titlepos
	titlepos = 0
	titletimer.enabled = 0
	dim title
	title = ""
	dim subtitle
	subtitle = ""

	Sub titletimer_timer
		titlepos = titlepos + 1
		Select Case titlepos
			Case 1
				PuPlayer.LabelSet pBackglass,"titleimg","DMDImages\\popframe.png",1,"{'mt':2,'width': 99, 'height': 99, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"title",title,1,"{'mt':2,'color':2565927, 'size': 0, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg",title,1,"{'mt':2,'color':0, 'size': 0, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"title2",subtitle,1,"{'mt':2,'color':2565927, 'size': 0, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg2",subtitle,1,"{'mt':2,'color':0, 'size': 0, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"

			Case 2
				PuPlayer.LabelSet pBackglass,"textbg","",1,""
				PuPlayer.LabelSet pBackglass,"title",title,1,"{'mt':2,'color':5066061, 'size': 0.6, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg",title,1,"{'mt':2,'color':0, 'size': 0.6, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"title2",subtitle,1,"{'mt':2,'color':5066061, 'size': 0.4, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg2",subtitle,1,"{'mt':2,'color':0, 'size': 0.4, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
			Case 3
				PuPlayer.LabelSet pBackglass,"title",title,1,"{'mt':2,'color':7960953, 'size': 1.2, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg",title,1,"{'mt':2,'color':0, 'size': 1.2, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"title2",subtitle,1,"{'mt':2,'color':7960953, 'size': 0.8, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg2",subtitle,1,"{'mt':2,'color':0, 'size': 0.8, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
			Case 4
				PuPlayer.LabelSet pBackglass,"title",title,1,"{'mt':2,'color':9671571, 'size': 1.8, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg",title,1,"{'mt':2,'color':0, 'size': 1.8, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"title2",subtitle,1,"{'mt':2,'color':9671571, 'size': 1.2, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg2",subtitle,1,"{'mt':2,'color':0, 'size': 1.2, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
			Case 5
				PuPlayer.LabelSet pBackglass,"title",title,1,"{'mt':2,'color':11842740, 'size': 2.4, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg",title,1,"{'mt':2,'color':0, 'size': 2.4, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"title2",subtitle,1,"{'mt':2,'color':11842740, 'size': 1.6, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg2",subtitle,1,"{'mt':2,'color':0, 'size': 1.6, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
			Case 6
				PuPlayer.LabelSet pBackglass,"title",title,1,"{'mt':2,'color':13224393, 'size': 3, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg",title,1,"{'mt':2,'color':0, 'size': 3, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"title2",subtitle,1,"{'mt':2,'color':13224393, 'size': 2, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg2",subtitle,1,"{'mt':2,'color':0, 'size': 2, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
			Case 7
				PuPlayer.LabelSet pBackglass,"title",title,1,"{'mt':2,'color':14671839, 'size': 3.6, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg",title,1,"{'mt':2,'color':0, 'size': 3.6, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"title2",subtitle,1,"{'mt':2,'color':14671839, 'size': 2.4, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg2",subtitle,1,"{'mt':2,'color':0, 'size': 2.4, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
			Case 8
				PuPlayer.LabelSet pBackglass,"title",title,1,"{'mt':2,'color':15790320, 'size': 4.2, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg",title,1,"{'mt':2,'color':0, 'size': 4.2, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"title2",subtitle,1,"{'mt':2,'color':15790320, 'size': 2.8, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg2",subtitle,1,"{'mt':2,'color':0, 'size': 2.8, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
			Case 9
				PuPlayer.LabelSet pBackglass,"title",title,1,"{'mt':2,'color':16316664, 'size': 4.8, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg",title,1,"{'mt':2,'color':0, 'size': 4.8, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"title2",subtitle,1,"{'mt':2,'color':16316664, 'size': 3.2, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg2",subtitle,1,"{'mt':2,'color':0, 'size': 3.2, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
			Case 10
				PuPlayer.LabelSet pBackglass,"title",title,1,"{'mt':2,'color':16777215, 'size': 5.4, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg",title,1,"{'mt':2,'color':0, 'size': 5.4, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"title2",subtitle,1,"{'mt':2,'color':16777215, 'size': 3.6, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg2",subtitle,1,"{'mt':2,'color':0, 'size': 3.6, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
			Case 11
				puPlayer.LabelSet pBackglass,"titleimg","DMDImages\\popframe.png",1,"{'mt':2,'width': 90, 'height': 90, 'yalign': 1}"
				PuPlayer.LabelSet pBackglass,"title",title,1,"{'mt':2,'color':16777215, 'size': 6, 'xpos': 50, 'xalign': 1, 'ypos': 36.4, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg",title,1,"{'mt':2,'color':0, 'size': 6, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"title2",subtitle,1,"{'mt':2,'color':16777215, 'size': 4, 'xpos': 50, 'xalign': 1, 'ypos': 45.3, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg2",subtitle,1,"{'mt':2,'color':0, 'size': 4, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"

			Case 150
				puPlayer.LabelSet pBackglass,"titleimg","",1,"{'mt':2,'color':111111, 'width': 0, 'height': 0, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"title","",1,"{'mt':2,'color':16777215, 'size': 6, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg","",1,"{'mt':2,'color':0, 'size': 6, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"title2","",1,"{'mt':2,'color':16777215, 'size': 4, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
				PuPlayer.LabelSet pBackglass,"titlebg2","",1,"{'mt':2,'color':0, 'size': 4, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
				titlepos = 0
				titletimer.enabled = 0
		End Select
	End Sub

	
	Sub pNote(msgText,msg2text)
		If usePuPDMD=true then exit sub
		title = msgText
		subtitle = msg2text
		If titlepos = 0 Then
			titletimer.enabled = 1
		Else
			titlepos = 0
			titletimer.enabled = 1
			PuPlayer.LabelSet pBackglass,"title","",1,"{'mt':2,'color':16777215, 'size': 6, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
			PuPlayer.LabelSet pBackglass,"titlebg","",1,"{'mt':2,'color':0, 'size': 6, 'xpos': 50, 'xalign': 1, 'ypos': 36, 'yalign': 0}"
			PuPlayer.LabelSet pBackglass,"title2","",1,"{'mt':2,'color':16777215, 'size': 4, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
			PuPlayer.LabelSet pBackglass,"titlebg2","",1,"{'mt':2,'color':0, 'size': 4, 'xpos': 50, 'xalign': 1, 'ypos': 45, 'yalign': 0}"
		End If
	End Sub


	Sub pUpdateScores
		PuPlayer.LabelSet pBackglass,"curscore",FormatNumber(Score(CurrentPlayer),0),1,""
		PuPlayer.LabelSet pBackglass,"curplayer","Player " & CurrentPlayer,1,""
		If CurrentPlayer = 1 Then
			PuPlayer.LabelSet pBackglass,"Play1score","" & FormatNumber(Score(CurrentPlayer),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
			PuPlayer.LabelSet pBackglass,"Play1","Player 1",1,"{'mt':2,'color':2697513 }"
			'make other scores red (inactive)
			If PlayersPlayingGame = 2 Then
				PuPlayer.LabelSet pBackglass,"Play2score","" & FormatNumber(Score(2),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
				PuPlayer.LabelSet pBackglass,"Play2","Player 2",1,"{'mt':2,'color':2697513}"
			End If
			If PlayersPlayingGame = 3 Then
				PuPlayer.LabelSet pBackglass,"Play2score","" & FormatNumber(Score(2),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
				PuPlayer.LabelSet pBackglass,"Play2","Player 2",1,"{'mt':2,'color':2697513}"
				PuPlayer.LabelSet pBackglass,"Play3score","" & FormatNumber(Score(3),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
				PuPlayer.LabelSet pBackglass,"Play3","Player 3",1,"{'mt':2,'color':2697513}"
			End If
			If PlayersPlayingGame = 4 Then
				PuPlayer.LabelSet pBackglass,"Play2score","" & FormatNumber(Score(2),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
				PuPlayer.LabelSet pBackglass,"Play2","Player 2",1,"{'mt':2,'color':2697513}"
				PuPlayer.LabelSet pBackglass,"Play3score","" & FormatNumber(Score(3),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
				PuPlayer.LabelSet pBackglass,"Play3","Player 3",1,"{'mt':2,'color':2697513}"
				PuPlayer.LabelSet pBackglass,"Play4score","" & FormatNumber(Score(4),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
				PuPlayer.LabelSet pBackglass,"Play4","Player 4",1,"{'mt':2,'color':2697513}"
			End If
		End If
		If CurrentPlayer = 2 Then
			PuPlayer.LabelSet pBackglass,"Play2score","" & FormatNumber(Score(CurrentPlayer),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
			PuPlayer.LabelSet pBackglass,"Play2","Player 2",1,"{'mt':2,'color':2697513 }"
			If PlayersPlayingGame = 2 Then
				PuPlayer.LabelSet pBackglass,"Play1score","" & FormatNumber(Score(1),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
				PuPlayer.LabelSet pBackglass,"Play1","Player 1",1,"{'mt':2,'color':2697513}"
			End If
			If PlayersPlayingGame = 3 Then
				PuPlayer.LabelSet pBackglass,"Play1score","" & FormatNumber(Score(1),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
				PuPlayer.LabelSet pBackglass,"Play1","Player 1",1,"{'mt':2,'color':2697513}"
				PuPlayer.LabelSet pBackglass,"Play3score","" & FormatNumber(Score(3),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
				PuPlayer.LabelSet pBackglass,"Play3","Player 3",1,"{'mt':2,'color':2697513}"
			End If
			If PlayersPlayingGame = 4 Then
				PuPlayer.LabelSet pBackglass,"Play1score","" & FormatNumber(Score(1),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
				PuPlayer.LabelSet pBackglass,"Play1","Player 1",1,"{'mt':2,'color':2697513}"
				PuPlayer.LabelSet pBackglass,"Play3score","" & FormatNumber(Score(3),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
				PuPlayer.LabelSet pBackglass,"Play3","Player 3",1,"{'mt':2,'color':2697513}"
				PuPlayer.LabelSet pBackglass,"Play4score","" & FormatNumber(Score(4),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
				PuPlayer.LabelSet pBackglass,"Play4","Player 4",1,"{'mt':2,'color':2697513}"
			End If
		End If
		If CurrentPlayer = 3 Then
			PuPlayer.LabelSet pBackglass,"Play3score","" & FormatNumber(Score(CurrentPlayer),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
			PuPlayer.LabelSet pBackglass,"Play3","Player 3",1,"{'mt':2,'color':2697513 }"
			If PlayersPlayingGame = 3 Then
				PuPlayer.LabelSet pBackglass,"Play1score","" & FormatNumber(Score(1),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
				PuPlayer.LabelSet pBackglass,"Play1","Player 1",1,"{'mt':2,'color':2697513}"
				PuPlayer.LabelSet pBackglass,"Play2score","" & FormatNumber(Score(2),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
				PuPlayer.LabelSet pBackglass,"Play2","Player 2",1,"{'mt':2,'color':2697513}"
			End If
			If PlayersPlayingGame = 4 Then
				PuPlayer.LabelSet pBackglass,"Play1score","" & FormatNumber(Score(1),0),1,"{'mt':2,'color':2697513, 'size': 2}"
				PuPlayer.LabelSet pBackglass,"Play1","Player 1",1,"{'mt':2,'color':2697513}"
				PuPlayer.LabelSet pBackglass,"Play2score","" & FormatNumber(Score(2),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
				PuPlayer.LabelSet pBackglass,"Play2","Player 2",1,"{'mt':2,'color':2697513}"
				PuPlayer.LabelSet pBackglass,"Play4score","" & FormatNumber(Score(4),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
				PuPlayer.LabelSet pBackglass,"Play4","Player 4",1,"{'mt':2,'color':2697513}"
			End If
		End If
		If CurrentPlayer = 4 Then
			PuPlayer.LabelSet pBackglass,"Play4score","" & FormatNumber(Score(CurrentPlayer),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
			PuPlayer.LabelSet pBackglass,"Play4","Player 4",1,"{'mt':2,'color':2697513 }"
			If PlayersPlayingGame = 4 Then
				PuPlayer.LabelSet pBackglass,"Play1score","" & FormatNumber(Score(1),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
				PuPlayer.LabelSet pBackglass,"Play1","Player 1",1,"{'mt':2,'color':2697513}"
				PuPlayer.LabelSet pBackglass,"Play2score","" & FormatNumber(Score(2),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
				PuPlayer.LabelSet pBackglass,"Play2","Player 2",1,"{'mt':2,'color':2697513}"
				PuPlayer.LabelSet pBackglass,"Play3score","" & FormatNumber(Score(3),0),1,"{'mt':2,'color':2697513, 'size': 2 }"
				PuPlayer.LabelSet pBackglass,"Play3","Player 3",1,"{'mt':2,'color':2697513}"
			End If
		End If
	dim ballnum
	ballnum = bpgcurrent - BallsRemaining(CurrentPlayer) + 1
	if ballnum = 4 Then
	PuPlayer.LabelSet pBackglass,"Ball","Ball "  &  3 ,1,""
	else
	PuPlayer.LabelSet pBackglass,"Ball","Ball "  &  bpgcurrent - BallsRemaining(CurrentPlayer) + 1 ,1,""
	end if
	end Sub








'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'   Pupdmd Settings
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
	'PUPDMD Layout for each Table1
	'Setup Pages.  Note if you use fonts they must be in FONTS folder of the pupVideos\tablename\FONTS  "case sensitive exact naming fonts!"
	'*****************************************************************
	dim dmdnote:dmdnote="1-shortnote.mp4"

	Sub pSetPageLayouts

	DIM dmddef
	DIM dmdalt
	DIM dmdscr
	DIM dmdfixed

	'labelNew <screen#>, <Labelname>, <fontName>,<size%>,<colour>,<rotation>,<xalign>,<yalign>,<xpos>,<ypos>,<PageNum>,<visible>
	'***********************************************************************'
	'<screen#>, in standard wed set this to pDMD ( or 1)
	'<Labelname>, your name of the label. keep it short no spaces (like 8 chars) although you can call it anything really. When setting the label you will use this labelname to access the label.
	'<fontName> Windows font name, this must be exact match of OS front name. if you are using custom TTF fonts then double check the name of font names.
	'<size%>, Height as a percent of display height. 20=20% of screen height.
	'<colour>, integer value of windows color.
	'<rotation>, degrees in tenths   (900=90 degrees)
	'<xAlign>, 0= horizontal left align, 1 = center horizontal, 2= right horizontal
	'<yAlign>, 0 = top, 1 = center, 2=bottom vertical alignment
	'<xpos>, this should be 0, but if you want to force a position you can set this. it is a % of horizontal width. 20=20% of screen width.
	'<ypos> same as xpos.
	'<PageNum> IMPORTANT this will assign this label to this page or group.
	'<visible> initial state of label. visible=1 show, 0 = off.



	if PuPDMDDriverType=pDMDTypeReal Then 'using RealDMD Mirroring.  **********  128x32 Real Color DMD  
		dmdalt="PKMN Pinball"
		dmdfixed="Instruction"
		dmdscr="Impact"    'main scorefont
		dmddef="Zig"

		'Page 1 (default score display)
			 PuPlayer.LabelNew pDMD,"Credits" ,dmddef,20,2697513   ,0,2,2,95,0,1,0
			 PuPlayer.LabelNew pDMD,"Play1"   ,dmdalt,21,2697513   ,1,0,0,15,0,1,0
			 PuPlayer.LabelNew pDMD,"Ball"    ,dmdalt,21,2697513   ,1,2,0,85,0,1,0
			 PuPlayer.LabelNew pDMD,"MsgScore",dmddef,45,2697513   ,0,1,0, 0,40,1,0
			 PuPlayer.LabelNew pDMD,"CurScore",dmdscr,60,2697513   ,0,1,1, 0,0,1,0


		'Page 2 (default Text Splash 1 Big Line)
			 PuPlayer.LabelNew pDMD,"Splash"  ,dmdalt,40,2697513,0,1,1,0,0,2,0

		'Page 3 (default Text Splash 2 and 3 Lines)
			 PuPlayer.LabelNew pDMD,"Splash3a",dmddef,30,2697513,0,1,0,0,2,3,0
			 PuPlayer.LabelNew pDMD,"Splash3b",dmdalt,30,2697513,0,1,0,0,30,3,0
			 PuPlayer.LabelNew pDMD,"Splash3c",dmdalt,25,2697513,0,1,0,0,55,3,0


		'Page 4 (2 Line Gameplay DMD)
			 PuPlayer.LabelNew pDMD,"Splash4a",dmddef,13,2697513,0,1,0,0,30,4,0
			 PuPlayer.LabelNew pDMD,"Splash4b",dmddef,10,2697513,0,1,2,0,55,4,0

		'Page 5 (3 layer large text for overlay targets function,  must you fixed width font!
			PuPlayer.LabelNew pDMD,"Back5"    ,dmdfixed,80,8421504,0,1,1,0,0,5,0
			PuPlayer.LabelNew pDMD,"Middle5"  ,dmdfixed,80,65535  ,0,1,1,0,0,5,0
			PuPlayer.LabelNew pDMD,"Flash5"   ,dmdfixed,80,65535  ,0,1,1,0,0,5,0

		'Page 6 (3 Lines for big # with two lines,  "19^Orbits^Count")
			PuPlayer.LabelNew pDMD,"Splash6a",dmddef,90,65280,0,0,0,15,1,6,0
			PuPlayer.LabelNew pDMD,"Splash6b",dmddef,50,33023,0,1,0,60,0,6,0
			PuPlayer.LabelNew pDMD,"Splash6c",dmddef,40,33023,0,1,0,60,50,6,0

		'Page 7 (Show High Scores Fixed Fonts)
			PuPlayer.LabelNew pDMD,"Splash7a",dmddef,20,8454143,0,1,0,0,2,7,0
			PuPlayer.LabelNew pDMD,"Splash7b",dmdfixed,40,33023,0,1,0,0,20,7,0
			PuPlayer.LabelNew pDMD,"Splash7c",dmdfixed,40,33023,0,1,0,0,50,7,0

			
			'pDMDStartBackLoop "DMDSplash","intro1.mp4"
			dmdnote="1-shortnote.mp4"

	END IF  ' use PuPDMDDriver

	if PuPDMDDriverType=pDMDTypeLCD THEN  'Using 4:1 Standard ratio LCD PuPDMD  ************ lcd **************

		'dmddef="Impact"
		dmdalt=typefont    
		dmdfixed=typefont
		dmdscr=typefont  'main score font
		dmddef=typefont

		'Page 1 (default score display)
			PuPlayer.LabelNew pDMD,"Credits" ,dmddef,20,2697513   ,0,2,2,95,0,1,0
			PuPlayer.LabelNew pDMD,"Play1"   ,dmdalt,20,2697513   ,1,0,0,15,0,1,0
			PuPlayer.LabelNew pDMD,"Ball"    ,dmdalt,20,2697513   ,1,2,0,85,0,1,0
			PuPlayer.LabelNew pDMD,"MsgScore",dmddef,45,2697513   ,0,1,0, 0,40,1,0
			PuPlayer.LabelNew pDMD,"CurScore",dmdscr,60,2697513   ,0,1,1, 0,0,1,0


		'Page 2 (default Text Splash 1 Big Line)
			PuPlayer.LabelNew pDMD,"Splash"  ,dmdalt,40,2697513,0,1,1,0,0,2,0

		'Page 3 (default Text 3 Lines)
			PuPlayer.LabelNew pDMD,"Splash3a",dmddef,30,2697513,0,1,0,0,2,3,0
			PuPlayer.LabelNew pDMD,"Splash3b",dmdalt,30,2697513,0,1,0,0,30,3,0
			PuPlayer.LabelNew pDMD,"Splash3c",dmdalt,25,2697513,0,1,0,0,57,3,0

		Debug.Print "Splash4a"
		'Page 4 (default Text 2 Line)
			PuPlayer.LabelNew pDMD,"Splash4a",dmddef,20,2697513,0,1,0,0,20,4,0
			PuPlayer.LabelNew pDMD,"Splash4b",dmddef,15,2697513,0,1,2,0,65,4,0

		'Page 5 (3 layer large text for overlay targets function,  must you fixed width font!
			PuPlayer.LabelNew pDMD,"Back5"    ,dmdfixed,80,2697513,0,1,1,0,0,5,0
			PuPlayer.LabelNew pDMD,"Middle5"  ,dmdfixed,80,2697513  ,0,1,1,0,0,5,0
			PuPlayer.LabelNew pDMD,"Flash5"   ,dmdfixed,80,2697513  ,0,1,1,0,0,5,0

		'Page 6 (3 Lines for big # with two lines,  "19^Orbits^Count")
			PuPlayer.LabelNew pDMD,"Splash6a",dmddef,90,2697513,0,0,0,15,1,6,0
			PuPlayer.LabelNew pDMD,"Splash6b",dmddef,50,2697513,0,1,0,60,0,6,0
			PuPlayer.LabelNew pDMD,"Splash6c",dmddef,40,2697513,0,1,0,60,50,6,0

		'Page 7 (Show High Scores Fixed Fonts)
			PuPlayer.LabelNew pDMD,"Splash7a",dmddef,20,2697513,0,1,0,0,2,7,0
			PuPlayer.LabelNew pDMD,"Splash7b",dmdfixed,40,2697513,0,1,0,0,20,7,0
			PuPlayer.LabelNew pDMD,"Splash7c",dmdfixed,40,2697513,0,1,0,0,50,7,0

			'pDMDStartBackLoop "DMDSplash","intro1.mp4"
			dmdnote="1-shortnote.mp4"

	END IF  ' use PuPDMDDriver

	if PuPDMDDriverType=pDMDTypeFULL THEN  'Using FULL BIG LCD PuPDMD  ************ lcd **************

		'dmddef="Impact"
		dmdalt=typefont    
		dmdfixed=typefont
		dmdscr=typefont  'main score font
		dmddef=typefont

		'Page 1 (default score display)
			PuPlayer.LabelNew pDMD,"Credits" ,dmddef,20,2697513   ,0,2,2,95,0,1,0
			PuPlayer.LabelNew pDMD,"Play1"   ,dmdalt,20,2697513   ,1,0,0,15,0,1,0
			PuPlayer.LabelNew pDMD,"Ball"    ,dmdalt,20,2697513   ,1,2,0,85,0,1,0
			PuPlayer.LabelNew pDMD,"MsgScore",dmddef,45,2697513   ,0,1,0, 0,40,1,0
			PuPlayer.LabelNew pDMD,"CurScore",dmdscr,60,2697513   ,0,1,1, 0,0,1,0		


		'Page 2 (default Text Splash 1 Big Line)
			PuPlayer.LabelNew pDMD,"Splash"  ,dmdalt,20,2697513,0,1,1,0,50,2,0

		'Page 3 (default Text 3 Lines)
			PuPlayer.LabelNew pDMD,"Splash3a",dmddef,15,2697513,0,1,0,0,35,3,0
			PuPlayer.LabelNew pDMD,"Splash3b",dmdalt,10,2697513,0,1,0,0,50,3,0
			PuPlayer.LabelNew pDMD,"Splash3c",dmdalt,10,2697513,0,1,0,0,65,3,0


		'Page 4 (default Text 2 Line)
			PuPlayer.LabelNew pDMD,"Splash4a",dmddef,10,2110797,0,1,0,0,40,4,0
			PuPlayer.LabelNew pDMD,"Splash4b",dmddef,8,2110797,0,1,2,0,60,4,0

		'Page 5 (3 layer large text for overlay targets function,  must you fixed width font!
			PuPlayer.LabelNew pDMD,"Back5"    ,dmdfixed,80,2697513,0,1,1,0,0,5,0
			PuPlayer.LabelNew pDMD,"Middle5"  ,dmdfixed,80,2697513  ,0,1,1,0,0,5,0
			PuPlayer.LabelNew pDMD,"Flash5"   ,dmdfixed,80,2697513  ,0,1,1,0,0,5,0

		'Page 6 (3 Lines for big # with two lines,  "19^Orbits^Count")
			PuPlayer.LabelNew pDMD,"Splash6a",dmddef,90,2697513,0,0,0,15,1,6,0
			PuPlayer.LabelNew pDMD,"Splash6b",dmddef,50,2697513,0,1,0,60,0,6,0
			PuPlayer.LabelNew pDMD,"Splash6c",dmddef,40,2697513,0,1,0,60,50,6,0

		'Page 7 (Show High Scores Fixed Fonts)
			PuPlayer.LabelNew pDMD,"Splash7a",dmddef,20,2697513,0,1,0,0,2,7,0
			PuPlayer.LabelNew pDMD,"Splash7b",dmdfixed,40,2697513,0,1,0,0,20,7,0
			PuPlayer.LabelNew pDMD,"Splash7c",dmdfixed,40,2697513,0,1,0,0,50,7,0


			pDMDStartBackLoop "DMDSplash","intro2.mp4"
			dmdnote="2-shortnote.mp4"

	END IF  ' use PuPDMDDriver




	end Sub 'page Layouts


	'*****************************************************************
	'        PUPDMD Custom SUBS/Events for each Table1
	'     **********    MODIFY THIS SECTION!!!  ***************
	'*****************************************************************
	'

	Sub pDMDStartBall
	end Sub

	Sub pDMDGameOver
	pAttractStart
	'pDMDStartBackLoop "DMDSplash","intro" & dmdver &".mp4"
	end Sub

	Sub pAttractStart
	pDMDSetPage(pDMDBlank)   'set blank text overlay page.
	pCurAttractPos=0
	pInAttract=True 'Startup in AttractMode
	pAttractNext
	end Sub

	Sub pDMDStartUP
	 'pupDMDDisplay "attract","","intro" & dmdver &".mp4",71,0,10 
	 pInAttract=true  ' will startup attract after startup video
	end Sub

	Sub pDMDStartGame
		'pDMDStartBackLoop "DMDSplash",dmdver & "-background.mp4"
		'pupDMDDisplay "attract","",dmdver & "-background.mp4",71,0,1
	 'pupDMDDisplay "attract","",dmdver & "-background.mp4",3,0,20
	 'PuPlayer.SetLoop 3,1  '3????
	 pInAttract=false  ' will startup attract after startup video
	end Sub

	DIM pCurAttractPos: pCurAttractPos=0


	'********************** gets called auto each page next and timed already in DMD_Timer.  make sure you use pupDMDDisplay or it wont advance auto.
	Sub pAttractNext
	pCurAttractPos=pCurAttractPos+1

	  Select Case pCurAttractPos

	  Case 1 
		'pupDMDDisplay "attract","","intro" & dmdver &".mp4",71,0,1
	'  Case 2 pupDMDDisplay "attract","Attract^2","",3,0,10
	'  Case 3 pupDMDDisplay "attract","Attract^3","",2,0,10
	'  Case 4 pupDMDDisplay "attract","Attract^4","",3,1,10
	'  Case 5 pupDMDDisplay "attract","Attract^5","",1,0,10
	'  Case 6 pupDMDDisplay "attract","Attract^6","",3,1,10
	'  Case 7 pupDMDDisplay "attract","Attract^7","",2,0,10
	'  Case 8 pupDMDDisplay "attract","Attract^8","",1,0,10
	'  Case 9 pupDMDDisplay "attract","Attract^9","",1,1,10
	'  Case 10 pupDMDDisplay "attract","Attract^10","",3,1,10
	  Case Else
		pCurAttractPos=0
		pAttractNext 'reset to beginning
	  end Select

	end Sub


	'************************ called during gameplay to update Scores ***************************
	Sub pDMDUpdateScores  'call this ONLY on timer 300ms is good enough
	if pDMDCurPage <> pScores then Exit Sub
	puPlayer.LabelSet pDMD,"CurScore","" & "" & FormatNumber(Score(CurrentPlayer),0),1,""
	puPlayer.LabelSet pDMD,"Play1","play " & CurrentPlayer,1,""

	if (bpgcurrent - BallsRemaining(CurrentPlayer) + 1) < 4 Then
	  puPlayer.LabelSet pDMD,"Ball","ball "  & (bpgcurrent - BallsRemaining(CurrentPlayer)) + 1,1,""
	else
	  puPlayer.LabelSet pDMD,"Ball","ball ",1,""
	End if
	end Sub





	'********************  pretty much only use pupDMDDisplay all over ************************   
	' Sub pupDMDDisplay(pEventID, pText, VideoName,TimeSec, pAni,pPriority)
	' pEventID = reference if application,  
	' pText = "text to show" separate lines by ^ in same string
	' VideoName "gameover.mp4" will play in background  "@gameover.mp4" will play and disable text during gameplay.
	' also global variable useDMDVideos=true/false if user wishes only TEXT
	' TimeSec how long to display msg in Seconds
	' animation if any 0=none 1=Flasher
	' also,  now can specify color of each line (when no animation).  "sometext|12345"  will set label to "sometext" and set color to 12345
	'Samples
	'pupDMDDisplay "shoot", "SHOOT AGAIN!", ", 3, 1, 10 
	'pupDMDDisplay "default", "DATA GADGET LIT", "@DataGadgetLit.mp4", 3, 1, 10
	'pupDMDDisplay "shoot", "SHOOT AGAIN!", "@shootagain.mp4", 3, 1, 10   
	'pupDMDDisplay "balllock", "Ball^Locked|16744448", "", 5, 1, 10             '  5 seconds,  1=flash, 10=priority, ball is first line, locked on second and locked has custom color |
	'pupDMDDisplay "balllock","Ball 2^is^Locked", "balllocked2.mp4",3, 1,10     '  3 seconds,  1=flash, play balllocked2.mp4 from dmdsplash folder, 
	'pupDMDDisplay "balllock","Ball^is^Locked", "@balllocked.mp4",3, 1,10       '  3 seconds,  1=flash, play @balllocked.mp4 from dmdsplash folder, because @ text by default is hidden unless useDmDvideos is disabled.


	'pupDMDDisplay "shownum", "3^More To|616744448^GOOOO", "", 5, 1, 10         ' "shownum" is special.  layout is line1=BIG NUMBER and line2,line3 are side two lines.  "4^Ramps^Left"

	'pupDMDDisplay "target", "POTTER^110120", "blank.mp4", 10, 0, 10            ' 'target'...  first string is line,  second is 0=off,1=already on, 2=flash on for each character in line (count must match)

	'pupDMDDisplay "highscore", "High Score^AAA   2451654^BBB   2342342", "", 5, 0, 10            ' highscore is special  line1=text title like highscore, line2, line3 are fixed fonts to show AAA 123,123,123
	'pupDMDDisplay "highscore", "High Score^AAA   2451654|616744448^BBB   2342342", "", 5, 0, 10  ' sames as above but notice how we use a custom color for text |



'pupDMDDisplay "-","Launch^ball",dmdnote,3,0,10
'PuPlayer.LabelNew pDMD,"Splash4a",dmddef,20,2697513,0,1,0,0,0,4,0
'PuPlayer.LabelNew pDMD,"Splash4b",dmddef,15,2697513,0,1,2,0,75,4,0


'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  High Scores
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  

	' load em up


	Dim hschecker:hschecker = 0

	Sub Loadhs
		Dim x
		x = LoadValue(TableName, "HighScore1")
		If(x <> "") Then HighScore(0) = CDbl(x) Else HighScore(0) = 1300000 End If

		x = LoadValue(TableName, "HighScore1Name")
		If(x <> "") Then HighScoreName(0) = x Else HighScoreName(0) = "SBW" End If

		x = LoadValue(TableName, "HighScore2")
		If(x <> "") then HighScore(1) = CDbl(x) Else HighScore(1) = 1200000 End If

		x = LoadValue(TableName, "HighScore2Name")
		If(x <> "") then HighScoreName(1) = x Else HighScoreName(1) = "JPS" End If

		x = LoadValue(TableName, "HighScore3")
		If(x <> "") then HighScore(2) = CDbl(x) Else HighScore(2) = 1100000 End If

		x = LoadValue(TableName, "HighScore3Name")
		If(x <> "") then HighScoreName(2) = x Else HighScoreName(2) = "011" End If

		x = LoadValue(TableName, "HighScore4")
		If(x <> "") then HighScore(3) = CDbl(x) Else HighScore(3) = 1000000 End If

		x = LoadValue(TableName, "HighScore4Name")
		If(x <> "") then HighScoreName(3) = x Else HighScoreName(3) = "HJP" End If

		x = LoadValue(TableName, "Credits")
		If(x <> "") then Credits = CInt(x) Else Credits = 0 End If

		x = LoadValue(TableName, "TotalGamesPlayed")
		If(x <> "") then TotalGamesPlayed = CInt(x) Else TotalGamesPlayed = 0 End If

		If hschecker = 0 Then
		checkorder
		End If
	End Sub

	Dim hs3,hs2,hs1,hs0,hsn3,hsn2,hsn1,hsn0


	Sub checkorder
		hschecker = 1
		hs3 = HighScore(3)
		hs2 = HighScore(2)
		hs1 = HighScore(1)
		hs0 = HighScore(0)
		hsn3 = HighScoreName(3)
		hsn2 = HighScoreName(2)
		hsn1 = HighScoreName(1)
		hsn0 = HighScoreName(0)
		If hs3 > hs0 Then
			HighScore(0) = hs3
			HighScoreName(0) = hsn3	
			HighScore(1) = hs0
			HighScoreName(1) = hsn0	
			HighScore(2) = hs1
			HighScoreName(2) = hsn1	
			HighScore(3) = hs2
			HighScoreName(3) = hsn2

		ElseIf hs3 > hs1 Then
			HighScore(0) = hs0
			HighScoreName(0) = hsn0	
			HighScore(1) = hs3
			HighScoreName(1) = hsn3	
			HighScore(2) = hs1
			HighScoreName(2) = hsn1	
			HighScore(3) = hs2
			HighScoreName(3) = hsn2
		ElseIf hs3 > hs2 Then
			HighScore(0) = hs0
			HighScoreName(0) = hsn0	
			HighScore(1) = hs1
			HighScoreName(1) = hsn1	
			HighScore(2) = hs3
			HighScoreName(2) = hsn3	
			HighScore(3) = hs2
			HighScoreName(3) = hsn2
		ElseIf hs3 < hs2 Then
			HighScore(0) = hs0
			HighScoreName(0) = hsn0	
			HighScore(1) = hs1
			HighScoreName(1) = hsn1	
			HighScore(2) = hs2
			HighScoreName(2) = hsn2	
			HighScore(3) = hs3
			HighScoreName(3) = hsn3
		End If

		savehs
	End Sub


	Sub Savehs
		SaveValue TableName, "HighScore1", HighScore(0)
		SaveValue TableName, "HighScore1Name", HighScoreName(0)
		SaveValue TableName, "HighScore2", HighScore(1)
		SaveValue TableName, "HighScore2Name", HighScoreName(1)
		SaveValue TableName, "HighScore3", HighScore(2)
		SaveValue TableName, "HighScore3Name", HighScoreName(2)
		SaveValue TableName, "HighScore4", HighScore(3)
		SaveValue TableName, "HighScore4Name", HighScoreName(3)
	End Sub


	Sub Savegp
		SaveValue TableName, "TotalGamesPlayed", TotalGamesPlayed
		vpmtimer.addtimer 1000, "Loadhs'"
	End Sub


	' Initials

	Dim hsbModeActive:hsbModeActive = False
	Dim hsEnteredName
	Dim hsEnteredDigits(3)
	Dim hsCurrentDigit
	Dim hsValidLetters
	Dim hsCurrentLetter
	Dim hsLetterFlash

	' Check the scores to see if you got one

	Sub CheckHighscore()
		Dim tmp
		tmp = Score(CurrentPlayer)
		osbtempscore = Score(CurrentPlayer)

		If tmp > HighScore(3) Then
			AwardSpecial
			vpmtimer.addtimer 2000, "PlaySound ""vo_contratulationsgreatscore"" '"
			HighScore(3) = tmp
			'enter player's name
			HighScoreEntryInit()
			DOF 403, DOFPulse   'DOF MX - Hi Score
		Else
			osbtemp = osbdefinit
			'if PlayersPlayingGame = 1 Then
			'	playmedia "","videogo",pBackglass,"",14000,"",1,10  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			'end if
			if osbkey="" Then
			Else
			SubmitOSBScore
			end If
			EndOfBallComplete()
		End If
	End Sub





	Sub HighScoreEntryInit()
		hsbModeActive = True
		PlaySound "vo_enteryourinitials"

		hsEnteredDigits(1) = "A"
		hsEnteredDigits(2) = " "
		hsEnteredDigits(3) = " "

		hsCurrentDigit = 1
		'PuPlayer.playlistplayex pCallouts,"audiocallouts","yougotahighscore.mp3",vovol,1
		playmedia "yougotahighscore.mp3","audiocallouts",pCallouts,"",2000,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		'pupDMDDisplay "-","You Got a^High Score",dmdnote,3,0,10
		'chilloutthemusic
		'PuPlayer.playpause 4
		playclear pMusic
		'playmedia "hs.mp3","audiomultiballs",pAudio,"cineon",10000,"",1,0,1  // (name,playlist,channel,cinematic,length,nextitem,audiolevel,priority))
		playmedia "hs.mp3","audiomultiballs",pAudio,"",0,"",1,1

		'playmedia "hs.mp3","audiomultiballs",pAudio,"cineon",10000,"",1,0,1  // (name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		'playmedia "highscore.mp4","videoscenes",pBackglass,0,0,"",1,2
		PuPEvent 800
		'PuPlayer.SetLoop 2,1
		Playsound "knocker"
		HighScoreDisplayName()
		HighScorelabels	
	End Sub

	' flipper moving around the letters

	Sub EnterHighScoreKey(keycode)
		If keycode = LeftFlipperKey Then
			Playsound "fx_Previous"
				If hsletter = 0 Then
					hsletter = 26
				Else
					hsLetter = hsLetter - 1
				End If
				HighScoreDisplayName()
		End If

		If keycode = RightFlipperKey Then
			Playsound "fx_Next"
				If hsletter = 26 Then
					hsletter = 0
				Else
					hsLetter = hsLetter + 1
				End If
				HighScoreDisplayName()
		End If

		If keycode = StartGameKey or keycode = PlungerKey Then
			PlaySound "success"
				If hsCurrentDigit = 3 Then
					If hsletter = 0 Then
						hsCurrentDigit = hsCurrentDigit -1
					Else
						assignletter
						vpmtimer.addtimer 700, "HighScoreCommitName()'"
						playclear pBackglass
					End If
				End If
				If hsCurrentDigit < 3 Then
					If hsletter = 0 Then
						If hsCurrentDigit = 1 Then
						Else
							hsCurrentDigit = hsCurrentDigit -1
						End If
					Else
						assignletter
						hsCurrentDigit = hsCurrentDigit + 1
						HighScoreDisplayName()

					End If
				End If
		End if
	End Sub

	Dim hsletter
	hsletter = 1

	dim hsdigit:hsdigit = 1

	Sub assignletter
		if hscurrentdigit = 1 Then
			hsdigit = 1
		End If
		if hscurrentdigit = 2 Then
			hsdigit = 2
		End If
		if hscurrentdigit = 3 Then
			hsdigit = 3
		End If
		If hsletter = 1 Then 
			hsEnteredDigits(hsdigit) = "A"
		End If
		If hsletter = 2 Then 
			hsEnteredDigits(hsdigit) = "B"
		End If
		If hsletter = 3 Then 
			hsEnteredDigits(hsdigit) = "C"
		End If
		If hsletter = 4 Then 
			hsEnteredDigits(hsdigit) = "D"
		End If
		If hsletter = 5 Then 
			hsEnteredDigits(hsdigit) = "E"
		End If
		If hsletter = 6 Then 
			hsEnteredDigits(hsdigit) = "F"
		End If
		If hsletter = 7 Then 
			hsEnteredDigits(hsdigit) = "G"
		End If
		If hsletter = 8 Then 
			hsEnteredDigits(hsdigit) = "H"
		End If
		If hsletter = 9 Then 
			hsEnteredDigits(hsdigit) = "I"
		End If
		If hsletter = 10 Then 
			hsEnteredDigits(hsdigit) = "J"
		End If
		If hsletter = 11 Then 
			hsEnteredDigits(hsdigit) = "K"
		End If
		If hsletter = 12 Then 
			hsEnteredDigits(hsdigit) = "L"
		End If
		If hsletter = 13 Then 
			hsEnteredDigits(hsdigit) = "M"
		End If
		If hsletter = 14 Then 
			hsEnteredDigits(hsdigit) = "N"
		End If
		If hsletter = 15 Then 
			hsEnteredDigits(hsdigit) = "O"
		End If
		If hsletter = 16 Then 
			hsEnteredDigits(hsdigit) = "P"
		End If
		If hsletter = 17 Then 
			hsEnteredDigits(hsdigit) = "Q"
		End If
		If hsletter = 18 Then 
			hsEnteredDigits(hsdigit) = "R"
		End If
		If hsletter = 19 Then 
			hsEnteredDigits(hsdigit) = "S"
		End If
		If hsletter = 20 Then 
			hsEnteredDigits(hsdigit) = "T"
		End If
		If hsletter = 21 Then 
			hsEnteredDigits(hsdigit) = "U"
		End If
		If hsletter = 22 Then 
			hsEnteredDigits(hsdigit) = "V"
		End If
		If hsletter = 23 Then 
			hsEnteredDigits(hsdigit) = "W"
		End If
		If hsletter = 24 Then 
			hsEnteredDigits(hsdigit) = "X"
		End If
		If hsletter = 25 Then 
			hsEnteredDigits(hsdigit) = "Y"
		End If
		If hsletter = 26 Then 
			hsEnteredDigits(hsdigit) = "Z"
		End If

	End Sub

	Sub HighScorelabels
		PuPlayer.LabelSet pBackglass,"HighScore","",1,"{'mt':2,'color':2697513, 'size': 6, 'xpos': 32.5, 'xalign': 1, 'ypos': 32.8, 'yalign': 1}"
		PuPlayer.LabelSet pBackglass,"HighScoreL1","A",1,"{'mt':2,'color':2697513, 'size': 8, 'xpos': 13.5, 'xalign': 1, 'ypos': 44.8, 'yalign': 1}"
		PuPlayer.LabelSet pBackglass,"HighScoreL2","",1,"{'mt':2,'color':2697513, 'size': 8, 'xpos': 19.5, 'xalign': 1, 'ypos': 44.8, 'yalign': 1}"
		PuPlayer.LabelSet pBackglass,"HighScoreL3","",1,"{'mt':2,'color':2697513, 'size': 8, 'xpos': 25.5, 'xalign': 1, 'ypos': 44.8, 'yalign': 1}"
		PuPlayer.LabelSet pBackglass,"HighScoreL4",Score(CurrentPlayer),1,"{'mt':2,'color':2697513, 'size': 6, 'xpos': 10.5, 'xalign': 0, 'ypos': 58.8, 'yalign': 1}"
		hsletter = 1
	End Sub

	Sub HighScoreDisplayName()

		Select case hsLetter
		Case 0
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","<",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","<",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","<",1,""
		Case 1
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","A",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","A",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","A",1,""
		Case 2
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","B",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","B",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","B",1,""
		Case 3
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","C",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","C",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","C",1,""
		Case 4
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","D",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","D",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","D",1,""
		Case 5
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","E",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","E",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","E",1,""
		Case 6
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","F",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","F",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","F",1,""
		Case 7
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","G",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","G",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","G",1,""
		Case 8
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","H",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","H",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","H",1,""
		Case 9
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","I",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","I",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","I",1,""
		Case 10
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","J",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","J",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","J",1,""
		Case 11
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","K",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","K",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","K",1,""
		Case 12
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","L",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","L",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","L",1,""
		Case 13
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","M",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","M",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","M",1,""
		Case 14
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","N",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","N",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","N",1,""
		Case 15
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","O",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","O",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","O",1,""
		Case 16
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","P",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","P",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","P",1,""
		Case 17
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","Q",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","Q",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","Q",1,""
		Case 18
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","R",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","R",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","R",1,""
		Case 19
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","S",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","S",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","S",1,""
		Case 20
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","T",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","T",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","T",1,""
		Case 21
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","U",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","U",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","U",1,""
		Case 22
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","V",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","V",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","V",1,""
		Case 23
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","W",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","W",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","W",1,""
		Case 24
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","X",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","X",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","X",1,""
		Case 25
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","Y",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","Y",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","Y",1,""
		Case 26
			if(hsCurrentDigit = 1) then PuPlayer.LabelSet pBackglass,"HighScoreL1","Z",1,""
			if(hsCurrentDigit = 2) then PuPlayer.LabelSet pBackglass,"HighScoreL2","Z",1,""
			if(hsCurrentDigit = 3) then PuPlayer.LabelSet pBackglass,"HighScoreL3","Z",1,""
		End Select
	End Sub

	' post the high score letters


	Sub HighScoreCommitName()
		'PuPlayer.playresume 4
		playclear pBackglass
		PuPlayer.SetLoop 2,0
		'PuPlayer.playresume 4
		playbgaudio
		hsEnteredName = hsEnteredDigits(1) & hsEnteredDigits(2) & hsEnteredDigits(3)
		HighScoreName(3) = hsEnteredName
		checkorder
		osbtemp = hsEnteredName
		'	if PlayersPlayingGame = 1 Then
		'		playmedia "","videogo",pBackglass,"",14000,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		'	end if
		if osbkey="" Then
		Else
		SubmitOSBScore
		end If
		EndOfBallComplete()
		PuPlayer.LabelSet pBackglass,"HighScore","",1,""
		PuPlayer.LabelSet pBackglass,"HighScoreL1","",1,""
		PuPlayer.LabelSet pBackglass,"HighScoreL2"," ",1,""
		PuPlayer.LabelSet pBackglass,"HighScoreL3"," ",1,""
		PuPlayer.LabelSet pBackglass,"HighScoreL4"," ",1,""
		hsbModeActive = False
	End Sub



'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  ATTRACT MODE
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 

	Sub StartAttractMode()
		pNote "Game Set","Start Anytime"
		'pupDMDDisplay "-","Game Set^Start Anytime",dmdnote,3,0,10
		cineon =0
		if bBallSaverActive = True then exit sub
		'PuPlayer.playpause 4
		playclear pMusic
		puPlayer.LabelSet pBackglass,"titleimg","",1,"{'mt':2,'color':111111, 'width': 0, 'height': 0, 'yalign': 0}"
		DOF 323, DOFOn   'DOF MX - Attract Mode ON
		bAttractMode = True
		StartLightSeq
		'ShowTableInfo
		DMDintroloop
		StartRainbow alights
		StartRainbow2 GI
		DMDattract.Enabled = 1
		intromover.enabled = true
		ruleshelperon
		'PuPlayer.playlistplayex pMusic,songs,"",sndtrkvol,1
	End Sub

	Sub StopAttractMode()
		pDMDStartGame
		DOF 323, DOFOff   'DOF MX - Attract Mode Off
		bAttractMode = False
		LightSeqAttract.StopPlay
		LightSeqAttract2.StopPlay
		StopRainbow alights
		StopRainbow2 GI
		ResetAllLightsColor
		DMDattract.Enabled = 0
		intromover.enabled = false
		
	'StopSong
	End Sub






'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  LIGHTING / RAINBOW LIGHTS
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 


	'********************************************************************************************
	' Only for VPX 10.2 and higher.
	' FlashForMs will blink light or a flasher for TotalPeriod(ms) at rate of BlinkPeriod(ms)
	' When TotalPeriod done, light or flasher will be set to FinalState value where
	' Final State values are:   0=Off, 1=On, 2=Return to previous State
	'********************************************************************************************

	Sub FlashForMs(MyLight, TotalPeriod, BlinkPeriod, FinalState) 'thanks gtxjoe for the first version

		If TypeName(MyLight) = "Light" Then

			If FinalState = 2 Then
				FinalState = MyLight.State 'Keep the current light state
			End If
			MyLight.BlinkInterval = BlinkPeriod
			MyLight.Duration 2, TotalPeriod, FinalState
		ElseIf TypeName(MyLight) = "Flasher" Then

			Dim steps

			' Store all blink information
			steps = Int(TotalPeriod / BlinkPeriod + .5) 'Number of ON/OFF steps to perform
			If FinalState = 2 Then                      'Keep the current flasher state
				FinalState = ABS(MyLight.Visible)
			End If
			MyLight.UserValue = steps * 10 + FinalState 'Store # of blinks, and final state

			' Start blink timer and create timer subroutine
			MyLight.TimerInterval = BlinkPeriod
			MyLight.TimerEnabled = 0
			MyLight.TimerEnabled = 1
			ExecuteGlobal "Sub " & MyLight.Name & "_Timer:" & "Dim tmp, steps, fstate:tmp=me.UserValue:fstate = tmp MOD 10:steps= tmp\10 -1:Me.Visible = steps MOD 2:me.UserValue = steps *10 + fstate:If Steps = 0 then Me.Visible = fstate:Me.TimerEnabled=0:End if:End Sub"
		End If
	End Sub

	'******************************************
	' Change light color - simulate color leds
	' changes the light color and state
	' 10 colors: red, orange, amber, yellow...
	'******************************************
	' in this table this colors are use to keep track of the progress during the acts and battles

	'colors
	Dim red, orange, amber, yellow, darkgreen, green, blue, darkblue, purple, white, base

	red = 10
	orange = 9
	amber = 8
	yellow = 7
	darkgreen = 6
	green = 5
	blue = 4
	darkblue = 3
	purple = 2
	white = 1
	base = 11


	Sub gicolor(n)
		dim a
		Select Case n
			Case red
				For each a in gi
					a.color = RGB(18, 0, 0)
					a.colorfull = RGB(255, 0, 0)
				next
			Case orange
				For each a in gi
					a.color = RGB(18, 3, 0)
					a.colorfull = RGB(255, 64, 0)
				next
			Case amber
				For each a in gi
				a.color = RGB(193, 49, 0)
				a.colorfull = RGB(255, 153, 0)
				next
			Case yellow
				For each a in gi
				a.color = RGB(18, 18, 0)
				a.colorfull = RGB(255, 255, 0)
				next
			Case darkgreen
				For each a in gi
				a.color = RGB(0, 8, 0)
				a.colorfull = RGB(0, 64, 0)
				next
			Case green
				For each a in gi
				a.color = RGB(0, 18, 0)
				a.colorfull = RGB(0, 255, 0)
				next
			Case blue
				For each a in gi
				a.color = RGB(0, 18, 18)
				a.colorfull = RGB(0, 255, 255)
				next
			Case darkblue
				For each a in gi
				a.color = RGB(0, 8, 8)
				a.colorfull = RGB(0, 64, 64)
				next
			Case purple
				For each a in gi
				a.color = RGB(128, 0, 128)
				a.colorfull = RGB(255, 0, 255)
				next
			Case white
				For each a in gi
				a.color = RGB(255, 252, 224)
				a.colorfull = RGB(193, 91, 0)
				next
			Case base
				For each a in gi
				a.color = RGB(255, 197, 143)
				a.colorfull = RGB(255, 255, 236)
				next
		End Select
	End Sub

	Sub SetLightColor(n, col, stat)
		Select Case col
			Case red
				n.color = RGB(18, 0, 0)
				n.colorfull = RGB(255, 0, 0)
			Case orange
				n.color = RGB(18, 3, 0)
				n.colorfull = RGB(255, 64, 0)
			Case amber
				n.color = RGB(193, 49, 0)
				n.colorfull = RGB(255, 153, 0)
			Case yellow
				n.color = RGB(18, 18, 0)
				n.colorfull = RGB(255, 255, 0)
			Case darkgreen
				n.color = RGB(0, 8, 0)
				n.colorfull = RGB(0, 64, 0)
			Case green
				n.color = RGB(0, 18, 0)
				n.colorfull = RGB(0, 255, 0)
			Case blue
				n.color = RGB(0, 18, 18)
				n.colorfull = RGB(0, 255, 255)
			Case darkblue
				n.color = RGB(0, 8, 8)
				n.colorfull = RGB(0, 64, 64)
			Case purple
				n.color = RGB(128, 0, 128)
				n.colorfull = RGB(255, 0, 255)
			Case white
				n.color = RGB(255, 252, 224)
				n.colorfull = RGB(193, 91, 0)
			Case white
				n.color = RGB(255, 252, 224)
				n.colorfull = RGB(193, 91, 0)
			Case base
				n.color = RGB(255, 197, 143)
				n.colorfull = RGB(255, 255, 236)
		End Select
		If stat <> -1 Then
			n.State = 0
			n.State = stat
		End If
	End Sub

	Sub ResetAllLightsColor ' Called at a new game
		SetLightColor s14, white, -1

		'dragon light red
		SetLightColor s41, red, -1
		SetLightColor s23, red, -1
		SetLightColor t33, red, -1
		SetLightColor t34, red, -1
		SetLightColor t35, red, -1
		SetLightColor t36, red, -1
		SetLightColor t37, red, -1
		
	End Sub

	Sub UpdateBonusColors
	End Sub

	'*************************
	' Rainbow Changing Lights
	'*************************

	Dim RGBStep, RGBFactor, rRed, rGreen, rBlue, RainbowLights

	Sub StartRainbow(n)
		set RainbowLights = n
		RGBStep = 0
		RGBFactor = 5
		rRed = 255
		rGreen = 0
		rBlue = 0
		RainbowTimer.Enabled = 1
	End Sub

	Dim RGBStep2, RGBFactor2, rRed2, rGreen2, rBlue2, RainbowLights2
	Sub StartRainbow2(n)
		set RainbowLights2 = n
		RGBStep2 = 0
		RGBFactor2 = 5
		rRed2 = 255
		rGreen2 = 0
		rBlue2 = 0
		RainbowTimer1.Enabled = 1
	End Sub

	Sub StopRainbow(n)
		Dim obj
		RainbowTimer.Enabled = 0
		RainbowTimer.Enabled = 0
			For each obj in RainbowLights
				SetLightColor obj, "white", 0
			Next
	End Sub

	Sub StopRainbow2(n)
		Dim obj
		RainbowTimer1.Enabled = 0
			For each obj in RainbowLights2
				SetLightColor obj, "white", 0
				obj.state = 1
				obj.Intensity = 15
			Next
	End Sub

	Sub RainbowTimer_Timer 'rainbow led light color changing
		Dim obj
		Select Case RGBStep
			Case 0 'Green
				rGreen = rGreen + RGBFactor
				If rGreen > 255 then
					rGreen = 255
					RGBStep = 1
				End If
			Case 1 'Red
				rRed = rRed - RGBFactor
				If rRed < 0 then
					rRed = 0
					RGBStep = 2
				End If
			Case 2 'Blue
				rBlue = rBlue + RGBFactor
				If rBlue > 255 then
					rBlue = 255
					RGBStep = 3
				End If
			Case 3 'Green
				rGreen = rGreen - RGBFactor
				If rGreen < 0 then
					rGreen = 0
					RGBStep = 4
				End If
			Case 4 'Red
				rRed = rRed + RGBFactor
				If rRed > 255 then
					rRed = 255
					RGBStep = 5
				End If
			Case 5 'Blue
				rBlue = rBlue - RGBFactor
				If rBlue < 0 then
					rBlue = 0
					RGBStep = 0
				End If
		End Select
			For each obj in RainbowLights
				obj.color = RGB(rRed \ 10, rGreen \ 10, rBlue \ 10)
				obj.colorfull = RGB(rRed, rGreen, rBlue)
			Next
	End Sub

	Sub RainbowTimer1_Timer 'rainbow led light color changing
		Dim obj
		Select Case RGBStep2
			Case 0 'Green
				rGreen2 = rGreen2 + RGBFactor2
				If rGreen2 > 255 then
					rGreen2 = 255
					RGBStep2 = 1
				End If
			Case 1 'Red
				rRed2 = rRed2 - RGBFactor2
				If rRed2 < 0 then
					rRed2 = 0
					RGBStep2 = 2
				End If
			Case 2 'Blue
				rBlue2 = rBlue2 + RGBFactor2
				If rBlue2 > 255 then
					rBlue2 = 255
					RGBStep2 = 3
				End If
			Case 3 'Green
				rGreen2 = rGreen2 - RGBFactor2
				If rGreen2 < 0 then
					rGreen2 = 0
					RGBStep2 = 4
				End If
			Case 4 'Red
				rRed2 = rRed2 + RGBFactor2
				If rRed2 > 255 then
					rRed2 = 255
					RGBStep2 = 5
				End If
			Case 5 'Blue
				rBlue2 = rBlue2 - RGBFactor2
				If rBlue2 < 0 then
					rBlue2 = 0
					RGBStep2 = 0
				End If
		End Select
			For each obj in RainbowLights2
				obj.color = RGB(rRed2 \ 10, rGreen2 \ 10, rBlue2 \ 10)
				obj.colorfull = RGB(rRed2, rGreen2, rBlue2)
			Next
	End Sub


	Sub StartLightSeq()
		On Error Resume Next
		Dim a
		For each a in alights
			a.State = 1
		Next
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqUpOn, 50, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqDownOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqCircleOutOn, 15, 2
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqUpOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqDownOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqUpOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqDownOn, 25, 1
		LightSeqAttract.UpdateInterval = 10
		LightSeqAttract.Play SeqCircleOutOn, 15, 3
		LightSeqAttract.UpdateInterval = 5
		LightSeqAttract.Play SeqRightOn, 50, 1
		LightSeqAttract.UpdateInterval = 5
		LightSeqAttract.Play SeqLeftOn, 50, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqRightOn, 50, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqLeftOn, 50, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqRightOn, 40, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqLeftOn, 40, 1
		LightSeqAttract.UpdateInterval = 10
		LightSeqAttract.Play SeqRightOn, 30, 1
		LightSeqAttract.UpdateInterval = 10
		LightSeqAttract.Play SeqLeftOn, 30, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqRightOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqLeftOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqRightOn, 15, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqLeftOn, 15, 1
		LightSeqAttract.UpdateInterval = 10
		LightSeqAttract.Play SeqCircleOutOn, 15, 3
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqLeftOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqRightOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqLeftOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqUpOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqDownOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqUpOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqDownOn, 25, 1
		LightSeqAttract.UpdateInterval = 5
		LightSeqAttract.Play SeqStripe1VertOn, 50, 2
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqCircleOutOn, 15, 2
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqStripe1VertOn, 50, 3
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqLeftOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqRightOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqLeftOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqUpOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqDownOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqCircleOutOn, 15, 2
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqStripe2VertOn, 50, 3
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqLeftOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqRightOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqLeftOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqUpOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqDownOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqUpOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqDownOn, 25, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqStripe1VertOn, 25, 3
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqStripe2VertOn, 25, 3
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqUpOn, 15, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqDownOn, 15, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqUpOn, 15, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqDownOn, 15, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqUpOn, 15, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqDownOn, 15, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqRightOn, 15, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqLeftOn, 15, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqRightOn, 15, 1
		LightSeqAttract.UpdateInterval = 8
		LightSeqAttract.Play SeqLeftOn, 15, 1
		For each a in GI
			a.State = 1
			a.Intensity = 80
		Next
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqUpOn, 50, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqDownOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqCircleOutOn, 15, 2
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqUpOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqDownOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqUpOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqDownOn, 25, 1
		LightSeqAttract2.UpdateInterval = 10
		LightSeqAttract2.Play SeqCircleOutOn, 15, 3
		LightSeqAttract2.UpdateInterval = 5
		LightSeqAttract2.Play SeqRightOn, 50, 1
		LightSeqAttract2.UpdateInterval = 5
		LightSeqAttract2.Play SeqLeftOn, 50, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqRightOn, 50, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqLeftOn, 50, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqRightOn, 40, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqLeftOn, 40, 1
		LightSeqAttract2.UpdateInterval = 10
		LightSeqAttract2.Play SeqRightOn, 30, 1
		LightSeqAttract2.UpdateInterval = 10
		LightSeqAttract2.Play SeqLeftOn, 30, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqRightOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqLeftOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqRightOn, 15, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqLeftOn, 15, 1
		LightSeqAttract2.UpdateInterval = 10
		LightSeqAttract2.Play SeqCircleOutOn, 15, 3
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqLeftOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqRightOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqLeftOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqUpOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqDownOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqUpOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqDownOn, 25, 1
		LightSeqAttract2.UpdateInterval = 5
		LightSeqAttract2.Play SeqStripe1VertOn, 50, 2
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqCircleOutOn, 15, 2
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqStripe1VertOn, 50, 3
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqLeftOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqRightOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqLeftOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqUpOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqDownOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqCircleOutOn, 15, 2
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqStripe2VertOn, 50, 3
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqLeftOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqRightOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqLeftOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqUpOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqDownOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqUpOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqDownOn, 25, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqStripe1VertOn, 25, 3
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqStripe2VertOn, 25, 3
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqUpOn, 15, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqDownOn, 15, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqUpOn, 15, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqDownOn, 15, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqUpOn, 15, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqDownOn, 15, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqRightOn, 15, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqLeftOn, 15, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqRightOn, 15, 1
		LightSeqAttract2.UpdateInterval = 8
		LightSeqAttract2.Play SeqLeftOn, 15, 1
	End Sub

	Sub LightSeqAttract_PlayDone()
		StartLightSeq()
	End Sub

	Sub LightSeqTilt_PlayDone()
		LightSeqTilt.Play SeqAllOff
	End Sub

	Sub LightSeqSkillshot_PlayDone()
		LightSeqSkillshot.Play SeqAllOff
	End Sub



	'**********************
	'     GI effects
	' independent routine
	' it turns on the gi
	' when there is a ball
	' in play
	'**********************

	Dim OldGiState
	OldGiState = -1   'start witht the Gi off

	Sub ChangeGi(col) 'changes the gi color
		Dim bulb
		For each bulb in GI
			SetLightColor bulb, col, -1
		Next
	End Sub

	Sub GIUpdateTimer_Timer
		Dim tmp, obj
		tmp = Getballs
		If UBound(tmp) <> OldGiState Then
			OldGiState = Ubound(tmp)
			If UBound(tmp) = 3 Then 'we have 4 captive balls on the table (-1 means no balls, 0 is the first ball, 1 is the second..)
				'GiOff               ' turn off the gi if no active balls on the table, we could also have used the variable ballsonplayfield.
			Else
				'Gion
			End If
		End If
	End Sub

	sub giflashing
		Dim bulb
		For each bulb in GI
			SetLightColor bulb, base, -1
			bulb.State = 1
			bulb.intensity = gibase
		Next
	end Sub

	dim gistatus:gistatus = 0
	Sub GiOn
		spotson
		gistatus = 1
		GI_On_DOF_Undercab
		Dim bulb
		For each bulb in GI
			SetLightColor bulb, base, -1
			bulb.State = 1
			bulb.intensity = gibase
		Next
		bumpl1a.intensity = 15
		bumpl2a.intensity = 15
		bumpl3a.intensity = 15
		bumpl4a.intensity = 15
		bumpl1b.intensity = 10
		bumpl2b.intensity = 10
		bumpl3b.intensity = 10
		bumpl4b.intensity = 10
	End Sub

	Sub GiOff
		gistatus = 0
		GI_Off_DOF_Undercab
		Dim bulb
		For each bulb in GI
			bulb.State = 0
		Next
		spotsoff
	End Sub

	dim spotstatus:spotstatus = 0
	sub spotson
		spotstatus = 1
		spotleft.opacity = 300
		spotright.opacity = 300
	end Sub

	sub spotsoff
		spotstatus = 0
		spotleft.opacity = 0
		spotright.opacity = 0
	end Sub


	' GI & light sequence effects


	Sub GiEffect(n)
		Select Case n
			Case 0 'all off
				'LightSeqGi.Play SeqAlloff
			Case 1 'all blink
				'LightSeqGi.UpdateInterval = 4
				'LightSeqGi.Play SeqBlinking, , 5, 100
			Case 2 'random
				'LightSeqGi.UpdateInterval = 10
				'LightSeqGi.Play SeqRandom, 5, , 1000
			Case 3 'upon
				'LightSeqGi.UpdateInterval = 4
				'LightSeqGi.Play SeqUpOn, 5, 1
			Case 4 ' left-right-left
				'LightSeqGi.UpdateInterval = 5
				'LightSeqGi.Play SeqLeftOn, 10, 1
				'LightSeqGi.UpdateInterval = 5
				'LightSeqGi.Play SeqRightOn, 10, 1
		End Select
	End Sub

	Sub LightEffect(n)
		Select Case n
			Case 0 ' all off
				'LightSeqInserts.Play SeqAlloff
			Case 1 'all blink
				'LightSeqInserts.UpdateInterval = 4
				'LightSeqInserts.Play SeqBlinking, , 5, 100
			Case 2 'random
				'LightSeqInserts.UpdateInterval = 10
				'LightSeqInserts.Play SeqRandom, 5, , 1000
			Case 3 'upon
				'LightSeqInserts.UpdateInterval = 4
				'LightSeqInserts.Play SeqUpOn, 10, 1
			Case 4 ' left-right-left
				'LightSeqInserts.UpdateInterval = 5
				'LightSeqInserts.Play SeqLeftOn, 10, 1
				'LightSeqInserts.UpdateInterval = 5
				'LightSeqInserts.Play SeqRightOn, 10, 1
			Case 5 'random
				'LightSeqbumper.UpdateInterval = 4
				'LightSeqbumper.Play SeqBlinking, , 5, 10
			Case 6 'random
				'LightSeqRSling.UpdateInterval = 4
				'LightSeqRSling.Play SeqBlinking, , 5, 6
			Case 7 'random
				'LightSeqLSling.UpdateInterval = 4
				'LightSeqLSling.Play SeqBlinking, , 5, 6
			Case 8 'random
				'LightSeqBack.UpdateInterval = 4
				'LightSeqBack.Play SeqBlinking, , 5, 6
			Case 12 'random
				'LightSeqlr.UpdateInterval = 4
				'LightSeqlr.Play SeqBlinking, , 5, 10
		End Select
	End Sub

	' Flasher Effects using lights

	Dim FEStep, FEffect
	FEStep = 0
	FEffect = 0

	Sub FlashEffect(n)
		Select case n
			Case 0 ' all off
				LightSeqFlasher.Play SeqAlloff
			Case 1 'all blink
				LightSeqFlasher.UpdateInterval = 4
				LightSeqFlasher.Play SeqBlinking, , 5, 100
			Case 2 'random
				LightSeqFlasher.UpdateInterval = 10
				LightSeqFlasher.Play SeqRandom, 5, , 1000
			Case 3 'upon
				LightSeqFlasher.UpdateInterval = 4
				LightSeqFlasher.Play SeqUpOn, 10, 1
			Case 4 ' left-right-left
				LightSeqFlasher.UpdateInterval = 5
				LightSeqFlasher.Play SeqLeftOn, 10, 1
				LightSeqFlasher.UpdateInterval = 5
				LightSeqFlasher.Play SeqRightOn, 10, 1
			Case 5 ' top flashers blink fast
		End Select
	End Sub







	'****************************
	' Flashers - Thanks Flupper
	'****************************

	Dim FlashLevel1, FlashLevel2, FlashLevel3, FlashLevel4, FlashLevel5, FlashLevel6
	Flasherlight1.IntensityScale = 0
	Flasherlight2.IntensityScale = 0
	Flasherlight3.IntensityScale = 0
	Flasherlight4.IntensityScale = 0
	Flasherlight5.IntensityScale = 0
	Flasherlight6.IntensityScale = 0

	'*** lower right rbg flasher ***
	Sub Flasherflash1_Timer()
		On Error Resume Next
		dim flashx3, matdim
		If not Flasherflash1.TimerEnabled Then 
			Flasherflash1.TimerEnabled = True
			Flasherflash1.visible = 1
			Flasherlit1.visible = 1
		End If
		flashx3 = FlashLevel1 * FlashLevel1 * FlashLevel1
		Flasherflash1.opacity = 1500 * flashx3
		Flasherlit1.BlendDisableLighting = 10 * flashx3
		Flasherbase1.BlendDisableLighting =  flashx3
		Flasherlight1.IntensityScale = flashx3
		matdim = Round(10 * FlashLevel1)
		Flasherlit1.material = "domelit" & matdim
		FlashLevel1 = FlashLevel1 * 0.9 - 0.01
		If FlashLevel1 < 0.15 Then
			Flasherlit1.visible = 0
		Else
			Flasherlit1.visible = 1
			DOF 340, DOFPulse 'Green Flasher
		end If
		If FlashLevel1 < 0 Then
			Flasherflash1.TimerEnabled = False
			Flasherflash1.visible = 0
		End If
	End Sub'

	'*** middle right rbg flasher ***
	Sub Flasherflash2_Timer()
		On Error Resume Next
		dim flashx3, matdim
		If not Flasherflash2.TimerEnabled Then 
			Flasherflash2.TimerEnabled = True
			Flasherflash2.visible = 1
			Flasherlit2.visible = 1
		End If
		flashx3 = FlashLevel2 * FlashLevel2 * FlashLevel2
		Flasherflash2.opacity = 1500 * flashx3
		Flasherlit2.BlendDisableLighting = 10 * flashx3
		Flasherbase2.BlendDisableLighting =  flashx3
		Flasherlight2.IntensityScale = flashx3
		matdim = Round(10 * FlashLevel2)
		Flasherlit2.material = "domelit" & matdim
		FlashLevel2 = FlashLevel2 * 0.9 - 0.01
		If FlashLevel2 < 0.15 Then
			Flasherlit2.visible = 0
		Else
			Flasherlit2.visible = 1
		end If
		If FlashLevel2 < 0 Then
			Flasherflash2.TimerEnabled = False
			Flasherflash2.visible = 0
		End If
	End Sub

	'*** left kicker rbg flasher ***
	Sub Flasherflash3_Timer()
		On Error Resume Next
		dim flashx3, matdim
		If not Flasherflash3.TimerEnabled Then 
			Flasherflash3.TimerEnabled = True
			Flasherflash3.visible = 1
			Flasherlit3.visible = 1
		End If
		flashx3 = FlashLevel3 * FlashLevel3 * FlashLevel3
		Flasherflash3.opacity = 1500 * flashx3
		Flasherlit3.BlendDisableLighting = 10 * flashx3
		Flasherbase3.BlendDisableLighting =  flashx3
		Flasherlight3.IntensityScale = flashx3
		matdim = Round(10 * FlashLevel3)
		Flasherlit3.material = "domelit" & matdim
		FlashLevel3 = FlashLevel3 * 0.9 - 0.01
		If FlashLevel3 < 0.15 Then
			Flasherlit3.visible = 0
		Else
			Flasherlit3.visible = 1
			DOF 342, DOFPulse 'Red Flasher
		end If
		If FlashLevel3 < 0 Then
			Flasherflash3.TimerEnabled = False
			Flasherflash3.visible = 0
		End If
	End Sub

	'*** center rbg flasher ***
	Sub Flasherflash4_Timer()
		On Error Resume Next
		dim flashx3, matdim
		If not Flasherflash4.TimerEnabled Then 
			Flasherflash4.TimerEnabled = True
			Flasherflash4.visible = 1
			Flasherlit4.visible = 1
		End If
		flashx3 = FlashLevel4 * FlashLevel4 * FlashLevel4
		Flasherflash4.opacity = 1500 * flashx3
		Flasherlit4.BlendDisableLighting = 10 * flashx3
		Flasherbase4.BlendDisableLighting =  flashx3
		Flasherlight4.IntensityScale = flashx3
		matdim = Round(10 * FlashLevel4)
		Flasherlit4.material = "domelit" & matdim
		FlashLevel4 = FlashLevel4 * 0.9 - 0.01
		If FlashLevel4 < 0.15 Then
			Flasherlit4.visible = 0
		Else
			Flasherlit4.visible = 1
			DOF 343, DOFPulse 'White Flasher
		end If
		If FlashLevel4 < 0 Then
			Flasherflash4.TimerEnabled = False
			Flasherflash4.visible = 0
		End If
	End Sub

	'*** top right rbg flasher ***
	Sub Flasherflash5_Timer()
		On Error Resume Next
		dim flashx3, matdim
		If not Flasherflash5.TimerEnabled Then 
			Flasherflash5.TimerEnabled = True
			Flasherflash5.visible = 1
			Flasherlit5.visible = 1
		End If
		flashx3 = FlashLevel5 * FlashLevel5 * FlashLevel5
		Flasherflash5.opacity = 1500 * flashx3
		Flasherlit5.BlendDisableLighting = 10 * flashx3
		Flasherbase5.BlendDisableLighting =  flashx3
		Flasherlight5.IntensityScale = flashx3
		matdim = Round(10 * FlashLevel5)
		Flasherlit5.material = "domelit" & matdim
		FlashLevel5 = FlashLevel5 * 0.9 - 0.01
		If FlashLevel5 < 0.15 Then
			Flasherlit5.visible = 0
		Else
			Flasherlit5.visible = 1
			DOF 344, DOFPulse 'Blue Flasher
		end If
		If FlashLevel5 < 0 Then
			Flasherflash5.TimerEnabled = False
			Flasherflash5.visible = 0
		End If
	End Sub


	'*** top right rbg flasher ***
	Sub Flasherflash6_Timer()
		On Error Resume Next
		dim flashx3, matdim
		If not Flasherflash6.TimerEnabled Then 
			Flasherflash6.TimerEnabled = True
			Flasherflash6.visible = 1
			Flasherlit6.visible = 1
		End If
		flashx3 = FlashLevel6 * FlashLevel6 * FlashLevel6
		Flasherflash6.opacity = 1500 * flashx3
		Flasherlit6.BlendDisableLighting = 10 * flashx3
		Flasherbase6.BlendDisableLighting =  flashx3
		Flasherlight6.IntensityScale = flashx3
		matdim = Round(10 * FlashLevel6)
		Flasherlit6.material = "domelit" & matdim
		FlashLevel6 = FlashLevel6 * 0.9 - 0.01
		If FlashLevel6 < 0.15 Then
			Flasherlit6.visible = 0
		Else
			Flasherlit6.visible = 1
			DOF 345, DOFPulse 'Pink Flasher
		end If
		If FlashLevel6 < 0 Then
			Flasherflash6.TimerEnabled = False
			Flasherflash6.visible = 0
		End If
	End Sub




	flasherseq.enabled = 0
	dim flasherpos:flasherpos = 0
	dim flasherdir:flasherdir = "left"


	'flasherspop orange,"right"

	Sub flasherspop(n,x)
		On Error Resume Next
		flasherpos = 0
		dim a
		flasherdir = x
		flasherseq.enabled = 1
		for each a in  flasherlights
			SetLightColor a, n, -1
		Next
	End Sub

	Sub flasherseq_timer
		On Error Resume Next
		flasherpos = flasherpos + 1
		If flasherdir = "left" Then
			select case flasherpos
				case 1
					FlashLevel3 = 1 : Flasherflash3_Timer
				case 2
					FlashLevel4 = 1 : Flasherflash4_Timer
				case 3
					FlashLevel5 = 1 : Flasherflash5_Timer
				case 4
					FlashLevel6 = 1 : Flasherflash6_Timer
				case 5
					FlashLevel2 = 1 : Flasherflash2_Timer
				case 6
					FlashLevel1 = 1 : Flasherflash1_Timer
				case 7
					FlashLevel3 = 1 : Flasherflash3_Timer
				case 8
					FlashLevel4 = 1 : Flasherflash4_Timer
				case 9
					FlashLevel5 = 1 : Flasherflash5_Timer
				case 10
					FlashLevel6 = 1 : Flasherflash6_Timer
				case 11
					FlashLevel2 = 1 : Flasherflash2_Timer
				case 12
					FlashLevel1 = 1 : Flasherflash1_Timer
					flasherseq.enabled = 0
					flasherpos = 0
			end Select
		End If

		If flasherdir = "right" Then
			select case flasherpos
				case 1
					FlashLevel1 = 1 : Flasherflash1_Timer
				case 2
					FlashLevel2 = 1 : Flasherflash2_Timer
				case 3
					FlashLevel6 = 1 : Flasherflash6_Timer
				case 4
					FlashLevel5 = 1 : Flasherflash5_Timer
				case 5
					FlashLevel4 = 1 : Flasherflash4_Timer
				case 6
					FlashLevel3 = 1 : Flasherflash3_Timer
				case 7
					FlashLevel1 = 1 : Flasherflash1_Timer
				case 8
					FlashLevel2 = 1 : Flasherflash2_Timer
				case 9
					FlashLevel6 = 1 : Flasherflash6_Timer
				case 10
					FlashLevel5 = 1 : Flasherflash5_Timer
				case 11
					FlashLevel4 = 1 : Flasherflash4_Timer
				case 11
					FlashLevel3 = 1 : Flasherflash3_Timer
					flasherseq.enabled = 0
					flasherpos = 0
			end Select
		End If

		If flasherdir = "bottom" Then
			select case flasherpos
				case 1
					FlashLevel1 = 1 : Flasherflash1_Timer
					FlashLevel2 = 1 : Flasherflash2_Timer

				case 4
					FlashLevel1 = 1 : Flasherflash1_Timer
					FlashLevel2 = 1 : Flasherflash2_Timer

				case 7
					FlashLevel1 = 1 : Flasherflash1_Timer
					FlashLevel2 = 1 : Flasherflash2_Timer

				case 10
					FlashLevel1 = 1 : Flasherflash1_Timer
					FlashLevel2 = 1 : Flasherflash2_Timer
					flasherseq.enabled = 0
					flasherpos = 0
			end Select
		End If

		If flasherdir = "leftkick" Then
			select case flasherpos
				case 1
					'FlashLevel3 = 1 : Flasherflash3_Timer

				case 4
					FlashLevel3 = 1 : Flasherflash3_Timer

				case 7
					FlashLevel3 = 1 : Flasherflash3_Timer

				case 10
					FlashLevel3 = 1 : Flasherflash3_Timer
					flasherseq.enabled = 0
					flasherpos = 0
			end Select
		End If

		If flasherdir = "rightkick" Then
			select case flasherpos
				case 1
					'FlashLevel3 = 1 : Flasherflash3_Timer

				case 4
					FlashLevel6 = 1 : Flasherflash6_Timer

				case 7
					FlashLevel6 = 1 : Flasherflash6_Timer

				case 10
					FlashLevel6 = 1 : Flasherflash6_Timer
					flasherseq.enabled = 0
					flasherpos = 0
			end Select
		End If

		If flasherdir = "top" Then
			select case flasherpos
				case 1
					FlashLevel3 = 1 : Flasherflash3_Timer
					FlashLevel4 = 1 : Flasherflash4_Timer
					FlashLevel5 = 1 : Flasherflash5_Timer
					FlashLevel6 = 1 : Flasherflash6_Timer

				case 4
					FlashLevel3 = 1 : Flasherflash3_Timer
					FlashLevel4 = 1 : Flasherflash4_Timer
					FlashLevel5 = 1 : Flasherflash5_Timer
					FlashLevel6 = 1 : Flasherflash6_Timer

				case 7
					FlashLevel3 = 1 : Flasherflash3_Timer
					FlashLevel4 = 1 : Flasherflash4_Timer
					FlashLevel5 = 1 : Flasherflash5_Timer
					FlashLevel6 = 1 : Flasherflash6_Timer

				case 10
					FlashLevel3 = 1 : Flasherflash3_Timer
					FlashLevel4 = 1 : Flasherflash4_Timer
					FlashLevel5 = 1 : Flasherflash5_Timer
					FlashLevel6 = 1 : Flasherflash6_Timer
					flasherseq.enabled = 0
					flasherpos = 0
			end Select
		End If

		If flasherdir = "crazy" Then
			select case flasherpos
				case 1
					FlashLevel1 = 1 : Flasherflash1_Timer
					FlashLevel3 = 1 : Flasherflash3_Timer
					FlashLevel6 = 1 : Flasherflash6_Timer
				case 2
					FlashLevel2 = 1 : Flasherflash2_Timer
					FlashLevel5 = 1 : Flasherflash5_Timer
				case 3
					FlashLevel5 = 1 : Flasherflash5_Timer
					FlashLevel1 = 1 : Flasherflash1_Timer
				case 4
					FlashLevel4 = 1 : Flasherflash4_Timer
					FlashLevel6 = 1 : Flasherflash6_Timer
				case 5
					FlashLevel3 = 1 : Flasherflash3_Timer
					FlashLevel2 = 1 : Flasherflash2_Timer
				case 6
					FlashLevel1 = 1 : Flasherflash1_Timer
					FlashLevel4 = 1 : Flasherflash4_Timer
				case 7
					FlashLevel2 = 1 : Flasherflash2_Timer
				case 8
					FlashLevel5 = 1 : Flasherflash5_Timer
					FlashLevel6 = 1 : Flasherflash6_Timer
				case 9
					FlashLevel4 = 1 : Flasherflash4_Timer
					FlashLevel2 = 1 : Flasherflash2_Timer
				case 10
					FlashLevel3 = 1 : Flasherflash3_Timer
					FlashLevel5 = 1 : Flasherflash5_Timer
				case 11
					FlashLevel1 = 1 : Flasherflash1_Timer
					FlashLevel3 = 1 : Flasherflash3_Timer
				case 12
					FlashLevel2 = 1 : Flasherflash2_Timer
					FlashLevel5 = 1 : Flasherflash5_Timer
					FlashLevel6 = 1 : Flasherflash6_Timer
				case 13
					FlashLevel5 = 1 : Flasherflash5_Timer
					FlashLevel1 = 1 : Flasherflash1_Timer
				case 14
					FlashLevel4 = 1 : Flasherflash4_Timer
				case 15
					FlashLevel3 = 1 : Flasherflash3_Timer
					FlashLevel2 = 1 : Flasherflash2_Timer
					FlashLevel6 = 1 : Flasherflash6_Timer
					flasherseq.enabled = 0
					flasherpos = 0
			end Select
		End If
	end Sub
		





'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'   SCORING FUNCTIONS
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  

	Sub AddScore(points)
		If(Tilted = False) Then
			' add the points to the current players score variable	
			dim dubpnts
			if awamor = 1 Then
				dubpnts = points * 2
				Score(CurrentPlayer) = Score(CurrentPlayer) + dubpnts
			elseif confus = 1 Then
				dubpnts = points * 3
				Score(CurrentPlayer) = Score(CurrentPlayer) + dubpnts
			else
				Score(CurrentPlayer) = Score(CurrentPlayer) + points
			end if
		End if
	End Sub

	sub scoretimer_timer
			pUpdateScores
	end Sub

	Sub AddPoints(points)
		If(Tilted = False) Then
			' add the points to the current players score variable
			Select Case points
			Case 1
				Score(CurrentPlayer) = Score(CurrentPlayer) + 1000
			Case 2
				Score(CurrentPlayer) = Score(CurrentPlayer) + 10000
			Case 3
				Score(CurrentPlayer) = Score(CurrentPlayer) + 50000
			Case 4
				Score(CurrentPlayer) = Score(CurrentPlayer) + 100000
			Case 5
				Score(CurrentPlayer) = Score(CurrentPlayer) + 200000
			Case 6
				Score(CurrentPlayer) = Score(CurrentPlayer) + 500000
			Case 7
				Score(CurrentPlayer) = Score(CurrentPlayer) + 1000000
			Case 8
				Score(CurrentPlayer) = Score(CurrentPlayer) + 2000000
			Case 9
				Score(CurrentPlayer) = Score(CurrentPlayer) + 5000000
			Case 10
				Score(CurrentPlayer) = Score(CurrentPlayer) + 10000000
			End Select
		End if
	End Sub

	Sub AwardExtraBall()
		If NOT bExtraBallWonThisBall Then
			t1.State = 1
			flashflash.Enabled = True
			LightSeqFlasher.UpdateInterval = 150
			LightSeqFlasher.Play SeqRandom, 10, , 10000
			ExtraBallsAwards(CurrentPlayer) = ExtraBallsAwards(CurrentPlayer) + 1
			bExtraBallWonThisBall = True
			DOF 402, DOFPulse   'DOF MX - Extra Ball
			'extraballready(CurrentPlayer) = 0
			If bMultiBallMode = false Then
			'pNote "Extra","Ball!"
			'PuPlayer.playlistplayex pBackglass,"videoextraball","extraballsm.mov",100,1
			'PuPlayer.playlistplayex pCallouts,"audiocallouts","extra ball.wav",vovol,1
			'chilloutthemusic
			End If
		Else
		AddScore 4000000
		END If
	End Sub

	Sub AwardSpecial()
		Credits = Credits + 1
		DOF 140, DOFOn
		PlaySound SoundFXDOF("knocker",136,DOFPulse,DOFKnocker)		
		DOF 115, DOFPulse 'Strobe
		GiEffect 1
		LightEffect 1
		DOF 400, DOFPulse   'DOF MX - Special
	End Sub



'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'   Background Audio
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  


	sub playbgaudio
		debug.print "playbgaudio "
		dim trkpik
		if sndtrk = 1 Then
			trkpik=RndNum(1,4)
			select case trkpik
				case 1:playmedia "01. The Story Continues.mp3",songs,pMusic,"",0,"",1,11
				case 2:playmedia "05. Foreign Visitors Arrive.mp3",songs,pMusic,"",0,"",1,11
				case 3:playmedia "14. Underwater Secrets.mp3",songs,pMusic,"",0,"",1,11
				case 4:playmedia "harry sees dragons.mp3",songs,pMusic,"",0,"",1,11
			end Select
		Else
			trkpik=RndNum(1,29)
			select case trkpik
				case 1:playmedia "Art Brut - Emily Kane.mp3",songs,pMusic,"",0,"",1,10
				case 2:playmedia "Belle And Sebastian - Get Me Away From Here I Am Dying.mp3",songs,pMusic,"",0,"",1,10
				case 3:playmedia "James - She's a star.mp3",songs,pMusic,"",0,"",1,10
				case 4:playmedia "Depeche Mode - Enjoy The Silence (Lyrics on Screen) [HD].mp3",songs,pMusic,"",0,"",1,10
				case 5:playmedia "Oasis - Wonderwall (Official Video).mp3",songs,pMusic,"",0,"",1,10
				case 6:playmedia "Feeder - High.mp3",songs,pMusic,"",0,"",1,10
				case 7:playmedia "Franz Ferdinand - Take Me Out.mp3",songs,pMusic,"",0,"",1,10
				case 8:playmedia "James - She's a star.mp3",songs,pMusic,"",0,"",1,10
				case 9:playmedia "Keane - Somewhere Only We Know (Official Music Video).mp3",songs,pMusic,"",0,"",1,10
				case 10:playmedia "Nada Surf - Happy kid & lyrics.mp3",songs,pMusic,"",0,"",1,10
				case 11:playmedia "Oasis   Don't look back in anger _ Canon in D _ Lyrics.mp3",songs,pMusic,"",0,"",1,10
				case 12:playmedia "Primitive Radio Gods - Standing Outside A Broken Phone Booth With Money In My Hand.mp3",songs,pMusic,"",0,"",1,10
				case 13:playmedia "Oasis - Wonderwall (Official Video).mp3",songs,pMusic,"",0,"",1,10
				case 14:playmedia "Primitive Radio Gods - Standing Outside A Broken Phone Booth With Money In My Hand.mp3",songs,pMusic,"",0,"",1,10
				case 15:playmedia "Radiohead - 02 The Bends.mp3",songs,pMusic,"",0,"",1,10
				case 16:playmedia "Radiohead - High & Dry.mp3",songs,pMusic,"",0,"",1,10
				case 17:playmedia "radiohead_-_karma-police.mp3",songs,pMusic,"",0,"",1,10
				case 18:playmedia "Stereo MC's  ?Connected_.mp3",songs,pMusic,"",0,"",1,10
				case 19:playmedia "Supergrass - Alright.mp3",songs,pMusic,"",0,"",1,10
				case 20:playmedia "The Beta Band - She's the One.mp3",songs,pMusic,"",0,"",1,10
				case 21:playmedia "The Breeders - Cannonball.mp3",songs,pMusic,"",0,"",1,10
				case 22:playmedia "The Coral - Dreaming Of You HQ.mp3",songs,pMusic,"",0,"",1,10
				case 23:playmedia "The Cure - Boys Don't Cry (1979).mp3",songs,pMusic,"",0,"",1,10
				case 24:playmedia "The Cure - Friday I' m in Love [ Official Edition ].mp3",songs,pMusic,"",0,"",1,10
				case 25:playmedia "The Libertines - Can't Stand Me Now (Official Video).mp3",songs,pMusic,"",0,"",1,10
				case 26:playmedia "The Prodigy - Firestarter (Official Video).mp3",songs,pMusic,"",0,"",1,10
				case 27:playmedia "The Verve - Bitter Sweet Symphony (Official Video).mp3",songs,pMusic,"",0,"",1,10
				case 28:playmedia "The Verve - Bitter Sweet Symphony (Official Video).mp3",songs,pMusic,"",0,"",1,10
				case 29:playmedia "Travis - Why Does It Always Rain on Me.mp3",songs,pMusic,"",0,"",1,10
			end Select
		end if
	end Sub



'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'   BALL FUNCTIONS & DRAINS
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  


	Function Balls
		Dim tmp
		tmp = bpgcurrent - BallsRemaining(CurrentPlayer) + 1
		If tmp> bpgcurrent Then
			Balls = bpgcurrent
		Else
			Balls = tmp
		End If
	End Function


	Sub FirstBall
		ResetForNewPlayerBall()
		CreateNewBall()
		bballfirstball = 1
		'PuPlayer.playlistplayex pBackglass,"videoscenes","triwizardcup.mp4",0,1
		playmedia "triwizardcup.mp4","videoscenes",pBackglass,"",3000,"",0,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
	End Sub


	Sub ResetForNewPlayerBall()
		checkmodes
		movemodes
		'PuPlayer.playlistplayex pCallouts,"audiocallouts","ballready.mp3",vovol,1
		playmedia "ballready.mp3","audiocallouts",pCallouts,"",1000,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		'PuPlayer.playresume 4
		'playbgaudio
		If PlayersPlayingGame > 1 Then
			If CurrentPlayer = 1 Then
				playmedia "player1.mp4","videoscenes",pBackglass,"",5000,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
				playmedia "player1.wav","audiocallouts",pCallouts,"",1000,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
				playmedia "","videodrains",pBackglass,"",6500,"",1,1
			Elseif currentplayer = 2 Then
				playmedia "player2.mp4","videoscenes",pBackglass,"",5000,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
				playmedia "player2.wav","audiocallouts",pCallouts,"",1000,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			Elseif currentplayer = 3 Then
				playmedia "player3.mp4","videoscenes",pBackglass,"",5000,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
				playmedia "player3.wav","audiocallouts",pCallouts,"",1000,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			Elseif currentplayer = 4 Then
				playmedia "player4.mp4","videoscenes",pBackglass,"",5000,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
				playmedia "player4.wav","audiocallouts",pCallouts,"",1000,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			End If
		Else
			playmedia "player1.mp4","videoscenes",pBackglass,"",5000,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			playmedia "player1.wav","audiocallouts",pCallouts,"",1000,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		End If
		AddScore 0
		BonusPoints(CurrentPlayer) = 0
		bBonusHeld = False
		bExtraBallWonThisBall = False
		ResetNewBallLights()
		'ResetNewBallVariables
		bBallSaverReady = True
		bSkillShotReady = True
		relighttable
		wandclose
		'playmedia "",songs,pMusic,"",0,"",1,4
		playbgaudio
		'vpmtimer.addtimer 300, "playbgaudio '"
		'PuPlayer.SetLoop 4,1
        pDMDStartBall 'pupdmd
	End Sub

	sub destroycalc
		BallsOnPlayfield = BallsOnPlayfield - 1
		If merlock1full = 1 Then
			BallsOnPlayfield = BallsOnPlayfield - 1
		end If
		If merlock2full = 1 Then
			BallsOnPlayfield = BallsOnPlayfield - 1
		end If
		If merlock3full = 1 Then
			BallsOnPlayfield = BallsOnPlayfield - 1
		end If
	end Sub

	Sub CreateNewBall()
		currentqueue = " "
		BallRelease.CreateSizedball BallSize / 2
		BallsOnPlayfield = BallsOnPlayfield + 1
		PlaySoundAt SoundFXDOF("mbpc-ballrelease", 114, DOFPulse, DOFContactors), BallRelease
		BallRelease.Kick 90, 4
		if bBallSaverActive = False Then
			if bballfirstball = 0  and bBallSaverReady = false Then
				EnableBallSaver 5
			end if
		end If
		If BallsOnPlayfield > 1 Then
			'bMultiBallMode = True
			bAutoPlunger = True
		End If

		if bballfirstball = 0 Then
			'bMultiBallMode = True
			bAutoPlunger = True
		End if 

	End Sub

	
	sub plungerrest_hit
		launchlight.state = 2
		broomdone = 0
		If bballfirstball = 0 Then
			Plunger.Pullback
			vpmtimer.addtimer 300, "fireit '"
		Else
			'pupDMDDisplay "-","Launch^ball",dmdnote,3,0,10
		End If
		DOF 317, DOFOn 	'MX, Launch Ball - Ball Ready to Shoot
	End Sub

	sub plungerrest_unhit
		DOF 317, DOFOff 	'MX, Launch Ball - Ball Ready to Shoot
		DOF 318, DOFPulse 	'DOF MX - Ball Launched (AutoPlunger)
	End Sub


	sub fireit
			'PlungerIM.Strength = 45
			'PlungerIM.AutoFire
			'PlungerIM.Strength = Plunger.MechStrength
			Plunger.AutoPlunger = true
			Plunger.Pullback
			Plunger.Fire
			DOF 114, DOFPulse	'Solenoid
			DOF 115, DOFPulse 	'Strobe
			DOF 318, DOFPulse 	'DOF MX - Ball Launched (AutoPlunger)
			bAutoPlunger = False
			Plunger.AutoPlunger = false
	end Sub

	Sub AddMultiball(nballs)
		mBalls2Eject = mBalls2Eject + nballs
		CreateMultiballTimer.Enabled = True
	End Sub

	Sub CreateMultiballTimer_Timer()
		If bBallInPlungerLane Then
			Exit Sub
		Else
			If BallsOnPlayfield <MaxMultiballs Then
				CreateNewBall()
				mBalls2Eject = mBalls2Eject -1
				If mBalls2Eject = 0 Then 
					Me.Enabled = False
				End If
			Else 
				mBalls2Eject = 0
				Me.Enabled = False
			End If
		End If
	End Sub

	Sub EndOfBall()
		playclear pAudio
		bMultiBallMode = False
		bOnTheFirstBall = False
		If NOT Tilted Then
			vpmtimer.addtimer 500, "EndOfBall2 '"
		Else 
			vpmtimer.addtimer 500, "EndOfBall2 '"
		End If
	End Sub

	
	Sub EndOfBall2()
		Tilted = False
		Tilt = 0
		DisableTable False
		tilttableclear.enabled = False
		tilttime = 0
		If(ExtraBallsAwards(CurrentPlayer) <> 0) Then
			ExtraBallsAwards(CurrentPlayer) = ExtraBallsAwards(CurrentPlayer) - 1
			If(ExtraBallsAwards(CurrentPlayer) = 0) Then
				t1.State = 0
			End If
			LightSeqFlasher.UpdateInterval = 150
			LightSeqFlasher.Play SeqRandom, 10, , 2000

			CreateNewBall()
			bballfirstball = 1
			ResetForNewPlayerBall
			'PuPlayer.playlistplayex pBackglass,"videoscenes","shootagain.mp4",100,2
			playmedia "shootagain.mp4","videoscenes",pBackglass,"",7000,"",1,2
		Else
			BallsRemaining(CurrentPlayer) = BallsRemaining(CurrentPlayer) - 1
			If(BallsRemaining(CurrentPlayer) <= 0) Then
				CheckHighScore()
			Else
				EndOfBallComplete()
			End If
		End If
	End Sub

	Sub EndOfBallComplete()
		ResetNewBallVariables
		Dim NextPlayer
		If(PlayersPlayingGame> 1) Then
			NextPlayer = CurrentPlayer + 1
			If(NextPlayer> PlayersPlayingGame) Then
				NextPlayer = 1
			End If
		Else
			NextPlayer = CurrentPlayer
		End If

		If((BallsRemaining(CurrentPlayer) <= 0) AND(BallsRemaining(NextPlayer) <= 0) ) Then
			EndOfGame()
		Else
			CurrentPlayer = NextPlayer
			AddScore 0
			ResetForNewPlayerBall()
			CreateNewBall()
			bballfirstball = 1
			If PlayersPlayingGame> 1 Then
				PlaySound "vo_player" &CurrentPlayer
			End If
		End If
	End Sub

	Sub Balldrained
		DOF 312, DOFPulse
	End Sub

	Sub Drain_Hit()
		rememberlights
		Drain.DestroyBall
		BallsOnPlayfield = BallsOnPlayfield - 1
		debug.print "drain - after math " & BallsOnPlayfield
		'debug.print "bMultiBallMode " & bMultiBallMode
		'debug.print "indragon " & indragon
		'debug.print "inmermulti " & inmermulti
		PlaySoundAt "Drain5", Drain
		If Tilted Then
			StopEndOfBallMode
		End If

		If(bGameInPLay = True) AND(Tilted = False) Then
			If bBallSaverActive = True Then
				'debug.print "ball saved"			
				CreateNewBall()
				bAutoPlunger = True
				If bMultiBallMode = False Then
					playmedia "ballsaved.mp4","videoscenes",pBackglass,"",6000,"",1,1 '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
					'pupDMDDisplay "-","Ball^Saved",dmdnote,3,0,10
				End If
			Else
				If BallsOnPlayfield = 1 Then
					If(bMultiBallMode = True) then
						if indragon = 1 Then
							enddragon
						end if
						if inmermulti = 1 Then
							endmermulti
						end if
						if inmazemulti = 1 Then
							endmazemulti
						end if
						if inwandmulti = 1 Then
							endwandmulti
						end if
						bMultiBallMode = False
						ChangeGi "white"
					End If
					bMultiBallMode = False		
					ChangeGi "white"
				End If
				If BallsOnPlayfield <= 0 Then
					clearmasks
					endamode
					endaward
					bMultiBallMode = False
					ChangeGi "white"
					gioff
					StopEndOfBallMode
					stopmultiandmode
					closemaze
					Balldrained
					vpmtimer.addtimer 500, "drainvids '"
				End If
			End If
		End If
	End Sub

	sub drainvids
		dim dvid:dvid = RndNum(1,6)
		playclear pMusic
		select Case dvid
		case 1
		playmedia "brilliant that makes me feel loads better.mp4","videodrains",pBackglass,"cineon",3000,"",1,1 '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		vpmtimer.addtimer 3000, "EndOfBall '"
		case 2
		playmedia "now i'm really depressed.mp4","videodrains",pBackglass,"cineon",2000,"",1,1 '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		vpmtimer.addtimer 2000, "EndOfBall '"
		case 3
		playmedia "put an end to it.mp4","videodrains",pBackglass,"cineon",5000,"",1,1 '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		vpmtimer.addtimer 5000, "EndOfBall '"
		case 4
		playmedia "who could possibly figure that out.mp4","videodrains",pBackglass,"cineon",6000,"",1,1 '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		vpmtimer.addtimer 6000, "EndOfBall '"
		case 5
		playmedia "you're a right foul git.mp4","videodrains",pBackglass,"cineon",4000,"",1,1 '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		vpmtimer.addtimer 4000, "EndOfBall '"
		case 6
		playmedia "you're never going to let him forget this.mp4","videodrains",pBackglass,"cineon",6200,"",1,1 '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		vpmtimer.addtimer 6200, "EndOfBall '"
		end select
	end sub


'********************************************************************************************************************************************
'********************************************************************************************************************************************
'********************************************************************************************************************************************
'********************************************************************************************************************************************
'********************************************************************************************************************************************
'FRAMEWORK BASE CODE END HERE
'********************************************************************************************************************************************
'********************************************************************************************************************************************
'********************************************************************************************************************************************
'********************************************************************************************************************************************
'********************************************************************************************************************************************

'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  ATTRACT MODE
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 


	Dim introposition
	introposition = 0

	Sub DMDintroloop
		PuPlayer.LabelSet pBackglass,"modetitle","",1,"{'mt':2,'color':16777215, 'size': 0, 'xpos': 80.7, 'xalign': 1, 'ypos': 72.6, 'yalign': 0}"
		introtime = 0
		clearhslabels
		introposition = introposition + 1
		Select Case introposition

		Case 1
			clearhslabels
			clearosblabels
			'PuPlayer.playpause 4
			playmedia "intro.mp4","videoattract",pBackglass,"",53000,"",1,10
			playclear pMusic
			'playmedia "base.mp4","backglass",pBackglass,"",0,"",1,1
			PuPlayer.LabelSet pBackglass,"notetitle","Need Rules Help?",1,""
			PuPlayer.LabelSet pBackglass,"notecopy","Hold both flippers for 2 seconds while in attract mode for rules overlay.",1,""

		Case 2
			'PuPlayer.playpause 4
			playclear pMusic
			clearhslabels
			clearosblabels
			playmedia "credits.mp4","videoattract",pBackglass,"",21000,"",1,11
			PuPlayer.LabelSet pBackglass,"notetitle","Did You Know?",1,""
			PuPlayer.LabelSet pBackglass,"notecopy","You can change the music to 80s jams in the script? Check it out..",1,""

		Case 3
			clearhslabels
			clearosblabels
			playmedia "orbital.mp4","videoattract",pBackglass,"",19000,"",1,12
			PuPlayer.LabelSet pBackglass,"notetitle","Want to code your own original table?",1,""
			PuPlayer.LabelSet pBackglass,"notecopy","Check Scottywics YouTube Channel for helpful guides.",1,""

		Case 4
			clearosblabels
			loadhs
			'playmedia "",songs,pMusic,"",0,"",1,1
			playbgaudio
			PuPlayer.LabelSet pBackglass,"HighScore","",1,""
			PuPlayer.LabelSet pBackglass,"HighScoreL1","",1,""
			PuPlayer.LabelSet pBackglass,"HighScoreL2","",1,""
			PuPlayer.LabelSet pBackglass,"HighScoreL3","",1,""
			PuPlayer.LabelSet pBackglass,"notetitle","Got A killer good High Score?",1,""
			PuPlayer.LabelSet pBackglass,"notecopy","Post it to #stlevpx on instagram to brag.",1,""
			playmedia "hsboard-attract.mp4","videoattract",pBackglass,"",44000,"",1,13
			PuPlayer.LabelSet pBackglass,"high1name",HighScoreName(0),1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 58.1, 'xalign': 1, 'ypos': 39.9, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"high1score",FormatNumber(HighScore(0),0),1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 71.1, 'xalign': 1, 'ypos': 39.9, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"high2name",HighScoreName(1),1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 58.1, 'xalign': 1, 'ypos': 47.5, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"high2score",FormatNumber(HighScore(1),0),1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 71.1, 'xalign': 1, 'ypos': 47.5, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"high3name",HighScoreName(2),1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 58.1, 'xalign': 1, 'ypos': 55, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"high3score",FormatNumber(HighScore(2),0),1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 71.1, 'xalign': 1, 'ypos': 55, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"high4name",HighScoreName(3),1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 58.1, 'xalign': 1, 'ypos': 63, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"high4score",FormatNumber(HighScore(3),0),1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 71.1, 'xalign': 1, 'ypos': 63, 'yalign': 1}"

		Case 5
			clearhslabels
			clearosblabels
			playmedia "psa.mp4","videoattract",pBackglass,"",11000,"",1,15
			PuPlayer.LabelSet pBackglass,"notetitle","Be Excellent to Each Other",1,""
			PuPlayer.LabelSet pBackglass,"notecopy","There is no place for homophobia, fascism, sexism, racism or hate.",1,""
		Case 6
			playclear pBackglass
			introposition = 0
	End Select
	End Sub

	sub clearosblabels
		PuPlayer.LabelSet pBackglass,"wh1n","",1,""
		PuPlayer.LabelSet pBackglass,"wh1s","",1,""
		PuPlayer.LabelSet pBackglass,"wh2n","",1,""
		PuPlayer.LabelSet pBackglass,"wh2s","",1,""
		PuPlayer.LabelSet pBackglass,"wh3n","",1,""
		PuPlayer.LabelSet pBackglass,"wh3s","",1,""
		PuPlayer.LabelSet pBackglass,"wh4n","",1,""
		PuPlayer.LabelSet pBackglass,"wh4s","",1,""
		PuPlayer.LabelSet pBackglass,"wh5n","",1,""
		PuPlayer.LabelSet pBackglass,"wh5s","",1,""
		PuPlayer.LabelSet pBackglass,"wh6n","",1,""
		PuPlayer.LabelSet pBackglass,"wh6s","",1,""
		PuPlayer.LabelSet pBackglass,"wh7n","",1,""
		PuPlayer.LabelSet pBackglass,"wh7s","",1,""
		PuPlayer.LabelSet pBackglass,"wh8n","",1,""
		PuPlayer.LabelSet pBackglass,"wh8s","",1,""
		PuPlayer.LabelSet pBackglass,"wh9n","",1,""
		PuPlayer.LabelSet pBackglass,"wh9s","",1,""
		PuPlayer.LabelSet pBackglass,"wh10n","",1,""
		PuPlayer.LabelSet pBackglass,"wh10s","",1,""
		PuPlayer.LabelSet pBackglass,"ah1n","",1,""
		PuPlayer.LabelSet pBackglass,"ah1s","",1,""
		PuPlayer.LabelSet pBackglass,"ah2n","",1,""
		PuPlayer.LabelSet pBackglass,"ah2s","",1,""
		PuPlayer.LabelSet pBackglass,"ah3n","",1,""
		PuPlayer.LabelSet pBackglass,"ah3s","",1,""
		PuPlayer.LabelSet pBackglass,"ah4n","",1,""
		PuPlayer.LabelSet pBackglass,"ah4s","",1,""
		PuPlayer.LabelSet pBackglass,"ah5n","",1,""
		PuPlayer.LabelSet pBackglass,"ah5s","",1,""
		PuPlayer.LabelSet pBackglass,"ah6n","",1,""
		PuPlayer.LabelSet pBackglass,"ah6s","",1,""
		PuPlayer.LabelSet pBackglass,"ah7n","",1,""
		PuPlayer.LabelSet pBackglass,"ah7s","",1,""
		PuPlayer.LabelSet pBackglass,"ah8n","",1,""
		PuPlayer.LabelSet pBackglass,"ah8s","",1,""
		PuPlayer.LabelSet pBackglass,"ah9n","",1,""
		PuPlayer.LabelSet pBackglass,"ah9s","",1,""
		PuPlayer.LabelSet pBackglass,"ah10n","",1,""
		PuPlayer.LabelSet pBackglass,"ah10s","",1,""
	end Sub

	sub clearhslabels
		PuPlayer.LabelSet pBackglass,"HighScore","",1,""
		PuPlayer.LabelSet pBackglass,"HighScoreL1","",1,""
		PuPlayer.LabelSet pBackglass,"HighScoreL2","",1,""
		PuPlayer.LabelSet pBackglass,"HighScoreL3","",1,""
		PuPlayer.LabelSet pBackglass,"HighScore","",1,""
		PuPlayer.LabelSet pBackglass,"HighScoreL1","",1,""
		PuPlayer.LabelSet pBackglass,"HighScoreL2","",1,""
		PuPlayer.LabelSet pBackglass,"HighScoreL3","",1,""
		PuPlayer.LabelSet pBackglass,"high1name","",1,""
		PuPlayer.LabelSet pBackglass,"high1score","",1,""
		PuPlayer.LabelSet pBackglass,"high2name","",1,""
		PuPlayer.LabelSet pBackglass,"high2score","",1,""
		PuPlayer.LabelSet pBackglass,"high3name","",1,""
		PuPlayer.LabelSet pBackglass,"high3score","",1,""
		PuPlayer.LabelSet pBackglass,"high4name","",1,""
		PuPlayer.LabelSet pBackglass,"high4score","",1,""
	end Sub
	


	Dim introtime
	introtime = 0

	Sub intromover_timer
		introtime = introtime + 1
		If introposition = 1 Then
			If introtime = 53 Then
				DMDintroloop
			End If
		End If
		If introposition = 2 Then
			If introtime = 21 Then
				DMDintroloop
			End If
		End If
		If introposition = 3 Then
			If introtime = 19 Then
				DMDintroloop
			End If
		End If
		If introposition = 4 Then
			If introtime = 10 Then
				DMDintroloop
			End If
		End If
		If introposition = 5 Then
			If introtime = 15 Then
				DMDintroloop
			End If
		End If
		If introposition = 6 Then
			If introtime = 11 Then
				introposition = 0
				DMDintroloop
			End If
		End If
		If introposition = 7 Then
				DMDintroloop
		End If
		If introposition = 0 Then
				DMDintroloop
		End If
	End Sub

'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  TABLE VARIABLES
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 


	' Game Variables
	Dim LaneBonus
	Dim TargetBonus
	Dim RampBonus
	Dim OrbitBonus
	Dim spinvalue
	Dim finalflips
	Dim Saves
	Dim Drains
	Dim inmode
	Dim currentcombo(4)
	Dim totalcombo(4)
	Dim dragonlock(4)
	Dim dragonjacks(4)
	Dim lasthit
	Dim playerspins(4)
	Dim mermultispins(4)
	Dim wandlocks(4)
	Dim lrhits(4)
	Dim rrhits(4)
	Dim merlock1full:merlock1full = 0
	Dim merlock2full:merlock2full = 0
	Dim merlock3full:merlock3full = 0
	Dim mazelocks(4)
	Dim mazejacks(4)
	Dim wandjacks(4)
	dim potions(4)
	dim pbumps(4)
	dim totalbumps(4)
	dim goblets(4)
	dim deshit(4)
	dim modescompleted(4)
	dim modeeb(4)
	dim spinlvl(4)
	dim spinnum(4)
	dim delvl(4)
	dim potready(4)
	dim potionlevel(4)
	dim bumplvl(4)
	dim merlinsecond(4)


'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  GAME STARTING & RESETS
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 

	Sub Game_Init() 'called at the start of a new game
		playclear pBackglass
		merlock1.enabled = 0
		merlock2.enabled = 0
		merlock3.enabled = 0
		inmermulti = 0
		setlightvalues
		closemaze
		cineon = 0
		Dim i
		For i = 0 to 4
			bumplvl(i) = 0
			currentcombo(i) = 0
			totalcombo(i) = 0 
			dragonlock(i) = 0
			dragonjacks(i) = 0
			playerspins(i) = 0
			mermultispins(i) = 0
			wandlocks(i) = 0
			rrhits(i) = 0
			lrhits(i) = 0
			mazelocks(i) = 0
			mazejacks(i) = 0
			wandjacks(i) = 0
			potions(i) = 0
			pbumps(i) = 0
			totalbumps(i) = 0
			goblets(i) = 0
			deshit(i) = 0
			modescompleted(i) = 0
			modeeb(i) = 0
			spinlvl(i) = 0
			spinnum(i) = 75
			delvl(i) = 0
			potready(i) = 0
			potionlevel(i) = 0
			merlinsecond(i) = 0
		Next
		lrflashtime.Enabled = False
		bExtraBallWonThisBall = False
		bballfirstball = 1
		PuPlayer.LabelSet pBackglass,"high1name","",1,""
		PuPlayer.LabelSet pBackglass,"high1score","",1,""
		PuPlayer.LabelSet pBackglass,"high2name","",1,""
		PuPlayer.LabelSet pBackglass,"high2score","",1,""
		PuPlayer.LabelSet pBackglass,"high3name","",1,""
		PuPlayer.LabelSet pBackglass,"high3score","",1,""
		PuPlayer.LabelSet pBackglass,"high4name","",1,""
		PuPlayer.LabelSet pBackglass,"high4score","",1,""
		PuPlayer.LabelShowPage pBackglass,1,0,""
		pUpdateScores
		PuPlayer.LabelSet pBackglass,"Play1","PLAYER 1",1,"{'mt':2,'color':16777215}"
		PuPlayer.LabelSet pBackglass,"notetitle","",1,""
		PuPlayer.LabelSet pBackglass,"notecopy","",1,""
		ruleshelperon
		resetbackglass
		clearosblabels
		clearhslabels
		'PuPlayer.playlistplayex pBackglass,"backglass","base.mp4",0,1  'should be an attract background (no text is displayed)
		'PuPlayer.SetBackground pBackglass,1	
		If help = 1 Then
			helpful.enabled = 1
		end if
	End Sub

	dim helppos : helppos = RndNum(1,5)
	sub	helpful_timer
		helppos = helppos + 1
		if bMultiBallMode = false Then
			if inamode = 0 Then
				if cineon = 0 then
			select case helppos
			case 1 : 'PuPlayer.playlistplayex pCallouts,"audiocallouts","shoot the bumpers to learn a spell.wav",vovol,1
						'playmedia "brilliant that makes me feel loads better.mp4","videodrains",pBackglass,"cineon",6000,"dropwall",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
						pupDMDDisplay "-","Shoot Bumpers^For Video Mode",dmdnote,3,0,10

			case 2 : 'PuPlayer.playlistplayex pCallouts,"audiocallouts","shoot the spinners to start lake rescue.wav",vovol,1
						playmedia "shoot the spinners to start lake rescue.wav","audiocallouts",pCallouts,"",4000,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
						pupDMDDisplay "-","Shoot Spinners^For Lake Lock",dmdnote,3,0,10

			case 3 : 'PuPlayer.playlistplayex pCallouts,"audiocallouts","hit the targets to light a mode.wav",vovol,1
						playmedia "hit the targets to light a mode.wav","audiocallouts",pCallouts,"",6000,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)	
						pupDMDDisplay "-","Spell Potter^To Light Mode",dmdnote,3,0,10

			case 4 : 'PuPlayer.playlistplayex pCallouts,"audiocallouts","hit the ramps to start maze multiball.wav",vovol,1
						playmedia "hit the ramps to start maze multiball.wav","audiocallouts",pCallouts,"",6000,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
						pupDMDDisplay "-","Hit Ramps^To Open Maze",dmdnote,3,0,10

			case 5 : 'PuPlayer.playlistplayex pCallouts,"audiocallouts","hit the cauldron to make a potion.wav",vovol,1
						playmedia "hit the cauldron to make a potion.wav","audiocallouts",pCallouts,"",6000,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
						pupDMDDisplay "-","Stir Cauldron^To Make a Potion",dmdnote,3,0,10

			case 6 : 'PuPlayer.playlistplayex pCallouts,"audiocallouts","hit the captive ball to light lock.wav",vovol,1
						playmedia "hit the captive ball to light lock.wav","audiocallouts",pCallouts,"",6000,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
						pupDMDDisplay "-","Hit Captive Ball^To Battle Dragon",dmdnote,3,0,10

			case 7 : 'PuPlayer.playlistplayex pCallouts,"audiocallouts","get combos for wand multiball.wav",vovol,1
						playmedia "get combos for wand multiball.wav","audiocallouts",pCallouts,"",6000,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
						helppos = 0:pupDMDDisplay "-","Get Combos^for Wand Multi",dmdnote,3,0,10
			end Select
			end if
			end if
		end If
	end Sub

	Sub StopEndOfBallMode()              'this sub is called after the last ball is drained
		ResetSkillShotTimer_Timer
	End Sub

	Sub ResetNewBallVariables()
		'relighttable
		wandclose
		'PuPlayer.playlistplayex pMusic,songs,"",sndtrkvol,1
		'playmedia "",songs,pMusic,"",0,"",1,4  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		'playbgaudio
		'PuPlayer.SetLoop 4,1
	End Sub

	Sub TurnOffPlayfieldLights()
		Dim a
		For each a in alights
			a.State = 0
		Next
	End Sub

	Sub TurnOffmultiLights()
		Dim a
		For each a in alights
			a.State = 0
		Next
		If pt2(CurrentPlayer) = 1 Then
			t2.state = 1
		End If
	End Sub

	Sub ResetNewBallLights() 'turn on or off the needed lights before a new ball is released
		TurnOffPlayfieldLights()
		currentplayerbackglass
	End Sub

	Sub startamultiball
		Dim waittime
		waittime = 1000
		vpmtimer.addtimer waittime, "closeupshop'"
	End Sub
	
	Sub closeupshop

	End Sub

	Sub endamultiball

	End Sub


	Sub UpdateSkillShot() 'Updates the skillshot light
		l7.State = 2
	End Sub

	Sub SkillshotOff_Hit 'trigger to stop the skillshot due to a weak plunger shot
		If bSkillShotReady Then

			ResetSkillShotTimer_Timer
		End If
	End Sub

	Sub ResetSkillShotTimer_Timer 'timer to reset the skillshot lights & variables
		ResetSkillShotTimer.Enabled = 0
		bSkillShotReady = False
			'If l7.State = 2 then l7.State = 0
	End Sub


'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  RULES HELPER FOR YOUR BACKGLASS
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 


	Sub ruleshelperon
		rulestime.enabled = 1
	End Sub

	Sub ruleshelperoff
		rulestime.enabled = 0
	End Sub

	Dim rulesposition
	rulesposition = 0

	Sub rulestime_timer
		If turnoffrules = 1 then exit sub end if
		rulesposition = rulesposition + 1
		Select Case rulesposition
		Case 1
			PuPlayer.LabelSet pBackglass,"ruletitle","Harry Potter && the Goblet of Fire",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 86.8, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"rulecopy1","Games Played: " & TotalGamesPlayed,1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 89.8, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"rulecopy2","Brilliant!",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 92.8, 'yalign': 1}"
		Case 8
			PuPlayer.LabelSet pBackglass,"ruletitle","Golden Egg Multiball",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 86.8, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"rulecopy1","Hit Golden Egg",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 89.8, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"rulecopy2","Hit the left dugout to lock",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 92.8, 'yalign': 1}"
		Case 15
			PuPlayer.LabelSet pBackglass,"ruletitle","Lake Rescue Multiball",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 86.8, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"rulecopy1","Get 100 Spins",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 89.8, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"rulecopy2","Lock 1-3 balls and hit right dugout",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 92.8, 'yalign': 1}"
		Case 24
			PuPlayer.LabelSet pBackglass,"ruletitle","Maze Escape Multiball",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 86.8, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"rulecopy1","Shoot ramps to open maze",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 89.8, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"rulecopy2","Shoot left ramp to lock & start multi",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 92.8, 'yalign': 1}"
		Case 32
			PuPlayer.LabelSet pBackglass,"ruletitle","Wand Multiball",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 86.8, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"rulecopy1","Hit 10 combos to light each lock",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 89.8, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"rulecopy2","Hit the right ramp to lock balls",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 92.8, 'yalign': 1}"
		Case 40
			PuPlayer.LabelSet pBackglass,"ruletitle","House Modes",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 86.8, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"rulecopy1","Hit targets to spell POTTER",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 89.8, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"rulecopy2","Then hit the right dugout to start.",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 92.8, 'yalign': 1}"
		Case 48
			PuPlayer.LabelSet pBackglass,"ruletitle","Learn a Spell",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 86.8, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"rulecopy1","Collect bumpers for mini game",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 89.8, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"rulecopy2","of spells and hit the left dugout.",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 92.8, 'yalign': 1}"
		Case 56
			PuPlayer.LabelSet pBackglass,"ruletitle","Make a Potion",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 86.8, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"rulecopy1","Hit the spinner to collect",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 89.8, 'yalign': 1}"
			PuPlayer.LabelSet pBackglass,"rulecopy2","",1,"{'mt':2,'color':15066597, 'size': 2, 'xpos': 82.5, 'xalign': 1, 'ypos': 92.8, 'yalign': 1}"
		case 64
			rulesposition = 0
	End Select
	End Sub


'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  PER PLAYER LIGHTS
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'
	Dim pt1(4)
	Dim pt2(4)
	Dim pt3(4)
	Dim pt4(4)
	Dim pt5(4)
	Dim pt6(4)
	Dim pt7(4)
	Dim pt8(4)
	Dim pt9(4)
	Dim pt10(4)
	Dim pt11(4)
	Dim pt12(4)
	Dim pt13(4)
	Dim pt14(4)
	Dim pt15(4)
	Dim pt16(4)
	Dim pt17(4)
	Dim pt18(4)
	Dim pt19(4)
	Dim pt20(4)
	Dim pt21(4)
	Dim pt22(4)
	Dim pt23(4)
	Dim pt24(4)
	Dim pt25(4)
	Dim pt26(4)
	Dim ppblit(4)
	Dim pt27(4)
	Dim pt28(4)
	Dim pt29(4)
	Dim pt30(4)
	Dim pt31(4)
	Dim pt32(4)
	Dim pt33(4)
	Dim pt34(4)
	Dim pt35(4)
	Dim pt36(4)
	Dim pt37(4)
	Dim pt72(4)
	Dim ps13(4)
	Dim ps53(4)
	'Dim pt16(4)
	Dim psrr1(4)
	Dim psrr2(4)
	Dim psrr3(4)
	Dim psrr4(4)
	Dim pslr1(4)
	Dim pslr2(4)
	Dim pslr3(4)
	Dim pslr4(4)
	Dim ps71(4)

	setlightvalues
	sub setlightvalues
		dim i
		For i = 0 to 4
			pt1(i) = 0
			pt2(i) = 1
			pt3(i) = 0
			pt4(i) = 0
			pt5(i) = 0
			pt6(i) = 0
			pt7(i) = 0
			pt8(i) = 0
			pt9(i) = 0
			pt10(i) = 0
			pt11(i) = 0
			pt12(i) = 0
			pt13(i) = 0
			pt14(i) = 0
			pt15(i) = 0
			pt16(i) = 0
			pt17(i) = 0
			pt18(i) = 0
			pt19(i) = 0
			pt20(i) = 0
			pt21(i) = 0
			pt22(i) = 0
			pt23(i) = 0
			pt24(i) = 0
			pt25(i) = 0
			pt26(i) = 0
			ppblit(i) = 0
			pt27(i) = 0
			pt28(i) = 0
			pt29(i) = 0
			pt30(i) = 0
			pt31(i) = 0
			pt32(i) = 0
			pt33(i) = 0
			pt34(i) = 0
			pt35(i) = 0
			pt36(i) = 0
			pt37(i) = 0
			pt72(i) = 0
			ps13(i) = 0
			ps53(i) = 0
			psrr1(i) = 0
			psrr2(i) = 0
			psrr3(i) = 0
			psrr4(i) = 0
			pslr1(i) = 0
			pslr2(i) = 0
			pslr3(i) = 0
			pslr4(i) = 0
			ps71(i) = 0
			pt16(i) = 0
		Next
	end Sub
	
	sub rememberlights
	end Sub

	sub resetcolors


		'red, orange, amber, yellow, darkgreen, green, blue, darkblue, purple, white, base

		SetLightColor s14, white, -1

		'dragon light red
		SetLightColor s41, red, -1 ' hit arrow
		SetLightColor s23, red, -1 ' lock light
		SetLightColor t33, red, -1
		SetLightColor t34, red, -1
		SetLightColor t35, red, -1
		SetLightColor t36, red, -1
		SetLightColor t37, red, -1
		SetLightColor t18, red, -1 ' mode complete

		'Lake rescue lights
		SetLightColor t19, blue, -1 ' mode complete
		SetLightColor s13, blue, -1
		SetLightColor s61, blue, -1
		SetLightColor s81, blue, -1
		SetLightColor s91, blue, -1
		SetLightColor s73, blue, -1

		'Maze lights
		SetLightColor s31, orange, -1 ' mode complete
		SetLightColor s33, darkgreen, -1
		SetLightColor s51, orange, -1
		SetLightColor slr1, darkgreen, -1
		SetLightColor slr2, darkgreen, -1
		SetLightColor slr3, darkgreen, -1
		SetLightColor slr4, darkgreen, -1
		SetLightColor srr1, darkgreen, -1
		SetLightColor srr2, darkgreen, -1
		SetLightColor srr3, darkgreen, -1
		SetLightColor srr4, darkgreen, -1

		' combo lights amber
		SetLightColor s14, amber, -1
		SetLightColor s34, amber, -1
		SetLightColor s54, amber, -1
		SetLightColor s63, amber, -1
		SetLightColor s82, amber, -1
		SetLightColor s93, amber, -1
		SetLightColor s53, amber, -1 ' wand lock
		SetLightColor t16, amber, -1 ' wand crescent
		SetLightColor t6, amber, -1 ' combo order of merlin

		' goblet lights
		SetLightColor t3, darkblue, -1
		SetLightColor t4, darkblue, -1
		SetLightColor t5, darkblue, -1
		SetLightColor t9, darkblue, -1
		SetLightColor t10, darkblue, -1
		SetLightColor t11, darkblue, -1

		'kickback light
		SetLightColor t2, green, -1

		'spell light
		SetLightColor s22, green, -1
		SetLightColor l22, yellow, -1 ' Bumper
		SetLightColor l20f2, yellow, -1 ' bumper

		'extra Balls light
		SetLightColor s71, red, -1
		'SetLightColor s21, red, -1

		'Wizard / Voldemort light
		SetLightColor swizard, green, -1


		'ballsave light
		SetLightColor t1, red, -1

		'order of merlin ramps light
		SetLightColor t7, orange, -1

		'death eaters light
		SetLightColor t8, red, -1 ' order of merlin
		SetLightColor t38, red, -1
		SetLightColor t39, red, -1

		'potion lights
		SetLightColor t21, darkgreen, -1
		SetLightColor t22, darkgreen, -1
		SetLightColor t23, darkgreen, -1
		SetLightColor t24, darkgreen, -1
		SetLightColor t25, darkgreen, -1
		SetLightColor t26, darkgreen, -1
		'SetLightColor s24, darkgreen, -1


		'Potter lights
		SetLightColor t27, purple, -1
		SetLightColor t28, purple, -1
		SetLightColor t29, purple, -1
		SetLightColor t30, purple, -1
		SetLightColor t31, purple, -1
		SetLightColor t32, purple, -1
		SetLightColor s72, purple, -1 'mode Kicker light
		SetLightColor t12, purple, -1 ' mode array
		SetLightColor t13, purple, -1 ' mode array
		SetLightColor t14, purple, -1 ' mode array
		SetLightColor t15, purple, -1 ' mode array
		'SetLightColor t16, purple, -1 ' mode array
		'SetLightColor t17, purple, -1 ' mode array


		'lightning bolts lights
		SetLightColor boltl, white, -1
		SetLightColor boltr, white, -1

		'sling flashers lights
		SetLightColor l20, base, -1
		SetLightColor l21, base, -1

		SetLightColor rightdug, purple, -1
		SetLightColor leftdug, red, -1




	end Sub
		
	sub relighttable
		If BallsRemaining(CurrentPlayer) = 3 Then
			if modescompleted(currentplayer) = 0 Then
				t27.state = 1
				pt27(currentplayer) = 1
				pt29(CurrentPlayer) = 1
				t29.state = 1
				pt32(CurrentPlayer) = 1
				t32.state = 1
			end If
		end If
		resetcolors
		checkmodes
		movemodes
		mazecall = 0
		If pt27(CurrentPlayer) = 1 Then
			t27.state = 1
		End If
		If pt28(CurrentPlayer) = 1 Then
			t28.state = 1
		End If
		If pt29(CurrentPlayer) = 1 Then
			t29.state = 1
		End If
		If pt30(CurrentPlayer) = 1 Then
			t30.state = 1
		End If
		If pt31(CurrentPlayer) = 1 Then
			t31.state = 1
		End If
		If pt32(CurrentPlayer) = 1 Then
			t32.state = 1
		End If
		If pt72(CurrentPlayer) = 1 Then
			s72.state = 2
		End If
		if ppblit(CurrentPlayer) = 1 Then
			pblit.state = 2
		End If
		If pt2(CurrentPlayer) = 1 Then
			t2.state = 2
			lanesaveopen
		Else
			lanesaveclosed
		End If
		If pt37(CurrentPlayer) = 1 Then
			t37.state = 1
		End If
		If pt36(CurrentPlayer) = 1 Then
			t36.state = 1
		End If
		If pt35(CurrentPlayer) = 1 Then
			t35.state = 1
		End If
		If pt34(CurrentPlayer) = 1 Then
			t34.state = 1
		End If
		If pt16(CurrentPlayer) = 1 Then
			t16.state = 1
		End If
		If pt33(CurrentPlayer) = 1 Then
			t33.state = 1
		End If
		
		if pt8(CurrentPlayer) = 1 Then
			t8.state = 1
		end If	

		If psrr1(CurrentPlayer) = 1 Then
			srr1.state = 1
		End If

		If psrr2(CurrentPlayer) = 1 Then
			srr2.state = 1
		End If

		If psrr3(CurrentPlayer) = 1 Then
			srr3.state = 1
		End If

		If psrr4(CurrentPlayer) = 1 Then
			srr4.state = 1
		End If

		If pslr1(CurrentPlayer) = 1 Then
			slr1.state = 1
		End If

		If pslr2(CurrentPlayer) = 1 Then
			slr2.state = 1
		End If

		If pslr3(CurrentPlayer) = 1 Then
			slr3.state = 1
		End If

		If pslr4(CurrentPlayer) = 1 Then
			slr4.state = 1
		End If
		

		If merlock1full = 1 Then
			s73.state = 2
			If merlock2full = 0 Then
				ps13(CurrentPlayer) = 1
			End If
		End if	

		If pt6(CurrentPlayer) = 1 Then
			t6.state = 1
		end if

		If ps13(CurrentPlayer) = 1 Then
			s13.state = 2
			if merlock1full = 0 Then
				merlock1.enabled = 1
			end if
			If merlock3full = 0 Then
				if merlock2full = 1 Then
					merlock3.enabled = 1
				end If
			end If
			If merlock2full = 0 Then
				if merlock1full = 1 Then
					merlock2.enabled = 1
				end If
			end If
		End If

		if potready(CurrentPlayer) = 1 Then
			potionready
		end If

		if ps71(currentplayer) = 1 Then
			s71.state = 2
		end If
		
		if pt7(CurrentPlayer) = 1 Then
			t7.state = 1
			merlinsecond(CurrentPlayer) = 1
		end if

		If pt19(CurrentPlayer) = 1 Then
			t19.state = 1
		End if

		If ps53(CurrentPlayer) = 1 Then
			s53.state = 2
			t16.state = 2
			wandopen
		End if
	
		if pt20(CurrentPlayer) = 1 Then
			t20.state = 1
		end If

		if pt18(CurrentPlayer) = 1 Then
			t18.state = 1
		end If

		if pt19(CurrentPlayer) = 1 Then
			t19.state = 1
		end If
		checkvoldemort
		currentplayerbackglass
'		checkpotions
		'checkdragon
		checkbothramps
		checkspell
		spellvo = 0
		potioncall = 0
		'checkcombos
		checkdragon
		Select Case totalcombo(CurrentPlayer)
			case 10
				wandlockready
				'PuPlayer.playlistplayex pCallouts,"audiocallouts","wand lock ready.wav",vovol,1
				playmedia "wand lock ready.wav","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
				pupDMDDisplay "-","Wand Lock^is Lit",dmdnote,3,0,10
			case 11
				totalcombo(CurrentPlayer) = 9
				wandlockready
		end Select
	End Sub





'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  SKILLSHOT & BALL SAVE
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 

	dim skillshotlive:skillshotlive = 0

	Sub launchend_hit
		hbreturn.enabled = 1
		StopSound "fx_metalrolling"
		PlaySoundAt "fx_balldrop", launchend
	End sub

	Sub turnskillon_hit
		if bballfirstball = 1 Then
			skillshotlive = 1
			startskill
		end If
	End Sub


	Sub startskill
		StartRainbow skillshotlights
		dim a
		for each a in skillshotlights
			a.state = 2
		next
	End Sub

	Sub stopskill
		SkillshotValue = 1000000
		StopRainbow skillshotlights
		dim a
		for each a in skillshotlights
			a.state = 0
			SetLightColor a, green, -1
		next
	End Sub

	SkillshotValue = 1000000
	Sub AwardSkillshot
		Dim i
		DOF 125, DOFPulse
		'GiEffect 1
		'LightEffect 2
		'LightEffect 9
		DOF 401, DOFPulse   'DOF MX - Skillshot
		If SkillshotValue = 1000000 then
			'PuPlayer.playlistplayex pCallouts,"audiocallouts","skillshot.wav",vovol,1
			playmedia "skillshot.wav","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			pupDMDDisplay "-","Skillshot^1,000,000",dmdnote,3,0,10
			'***** LIGHT RUNS *****
			'(CHAOS)randoms
			'(DIRECTIONS)uup|udown|uleft|uright|diagdl|diagdr|diagul|diagur
			'(SWIPES)middleih|middleiv|middleoh|middleov|stripe1h|hatch1h|hatch1v|hatch2h|hatch2v|stripe1v|stripe2h|stripe2v
			'(SPINS)circlein|circleout|clockleft|clockright|screwl|screwr
			'(CURVES)arcbld|arcblu|arcbrd|arcbru|arctld|arctlu|arctrd|arctru|fanld|fanlu|fanrd|fanru|radarl|radarr|wiperl|wiperr
			'(EXAMPLE)lightrun red,arcbld,1  (SYNTAX)lightrun color,direction,times to run
			lightrun amber,screwl, 2
			flasherspop amber,"crazy"
			'chilloutthemusic
			AddScore 1000000
			skillshotvalue = skillshotvalue + 1000000
		Else
			'PuPlayer.playlistplayex pCallouts,"audiocallouts","super skillshot.wav",vovol,1
			playmedia "super skillshot.wav","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			pupDMDDisplay "-","Super^Skillshot",dmdnote,3,0,10
			lightrun amber,screwl, 3
			flasherspop amber,"crazy"
			'chilloutthemusic
			addscore 2000000
		End If
	End Sub


	Sub ballsavestarttrigger_hit
		If skillshotlive = 1 Then
			stopskill
			dlcall = 0
			potioncall = 0
		end if 
		skillshotlive = 0
		bballfirstball = 0
		If(bBallSaverReady = True) AND(15 <> 0) And(bBallSaverActive = False) Then
			EnableBallSaver 15:bBallSaverActive = True
		End If
	End Sub



	Sub EnableBallSaver(seconds)
		bBallSaverActive = True
		bBallSaverReady = False
		BallSaverTimerExpired.Interval = 1000 * seconds
		BallSaverTimerExpired.Enabled = True
		BallSaverSpeedUpTimer.Interval = 1000 * seconds -(1000 * seconds) / 3
		BallSaverSpeedUpTimer.Enabled = True
		' if you have a ball saver light you might want to turn it on at this point (or make it flash)
		t1.BlinkInterval = 160
		t1.State = 2
	End Sub

	' The ball saver timer has expired.  Turn it off AND reset the game flag
	'
	Sub BallSaverTimerExpired_Timer()

		BallSaverTimerExpired.Enabled = False
		' clear the flag
		Dim waittime
		waittime = 4000
		vpmtimer.addtimer waittime, "ballsavegrace'"
		' if you have a ball saver light then turn it off at this point
		If bExtraBallWonThisBall = True Then
			t1.State = 1
		Else
			t1.State = 0
		End If
	End Sub

	Sub ballsavegrace
		dim blcalc, balnums
		blcalc = getballs
		balnums = UBound(blcalc) - 1
		dim mlnum:mlnum = merlock1full + merlock3full + merlock2full
		dim finballs:finballs = balnums - mlnum
		debug.print "live balls:" &	finballs
		BallsOnPlayfield = finballs
		debug.print "Ballsaver ended"
		bBallSaverActive = False
	End Sub

	Sub quickcount
		dim blcalc, balnums
		blcalc = getballs
		balnums = UBound(blcalc) - 1
		dim mlnum:mlnum = merlock1full + merlock3full + merlock2full
		dim finballs:finballs = balnums - mlnum
		debug.print "live balls:" &	finballs
		BallsOnPlayfield = finballs
	End Sub



	Sub BallSaverSpeedUpTimer_Timer()
		'debug.print "Ballsaver Speed Up Light"
		BallSaverSpeedUpTimer.Enabled = False
		' Speed up the blinking
		t1.BlinkInterval = 80
		t1.State = 2
	End Sub


	'****************************
	' LANE BALL SAVER
	'****************************

	Sub lanesaveopen
		t2.state = 1
		pt2(CurrentPlayer) = 1
		gate2.collidable = 1
	End Sub

	Sub startkick
		If t2.state = 1 Then
			t2.state = 2
			EnableBallSaver 5:bBallSaverActive = True
			vpmtimer.addtimer 3000, "lanesaveclosed'"
		end If
	end Sub

	Sub lanesaveclosed
		t2.state = 0
		pt2(CurrentPlayer) = 0
		gate2.collidable = 0
	End Sub

	sub kickbacker_hit
		t2.state = 2
		EnableBallSaver 5:bBallSaverActive = True
		PlaySound SoundFXDOF("mbpc-popper",103,DOFPulse,DOFContactors)
		DOF 115, DOFPulse 'Strobe
		kickbacker.kick 0, 40, 0
		vpmtimer.addtimer 3000, "lanesaveclosed'"
	end Sub


'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  CONDITIONAL LOGIC
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 

	Sub checklogic
		'mode ready check
		If s72.state = 0 Then
			If t27.state + t28.state + t29.state + t30.state + t31.state + t32.state = 6 Then
				s72.state = 2
				rightdug.state = 2
				pt72(CurrentPlayer) = 1
				'PuPlayer.playlistplayex pCallouts,"audiocallouts","start a mode.wav",vovol,1
				playmedia "start a mode.wav","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
				pupDMDDisplay "-","Mode^is Lit",dmdnote,3,0,10
				'chilloutthemusic
				pNote "MODE","IS LIT"
			End If
		End If
	end Sub

	'called at final drain w/ no saves
	sub stopmultiandmode
		If bMultiBallMode = true Then
		enddragon
		endmermulti
		endwandmulti
		End If
	end Sub




'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  TARGET HIT EVENTS
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 

	'****************************
	' POTION
	'****************************

	sub spinning_timer
	spindiscimg.rotz = spindiscimg.rotz + 10
	end Sub

	dim spinner
	 Set spinner = New cvpmTurntable
		With spinner
			.InitTurntable spindisc, 100
			.SpinDown = 10
			.CreateEvents "spinner"
		End With

	spinner.MotorOn = false

'	dim cauldpos:cauldpos=0
'	sub cauldup_timer
'		if cauldpos = 0 Then
'			cauldron4.z = cauldron4.z - 1
'			if cauldron4.z = - 60 Then
'				cauldpos = 1
'			end If
'		else
'			cauldron4.z = cauldron4.z + 1
'			if cauldron4.z = 0 Then
'				cauldpos = 0
'			end If			
'		End if
'	end Sub

		cauldron4.z = - 60
		cauldron4.collidable = false
		spinning.enabled = false

	sub target1_hit
		potionhit
		AddScore 1010
		if pt7(CurrentPlayer) = 1 Then
			AddScore 1010
		end if
		flasherspop green, "bottom"
		if wallagain = 0 then
			raisewall
		end if
	end Sub

	sub target2_hit
		potionhit
		AddScore 1010
		if pt7(CurrentPlayer) = 1 Then
			AddScore 1010
		end if
		flasherspop green, "bottom"
		if wallagain = 0 then
			raisewall
		end if
	end Sub

	sub target3_hit
		potionhit
		AddScore 1010
		if pt7(CurrentPlayer) = 1 Then
			AddScore 1010
		end if
		flasherspop green, "bottom"
		if wallagain = 0 then
			raisewall
		end if
	end Sub

	sub target14_hit
		potionhit
		AddScore 1010
		if pt7(CurrentPlayer) = 1 Then
			AddScore 1010
		end if
		flasherspop green, "bottom"
		if wallagain = 0 then
			raisewall
		end if
	end Sub

	sub target15_hit
		potionhit
		AddScore 1000
		if pt7(CurrentPlayer) = 1 Then
			AddScore 1010
		end if
		flasherspop green, "bottom"
		if wallagain = 0 then
			raisewall
		end if
	end Sub

	sub target16_hit
		potionhit
		AddScore 1000
		if pt7(CurrentPlayer) = 1 Then
			AddScore 1010
		end if	
		flasherspop green, "bottom"
		if wallagain = 0 then
			raisewall
		end if
	end Sub

		dim potneeded:potneeded=60	
	Sub potionhit
		if awarding=1 then exit sub
		If potionlevel(CurrentPlayer) = 0 then
			potneeded=60
			if potions(CurrentPlayer) = 60 then exit sub
		end if
		If potionlevel(CurrentPlayer) = 1 then
			potneeded=90
			if potions(CurrentPlayer) = 90 then exit sub
		end if
		If potionlevel(CurrentPlayer) = 2 then
			potneeded=120
			if potions(CurrentPlayer) = 120 then exit sub
		end if
		If potionlevel(CurrentPlayer) = 3 then
			potneeded=160
			if potions(CurrentPlayer) = 160 then exit sub
		end if
		If potionlevel(CurrentPlayer) = 4 then
			potneeded=200
			if potions(CurrentPlayer) = 200 then exit sub
		end if
		If potionlevel(CurrentPlayer) = 5 then
			potneeded=300
			if potions(CurrentPlayer) = 300 then exit sub
		end if
		If potionlevel(CurrentPlayer) = 6 then
			potneeded=400
			if potions(CurrentPlayer) = 400 then exit sub
		end if
		If potionlevel(CurrentPlayer) = 7 then
			potneeded=500
			if potions(CurrentPlayer) = 500 then exit sub
		end if
		setpotionname
		potions(CurrentPlayer) = potions(CurrentPlayer) + 1

		If potionlevel(CurrentPlayer) = 0 then
			If potions(currentplayer) > 60 Then
				if potioncall = 0 Then
					'PuPlayer.playlistplayex pCallouts,"audiocallouts","get the potion.wav",vovol,1
					playmedia "get the potion.wav","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
					pupDMDDisplay "-","Your Potion^is Ready",dmdnote,3,0,10
					potioncall = 1
				end If
				potions(CurrentPlayer) = 60
				potionready
				potready(CurrentPlayer) = 1
			End If
		end if

		If potionlevel(CurrentPlayer) = 1 then
			If potions(currentplayer) > 90 Then
				potions(CurrentPlayer) = 90
				if potioncall = 0 Then
					'PuPlayer.playlistplayex pCallouts,"audiocallouts","get the potion.wav",vovol,1
					playmedia "get the potion.wav","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
					pupDMDDisplay "-","Your Potion^is Ready",dmdnote,3,0,10
					potioncall = 1
				end If
				potionready
				potready(CurrentPlayer) = 1
			End If
		end if

		If potionlevel(CurrentPlayer) = 2 then
			If potions(currentplayer) > 120 Then
				potions(CurrentPlayer) = 120
				if potioncall = 0 Then
					'PuPlayer.playlistplayex pCallouts,"audiocallouts","get the potion.wav",vovol,1
					playmedia "get the potion.wav","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
					pupDMDDisplay "-","Your Potion^is Ready",dmdnote,3,0,10
					potioncall = 1
				end If
				potionready
				potready(CurrentPlayer) = 1
			End If
		end if

		If potionlevel(CurrentPlayer) = 3 then
			If potions(currentplayer) > 160 Then
				potions(CurrentPlayer) = 160
				if potioncall = 0 Then
					'PuPlayer.playlistplayex pCallouts,"audiocallouts","get the potion.wav",vovol,1
					playmedia "get the potion.wav","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
					pupDMDDisplay "-","Your Potion^is Ready",dmdnote,3,0,10
					potioncall = 1
				end If
				potionready
				potready(CurrentPlayer) = 1
			End If
		end if

		If potionlevel(CurrentPlayer) = 4 then
			If potions(currentplayer) > 200 Then
				potions(CurrentPlayer) = 200
				if potioncall = 0 Then
					'PuPlayer.playlistplayex pCallouts,"audiocallouts","get the potion.wav",vovol,1
					playmedia "get the potion.wav","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
					pupDMDDisplay "-","Your Potion^is Ready",dmdnote,3,0,10
					potioncall = 1
				end If
				potionready
				potready(CurrentPlayer) = 1
			End If
		end if

		If potionlevel(CurrentPlayer) = 5 then
			If potions(currentplayer) > 300 Then
				potions(CurrentPlayer) = 300
				if potioncall = 0 Then
					'PuPlayer.playlistplayex pCallouts,"audiocallouts","get the potion.wav",vovol,1
					playmedia "get the potion.wav","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
					pupDMDDisplay "-","Your Potion^is Ready",dmdnote,3,0,10
					potioncall = 1
				end If
				potionready
				potready(CurrentPlayer) = 1
			End If
		end if

		If potionlevel(CurrentPlayer) = 6 then
			If potions(currentplayer) > 400 Then
				potions(CurrentPlayer) = 400
				if potioncall = 0 Then
					'PuPlayer.playlistplayex pCallouts,"audiocallouts","get the potion.wav",vovol,1
					playmedia "get the potion.wav","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
					pupDMDDisplay "-","Your Potion^is Ready",dmdnote,3,0,10
					potioncall = 1
				end If
				potionready
				potready(CurrentPlayer) = 1
			End If
		end if

		If potionlevel(CurrentPlayer) = 7 then
			If potions(currentplayer) > 500 Then
				potions(CurrentPlayer) = 500
				if potioncall = 0 Then
					'PuPlayer.playlistplayex pCallouts,"audiocallouts","get the potion.wav",vovol,1
					playmedia "get the potion.wav","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
					pupDMDDisplay "-","Your Potion^is Ready",dmdnote,3,0,10
					potioncall = 1
				end If
				potionready
				potready(CurrentPlayer) = 1
			End If
		end if

		PuPlayer.LabelSet pBackglass,"potionnum",potneeded - potions(CurrentPlayer),1,"{'mt':2,'color':15066597, 'size': 4, 'xpos': 6.5, 'xalign': 1, 'ypos': 5.4, 'yalign': 1}"		
	end Sub


	Sub potionready
		t21.state = 2:t22.state = 2:t23.state = 2:t24.state = 2:t25.state=2:t26.state=2:pblit.state = 2
		potready(CurrentPlayer)=1
		ppblit(CurrentPlayer) = 1
	end Sub

	sub awardpotion
		potionlevel(CurrentPlayer) = potionlevel(CurrentPlayer)  + 1
		t21.state = 0:t22.state = 0:t23.state = 0:t24.state = 0:t25.state=0:t26.state=0:pblit.state = 0
		ppblit(CurrentPlayer) = 0
		potready(CurrentPlayer) = 0
		potions(CurrentPlayer) = 0
		potioncall = 0
		potionhit
		'potnum=1
		select case potnum
			case 1 : curpotion = "Amortentia" : awardamortentia ' 30 seconds of scoring is doubled.
			case 2 : curpotion = "Amortentia" : awardamortentia ' 30 seconds of scoring is doubled. 
			case 3 : curpotion = "Amortentia" : awardamortentia ' 30 seconds of scoring is doubled.
			case 4 : curpotion = "Confusing" : 	awardconfusing
			case 5 : curpotion = "Confusing" :	awardconfusing
			case 6 : curpotion = "Living Death" : awardld
			case 7 : curpotion = "Living Death" : awardld
			case 8 : curpotion = "Felix Felicis" : awardfelix
			case 9 : curpotion = "Felix Felicis" : awardfelix
			case 10 : curpotion = "Felix Felicis" : awardfelix
			case 11 : curpotion = "Hiccoughing" : awardhiccup
			case 12 : curpotion = "Hiccoughing" : awardhiccup
			case 13 : curpotion = "Pepperup" : awardpepper
			case 14 : curpotion = "Pepperup" : awardpepper
			case 15 : curpotion = "Polyjuice" : awardpoly
			case 16 : curpotion = "Skele-Gro" : awardskele
			case 17 : curpotion = "Sleekeazys Hair" : awardhair
			case 18 : curpotion = "Sleekeazys Hair" : awardhair
			case 19 : curpotion = "Veritaserum" : awardverit
			case 20 : curpotion = "Veritaserum" : awardverit
			case 21 : curpotion = "Wolfsbane" : awardwolf
			case 22 : curpotion = "Wolfsbane" : awardwolf
		end Select

	end Sub

	dim awamor
	dim confus
	Dim skele

	sub endaward
		awamor = 0
		confus = 0
		skele = 0
		pblit.state = 0
		ppblit(CurrentPlayer) = 0
		amortim.enabled = 0
		skele1.isdropped = 1
		skele2.isdropped = 1
	end Sub

	dim awarding:awarding=0
	sub doneawarding
		awarding=0
	end Sub

	amortim.enabled = 0
	dim dstime:dstime=0
	sub amortim_timer
		dstime = dstime + 1
		select case dstime
			case 30
			awamor = 0
			pblit.state = 0
			ppblit(CurrentPlayer) = 0
		end Select
	end Sub

	sub awardamortentia
		'Amortentia - love potion - Odds  3/22
		'30 seconds of scoring is doubled.
		awamor = 1
		amortim.enabled = 1
		playmedia "amort.mp4","videoscenes",pBackglass,"cineon",6000,"turnonpotionlight",1,4  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		vpmtimer.addtimer 6000, "doneawarding '"
	end Sub

	sub turnonpotionlight
		dropwall
		pblit.state = 2
		ppblit(CurrentPlayer) = 2
	end sub


	'/\/\/\/\/\/\/\/ COnfusing

	sub awardconfusing
		'Confusing Concoction - confused, distracted, sick - Odds 2/22	
		' points trippled but both flippers go everytime  20 seconds
		confus = 1
		conftim.enabled = 1
		playmedia "confusing.mp4","videoscenes",pBackglass,"cineon",6000,"turnonpotionlight",1,4  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		vpmtimer.addtimer 6000, "doneawarding '"
	end sub

	conftim.enabled = 0
	dim tstime:tstime=0
	sub conftim_timer
		tstime = tstime + 1
		select case tstime
			case 20
			confus = 0
			pblit.state = 0
			ppblit(CurrentPlayer) = 0
		end Select
	end Sub


	'/\/\/\/\/\/\/\/ Draft of Living Death


	sub awardld
		'Draught of Living Death - deep death like sleep - Odds 2/22
		' 30 second ball save
		playmedia "draftofliving.mp4","videoscenes",pBackglass,"cineon",6000,"dropwall",1,4  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		vpmtimer.addtimer 6000, "doneawarding '"
		EnableBallSaver 36:bBallSaverActive = True
	end sub


	'/\/\/\/\/\/\/\/ Felix Felicis

	sub awardfelix
		'Felix Felicis - unusually good luck - Odds 3/22
		'wand multiball ready'
		wandlocks(CurrentPlayer) = 1
		totalcombo(CurrentPlayer) = 10
		checkcombos
		wandclose
		playmedia "felix.mp4","videoscenes",pBackglass,"cineon",6000,"",1,4  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		bMultiBallMode = 1
		vpmtimer.addtimer 6000, "startwandmulti '"
		vpmtimer.addtimer 6000, "doneawarding '"
	end sub



	'/\/\/\/\/\/\/\/ Hiccouphing

	sub awardhiccup
		'Hiccoughing Potion - stops excessive hiccuping - Odds 2/22
		' add a ball, mini multiball
		playmedia "hiccup.mp4","videoscenes",pBackglass,"cineon",6000,"dropwall",1,4  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		vpmtimer.addtimer 6000, "doneawarding '"
		BallsOnPlayfield = BallsOnPlayfield + 1
		BallRelease.CreateSizedball BallSize / 2
		PlaySoundAt SoundFXDOF("mbpc-ballrelease", 114, DOFPulse, DOFContactors), BallRelease
		BallRelease.Kick 90, 41
		bBallSaverActive = False
		EnableBallSaver 5:bBallSaverActive = True
	end Sub



	'/\/\/\/\/\/\/\/ Pepperup

	dim awapepper:awapepper=0

	sub awardpepper
		'Pepperup Potion - improves health - Odds 2/22
		'start a mode
		playmedia "pepperup.mp4","videoscenes",pBackglass,"cineon",6000,"",1,4  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		vpmtimer.addtimer 6000, "startamode '"
		awapepper=1
	end Sub


	'/\/\/\/\/\/\/\/ Polyjuice

	dim polyj:polyj=0
	dim lastmb:lastmb="none"
	sub awardpoly
		dim thismb
		'Polyjuice Potion - appear as someone else - Odds 1/22
		'instantly restart the last multiball that was played
		if lastmb = "none" Then
			thismb ="startwandmulti '"
		Else
			thismb = lastmb
		End If
		bMultiBallMode = 1
		playmedia "polyjuice.mp4","videoscenes",pBackglass,"cineon",6000,"",1,4  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		vpmtimer.addtimer 6000, thismb
		vpmtimer.addtimer 6000, "doneawarding '"
		vpmtimer.addtimer 6000, "dropwall '"

	end sub


	'/\/\/\/\/\/\/\/ Skele-gro

	sub awardskele
		'Skele-Gro - redrow bones - Odds 1/22
		'Builds a barricade across the outlanes for the rest of the ball so the player can only drain down the center.
		raisebarricades
		playmedia "skelegro.mp4","videoscenes",pBackglass,"cineon",6000,"dropwall",1,4  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		vpmtimer.addtimer 6000, "doneawarding '"
	end sub

		skele1.isdropped = 1
		skele2.isdropped = 1	

	sub raisebarricades
		skele1.isdropped = 0
		skele2.isdropped = 0		
	end sub


	'/\/\/\/\/\/\/\/ Hair Potion

	sub awardhair
		'Sleekeazys Hair Potion - beauty treatement to smooth hair - Odds 2/22
		'Big points, damn you look good.
		playmedia "hair.mp4","videoscenes",pBackglass,"cineon",6000,"dropwall",1,4  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		vpmtimer.addtimer 6000, "doneawarding '"
		addscore 5000000
		pupDMDDisplay "-","Big Points^5,000,000",dmdnote,3,0,10
	end sub


	'/\/\/\/\/\/\/\/ Veritserum

	sub awardverit
		'Veritaserum - truth potion - Odds 2/22
		'extra ball.
		playmedia "verit.mp4","videoscenes",pBackglass,"cineon",6000,"dropwall",1,4  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		vpmtimer.addtimer 6000, "doneawarding '"
		vpmtimer.addtimer 6000, "veb '"
	end sub

	sub veb
			AwardExtraBall
			playmedia "extraball.mp4","videoscenes",pBackglass,"",7000,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
	end Sub


	'/\/\/\/\/\/\/\/ Wolfsbane

	sub awardwolf

		'Wolfsbane Potion - Warewolf sanity serum - Odds 2/22
		'Medium Points
		playmedia "wolfsbane.mp4","videoscenes",pBackglass,"cineon",6000,"dropwall",1,4  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		vpmtimer.addtimer 6000, "doneawarding '"
		addscore 1000000
		pupDMDDisplay "-","Medium Points^1,000,000",dmdnote,3,0,10
	end sub



	sub raisewall
		if bMultiBallMode = true then exit sub
		if inamode = 1 then exit sub
		cauldron4.z = 0
		wallagain = 1
		spinner.MotorOn = true
		spinning.enabled = true
		cauldron4.collidable = true
		gioff
		vpmtimer.addtimer 10000, "checkwall '"
		If potready(CurrentPlayer) = 1 Then
			awardpotion
			PlaySound "IdolMotor"
			awarding=1
		Else
			if inamode = 0 Then
			playmedia "potionbg.mp4","videoscenes",pBackglass,"",4000,"",1,1
			PlaySound "IdolMotor"
			PlaySound "bubble"
			PlaySound "cauldron"
			vpmtimer.addtimer 2500, "dropwall '"
			DOF 341, DOFPulse 'MX - Potion - End - Poof
			end if
		end if
		DOF 129, DOFPulse 'Shaker - Potion
	end Sub

	sub checkwall
	 if cauldron4.z = 0 then
	  dropwall
	  end if
	end sub

	sub dropwall
		if bMultiBallMode = 0 and inamode = 0 Then
			playclear pBackglass
		end If
		cauldron4.z = - 60
		spinner.MotorOn = false
		spinning.enabled = false
		cauldron4.collidable = false
		StopSound "IdolMotor"
		vpmtimer.addtimer 1000, "deactivatewall '"
'		checkpotions
		gion
		if potneeded = potions(CurrentPlayer) Then
			potionready
		end if
		PuPlayer.LabelSet pBackglass,"potionnum",potneeded - potions(CurrentPlayer),1,"{'mt':2,'color':15066597, 'size': 4, 'xpos': 6.5, 'xalign': 1, 'ypos': 5.4, 'yalign': 1}"
	end Sub

	dim potioncall:potioncall = 0

'	sub checkpotions
'		If potions(CurrentPlayer) > 59 Then
'			if potioncall = 0 then
'			PuPlayer.playlistplayex pCallouts,"audiocallouts","get the potion.wav",vovol,1: pupDMDDisplay "-","Your Potion^is Ready",dmdnote,3,0,10
'			end If
'			potioncall = 1
'			'chilloutthemusic
'			s24.state = 2
'		end If
'	end sub


	dim wallagain:wallagain = 0
	sub deactivatewall
		wallagain = 0
	end sub


	dim potnum:potnum=1
	dim curpotion:curpotion = "Amortentia"
	sub setpotionname
		potnum = RndNum(1,22)
		select case potnum
			case 1 : curpotion = "Amortentia"
			case 2 : curpotion = "Amortentia"
			case 3 : curpotion = "Amortentia"
			case 4 : curpotion = "Confusing" 
			case 5 : curpotion = "Confusing" 
			case 6 : curpotion = "Living Death" 
			case 7 : curpotion = "Living Death" 
			case 8 : curpotion = "Felix Felicis" 
			case 9 : curpotion = "Felix Felicis"
			case 10 : curpotion = "Felix Felicis" 
			case 11 : curpotion = "Hiccoughing" 
			case 12 : curpotion = "Hiccoughing"
			case 13 : curpotion = "Pepperup" 
			case 14 : curpotion = "Pepperup" 
			case 15 : curpotion = "Polyjuice" 
			case 16 : curpotion = "Skele-Gro"
			case 17 : curpotion = "Sleekeazys Hair" 
			case 18 : curpotion = "Sleekeazys Hair" 
			case 19 : curpotion = "Veritaserum"
			case 20 : curpotion = "Veritaserum" 
			case 21 : curpotion = "Wolfsbane" 
			case 22 : curpotion = "Wolfsbane" 
		end Select
	end Sub



















	'****************************
	' POTTER TARGETS FOR MODE START
	'****************************

	Sub target7_hit
		AddScore 10000
		DOF 334, DOFPulse 'P Target
		if pt7(CurrentPlayer) = 1 Then
			AddScore 10000
		end if
		tgsound
		if inamode = 0 Then
			t27.state = 1
			pt27(CurrentPlayer) = 1
			pottertargettasks
		end If
	End Sub

	Sub target4_hit
		AddScore 10000
		DOF 335, DOFPulse 'O Target
		if pt7(CurrentPlayer) = 1 Then
			AddScore 10000
		end if
		tgsound
		if inamode = 0 Then
			t28.state = 1
			pt28(CurrentPlayer) = 1
			pottertargettasks
		end If
	End Sub

	Sub target5_hit
		AddScore 10000
		DOF 336, DOFPulse 'T Target
		if pt7(CurrentPlayer) = 1 Then
			AddScore 10000
		end if
		tgsound
		if inamode = 0 Then
			t29.state = 1
			pt29(CurrentPlayer) = 1
			pottertargettasks
		end If
	End Sub

	Sub target20_hit
		AddScore 10000
		DOF 337, DOFPulse 'T Target
		if pt7(CurrentPlayer) = 1 Then
			AddScore 10000
		end if
		tgsound
		if inamode = 0 Then
			t30.state = 1
			pt30(CurrentPlayer) = 1
			pottertargettasks
		end If
	End Sub

	Sub target9_hit
		AddScore 10000
		DOF 338, DOFPulse 'E Target
		if pt7(CurrentPlayer) = 1 Then
			AddScore 10000
		end if
		tgsound
		if inamode = 0 Then
			t31.state = 1
			pt31(CurrentPlayer) = 1
			pottertargettasks
		end If
	End Sub

	Sub target10_hit
		AddScore 10000
		DOF 339, DOFPulse 'R Target
		if pt7(CurrentPlayer) = 1 Then
			AddScore 10000
		end if
		tgsound
		if inamode = 0 Then
			t32.state = 1
			pt32(CurrentPlayer) = 1
			pottertargettasks
		end if
	End Sub

	sub pottertargettasks
		checklogic
		AddPoints(1)
	end Sub


	dim tghits:tghits=0
	dim tgpos:tgpos=0
	sub tgsound
		if tghits = 1 then exit Sub
		tghits = 1
		tgpos = tgpos + 1
		select case tgpos
			case 1
				PlaySoundAt "hit1", ActiveBall
			case 2
				PlaySoundAt "hit2", ActiveBall
			case 3
				PlaySoundAt "hit3", ActiveBall
			case 4
				PlaySoundAt "hit4", ActiveBall		
			case 5
				PlaySoundAt "hit5", ActiveBall			
				tgpos = 0
		end Select
		vpmtimer.addtimer 500, "tgdone '"
	end Sub

	sub tgdone
		tghits = 0
	end Sub




	Sub rohit_hit
		if skillshotlive = 1 Then
			awardskillshot
		End If
		If bballfirstball = 1 Then
		Else
			if bBallSaverActive = true Then
			Else
			checkcombos
			End if
		End If
		if inmazemulti = 1 Then
			If s91.state = 2 Then
				mazejphit
			end If
		end If
		if incurses = 1 Then
			cursesjp
		end if
		if bMultiBallMode = 0 and inamode = 0 Then
			spinnervid
		end if 
		if bMultiBallMode = 0 and inamode = 0 and skillshotlive = 0 and bballfirstball = 0 Then
			'***** LIGHT RUNS *****
			'(CHAOS)randoms
			'(DIRECTIONS)uup|udown|uleft|uright|diagdl|diagdr|diagul|diagur
			'(SWIPES)middleih|middleiv|middleoh|middleov|stripe1h|hatch1h|hatch1v|hatch2h|hatch2v|stripe1v|stripe2h|stripe2v
			'(SPINS)circlein|circleout|clockleft|clockright|screwl|screwr
			'(CURVES)arcbld|arcblu|arcbrd|arcbru|arctld|arctlu|arctrd|arctru|fanld|fanlu|fanrd|fanru|radarl|radarr|wiperl|wiperr
			'(EXAMPLE)lightrun red,arcbld,1  (SYNTAX)lightrun color,direction,times to run
			lightrun amber,screwl, 1
		end if
	End Sub

	Sub ro2hit_hit
		checkcombos
		if inwandmulti = 1 Then
			wandjackpot
		end If
		if inmazemulti = 1 Then
			If s81.state = 2 Then
				mazejphit
			end If
		end If
		if bMultiBallMode = 0 and inamode = 0 Then
			spinnervid
		end if
	End Sub

	Sub ro3hit_hit
		if skillshotlive = 1 Then
			awardskillshot
		End If
		checkcombos
		if inwandmulti = 1 Then
			wandjackpot
		end If
		if inmazemulti = 1 Then
			If s61.state = 2 Then
				mazejphit
			end If
		end If
		if incurses = 1 Then
			cursesjp
		end if
		if bMultiBallMode = 0 and inamode = 0 Then
			spinnervid
			'***** LIGHT RUNS *****
			'(CHAOS)randoms
			'(DIRECTIONS)uup|udown|uleft|uright|diagdl|diagdr|diagul|diagur
			'(SWIPES)middleih|middleiv|middleoh|middleov|stripe1h|hatch1h|hatch1v|hatch2h|hatch2v|stripe1v|stripe2h|stripe2v
			'(SPINS)circlein|circleout|clockleft|clockright|screwl|screwr
			'(CURVES)arcbld|arcblu|arcbrd|arcbru|arctld|arctlu|arctrd|arctru|fanld|fanlu|fanrd|fanru|radarl|radarr|wiperl|wiperr
			'(EXAMPLE)lightrun red,arcbld,1  (SYNTAX)lightrun color,direction,times to run
			lightrun amber,screwl, 1
		end if

	End Sub


	sub spinnervid
		dim randy
		randy = RndNum(1,14)
		select case randy
		case 3 : 'PuPlayer.playlistplayex pBackglass,"videospinners","",vsvol,1
			playmedia "","videospinners",pBackglass,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		end Select
	end Sub




'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  SECONDARY HIT EVENTS
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 

	Dim RStep, Lstep

	Sub RightSlingShot1_slingshot
		addscore 1000
		movemodes
		if bMultiBallMode = 0 and inamode = 0 Then
			maybemadeye
		end If
		spinningeye.enabled = 1
		eyespin = 1
		DOF 105, DOFPulse
		PlaySound SoundFX("right_slingshot",DOFContactors), 0,1, 0.05,0.05 '0,1, AudioPan(RightSlingShot), 0.05,0,0,1,AudioFade(RightSlingShot)
	End Sub

	sub maybemadeye
		dim maddy
		maddy = RndNum(1,14)
		select case maddy
			case 3 : 'PuPlayer.playlistplayex pBackglass,"videomadeye","",vsvol,
			playmedia "","videomadeye",pBackglass,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		end Select
	end Sub

	Sub LeftSlingShot1_slingshot
		addscore 1000
		movemodes
		DOF 103, DOFPulse
		PlaySound SoundFX("left_slingshot",DOFContactors), 0,1, -0.05,0.05 '0,1, AudioPan(LeftSlingShot), 0.05,0,0,1,AudioFade(LeftSlingShot)
	End Sub

	Sub RightSlingShot_Slingshot
		movemodes
		if bMultiBallMode = 0 and inamode = 0 Then
			maybemadeye
		end If
		FlashForMs l21, 1000, 50, 0:FlashForMs l20f1, 1000, 50, 0
		spinningeye.enabled = 1
		eyespin = 1
		DOF 105, DOFPulse
		PlaySound SoundFX("right_slingshot",DOFContactors), 0,1, 0.05,0.05 '0,1, AudioPan(RightSlingShot), 0.05,0,0,1,AudioFade(RightSlingShot)
		RSling.Visible = 0
		RSling1.Visible = 1
		sling1.TransZ = -20
		RStep = 0
		RightSlingShot.TimerEnabled = 1

	End Sub

	Sub RightSlingShot_Timer
		Select Case RStep
			Case 3:RSLing1.Visible = 0:RSLing2.Visible = 1:sling1.TransZ = -10
			Case 4:RSLing2.Visible = 0:RSLing.Visible = 1:sling1.TransZ = 0:RightSlingShot.TimerEnabled = 0
		End Select
		RStep = RStep + 1
	End Sub

	Sub LeftSlingShot_Slingshot
		movemodes
		FlashForMs l20, 1000, 50, 0:FlashForMs l20f, 1000, 50, 0
		DOF 103, DOFPulse
		PlaySound SoundFX("left_slingshot",DOFContactors), 0,1, -0.05,0.05 '0,1, AudioPan(LeftSlingShot), 0.05,0,0,1,AudioFade(LeftSlingShot)
		LSling.Visible = 0
		LSling1.Visible = 1
		sling2.TransZ = -20
		LStep = 0
		LeftSlingShot.TimerEnabled = 1

	End Sub

	Sub LeftSlingShot_Timer
		Select Case LStep
			Case 3:LSLing1.Visible = 0:LSLing2.Visible = 1:sling2.TransZ = -10
			Case 4:LSLing2.Visible = 0:LSLing.Visible = 1:sling2.TransZ = 0:LeftSlingShot.TimerEnabled = 0
		End Select
		LStep = LStep + 1
	End Sub


	Sub RotateLaneLightsLeft
		Dim TempState
		'TempState = l6.State
		'l6.State = l7.State
		'l7.State = l8.State
		'l8.State = l9.State
		'l9.State = TempState
	End Sub

	Sub RotateLaneLightsRight
		Dim TempState
		'TempState = l9.State
		'l9.State = l8.State
		'l8.State = l7.State
		'l7.State = l6.State
		'l6.State = TempState
	End Sub


		Kicker2.CreateSizedball BallSize / 2
		Kicker2.Kick 90, 1
		Kicker3.CreateSizedball BallSize / 2
		Kicker3.Kick 90, 1
		Kicker2.enabled = false





	dim rightd:rightd=0
	sub openmaze
			PlaySound "mbpc-plasticroll"
			rightdivert.RotateToEnd
			PlaySoundAt "mbpc-diverter", rightdivert
			Ramp83.collidable = 1
			mazegate1.z=200
			mazegate2.z=200
	end Sub

	sub closemaze
			PlaySound "mbpc-plasticroll"
			rightdivert.RotateToStart
			PlaySoundAt "mbpc-diverter", rightdivert
			rightd=0
			Ramp83.collidable = 0
			mazegate1.z=0
			mazegate2.z=0
	end Sub

	sub topdivert3_hit
		PlaySound "mbpc-plasticroll"
	end sub

dim rightd1:rightd1=0
sub topdivert1_hit
		if bMultiBallMode = 0 and inamode = 0 Then
			'PuPlayer.playlistplayex pBackglass,"videogolet","",vsvol,1
			playmedia "","videogoblet",pBackglass,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		end If
		if inwandmulti = 1 Then
			wandjackpot
		end If
'	If rightd1=0 Then
'		rightdivert1.RotateToEnd
'		PlaySoundAt "mbpc-diverter", rightdivert1
'		Ramp84.collidable = 1
'		rightd1=1
'	Else
'		rightdivert1.RotateToStart
'		PlaySoundAt "mbpc-diverter", rightdivert1
'		rightd1=0
'		Ramp84.collidable = 0
'	End If
end Sub

	Dim MagnetR
	 Set MagnetR = New cvpmMagnet
		With MagnetR
			.InitMagnet leftmagnet, 80
			.GrabCenter = True
			.MagnetOn = 0
			.CreateEvents "MagnetR"
		End With

	Sub loopmag_hit
		if inmermulti = 0 Then
			boltl.state = 2
			boltr.state = 2
			MagnetR.MagnetON = true
			vpmtimer.addtimer 3000, "turnoffmag '"
			PlaySound "IdolMotor"
		end If
	End Sub

	sub leftmagnet1_hit
		if boltl.state = 2 Then
			PlaySoundAt "mbpc-magnet", leftmagnet
			PlaySoundAt "magnet", leftmagnet
		end if
	end Sub

	sub turnoffmag
		MagnetR.MagnetON = false
		boltl.state = 0
		boltr.state = 0
		StopSound "IdolMotor"
	End Sub


	sub lrstart_hit
		checkleft
		If skillshotlive = 1 then
			AwardSkillshot
		End If
		PlaySoundAt "fx_metalrolling", lrstart
		StopSound "mbpc-plasticroll"
		if inwandmulti = 1 Then
			wandjackpot
		end If
		if inquid = 1 Then
			quidjp
		end If
		If indragon = 1 Then
			if s31.state = 2 Then
				dragonjackpot
			end If
		end If
		if inmazemulti = 1 Then
			If s51.state = 2 Then
				mazejphit
			end If
		end If
	end sub

	sub rrstart_hit
		flamesoff
		If ingob = 1 Then
			gobjpget
		end If
		if inquid = 1 Then
			quidjp
		end If
		addgoblets
		checkright
		PlaySoundAt "fx_metalrolling", lrstart
		StopSound "mbpc-plasticroll"
		If indragon = 1 Then
			if s31.state = 2 Then
				dragonjackpot
			end If
		end If
	end sub

	Sub lrend_hit
		AddScore 20000
		if pt6(CurrentPlayer) = 1 Then
			Addscore 20000
		end If
		StopSound "fx_metalrolling"
		PlaySoundAt "metalhit_thin", lrend
		PlaySoundAt "fx_balldrop", lrend
		checkcombos
	End sub

	Sub rrend_hit
		AddScore 20000
		if pt6(CurrentPlayer) = 1 Then
			Addscore 20000
		end If

		StopSound "fx_metalrolling"
		PlaySoundAt "metalhit_thin", rrend
		PlaySoundAt "fx_balldrop", rrend
		checkcombos

	End sub

	Sub lrend2_hit
		AddScore 20000
		if pt6(CurrentPlayer) = 1 Then
			Addscore 20000
		end If
		StopSound "fx_metalrolling"
		PlaySoundAt "metalhit_thin", lrend
		PlaySoundAt "fx_balldrop", lrend

	End sub


	sub launchstart_hit
		PlaySoundAt "fx_metalrolling", launchstart
		PlaySound "launchwind"
	end sub

	sub cupend_hit
		flamesoff
		addgoblets
		if pt6(CurrentPlayer) = 1 Then
			Addscore 20000
		end If
		If ingob = 1 Then
			gobjpget
		end If
		AddScore 20000
		checkright
		PlaySoundAt "fx_balldrop", cupend
		StopSound "mbpc-plasticroll"
		checkcombos
		if inwandmulti = 1 Then
			wandjackpot
		end If
	End sub

	Sub Spinner1_Spin
		PlaySoundAt "mbpc-spinner", Spinner1
	End Sub




	Sub Spinner3_Spin
		PlaySoundAt "mbpc-spinner", Spinner3
	End Sub

	Sub innerorbitsnd_hit
				if bMultiBallMode = false then
		PlaySoundAt "shimmer", Spinner3
		DOF 350, DOFPulse 'Shimmer Spinner - Colours
		End if
	End Sub


	dim rmpsnd
	rmpsnd = 0
	Sub gate9_hit
		PlaySoundAt "mbpc-gate", gate9
		if bMultiBallMode = false then
			if rmpsnd = 0 then
				PlaySoundAt "leftramp", gate9
				rmpsnd = 1
				vpmtimer.addtimer 4000, "rampsound '"
			end if
		end if
		StopSound "mbpc-plasticroll"
	End Sub

	sub rampsound
		rmpsnd = 0
	end Sub

	Sub gate5_hit
		PlaySoundAt "mbpc-gate", gate9
		if bMultiBallMode = false then
			if rmpsnd = 0 then
				PlaySoundAt "rightramp", gate5
				rmpsnd = 1
				vpmtimer.addtimer 4000, "rampsound '"
			end if
		end if
		StopSound "mbpc-plasticroll"
	End Sub




	' goblets Hit
	' order of merlin
	Sub addgoblets
		goblets(CurrentPlayer) = goblets(CurrentPlayer) + 1
		If goblets(CurrentPlayer) > 15 Then
		PuPlayer.LabelSet pBackglass,"gobletnum",0,1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 8.8, 'xalign': 1, 'ypos': 88.8, 'yalign': 1}"
		Else
		PuPlayer.LabelSet pBackglass,"gobletnum",15 - goblets(CurrentPlayer),1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 8.8, 'xalign': 1, 'ypos': 88.8, 'yalign': 1}"
		end If
		If goblets(CurrentPlayer) > 14 Then
			'PuPlayer.playlistplayex pCallouts,"audiocallouts","superramps.mp3",vovol,1
			playmedia "superramps.mp3","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			t6.state = 1
			pt6(CurrentPlayer) = 1
			pNote "Order of Merlin","Super Ramps"
			pupDMDDisplay "-","Order of Merlin^Super Ramps",dmdnote,3,0,10
		end If
	end Sub



'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  MODES
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 
' mode Lights

	Dim t12done(4)
	Dim t13done(4)
	Dim t14done(4)
	Dim t15done(4)
	'Dim t16done(4)
	'Dim t17done(4)
	Dim activemode(4)
	
	resetmodes
	sub resetmodes
		dim i
		For i = 0 to 4
			t12done(i) = 0
			t13done(i) = 0
			t14done(i) = 0
			t15done(i) = 0
	'		t16done(i) = 0
	'		t17done(i) = 0
			activemode(i) = 0
		Next
	End Sub

	sub checkmodes
		If t12done(currentplayer) = 1 Then
			t12.state = 1
			SetLightColor t12, blue, -1
		Else
			t12.state = 0
		End If

		If t13done(currentplayer) = 1 Then
			t13.state = 1
			SetLightColor t13, blue, -1
		Else
			t13.state = 0
		End If

		If t14done(currentplayer) = 1 Then
			t14.state = 1
			SetLightColor t14, blue, -1
		Else
			t14.state = 0
		End If

		If t15done(currentplayer) = 1 Then
			t15.state = 1
			SetLightColor t15, blue, -1
		Else
			t15.state = 0
		End If

	'	If t16done(currentplayer) = 1 Then
	'		t16.state = 1
	'		SetLightColor t16, blue, -1
	'	Else
	'		t16.state = 0
	'	End If

	'	If t17done(currentplayer) = 1 Then
	'		t17.state = 1
	'		SetLightColor t17, blue, -1
	'	Else
	'		t17.state = 0
	'	End If
	end Sub
	

	sub movemodes
		checkmodes
		activemode(currentplayer) = activemode(CurrentPlayer) + 1
		select case activemode(CurrentPlayer)
			case 1
				If t12done(CurrentPlayer) = 1 Then
					t12.state = 1
					SetLightColor t12, blue, -1
					movemodes
				Else
					t12.state = 1
					SetLightColor t12, darkgreen, -1
				End If
			case 2
				If t13done(CurrentPlayer) = 1 Then
					t13.state = 1
					SetLightColor t13, blue, -1
					movemodes
				Else
					t13.state = 1
					SetLightColor t13, darkgreen, -1
				End If
			case 3
				If t14done(CurrentPlayer) = 1 Then
					t14.state = 1
					SetLightColor t14, blue, -1
					movemodes
				Else
					t14.state = 1
					SetLightColor t14, darkgreen, -1
				End If
			case 4
				If t15done(CurrentPlayer) = 1 Then
					t15.state = 1
					SetLightColor t15, blue, -1
					movemodes
				Else
					t15.state = 1
					SetLightColor t15, darkgreen, -1
				End If
			'case 5
			'	If t16done(CurrentPlayer) = 1 Then
			'		t16.state = 1
			'		SetLightColor t16, blue, -1
			'		movemodes
			'	Else
			'		t16.state = 1
			'		SetLightColor t16, darkgreen, -1
			'	End If
		'	case 6
		'		If t17done(CurrentPlayer) = 1 Then
		'			t17.state = 1
		'			SetLightColor t17, blue, -1
		'			movemodes
		'		Else
		'			t17.state = 1
		'			SetLightColor t17, darkgreen, -1
		'		End If
			case 5
				activemode(CurrentPlayer) = 0
				movemodes
		End Select
	end Sub


	Sub startamode
		s72.state = 0
		rightdug.state = 0
		pt72(CurrentPlayer) = 0
		pickamode
		inamode = 1
		t27.state = 0
		pt27(CurrentPlayer) = 0
		t28.state = 0
		pt28(CurrentPlayer) = 0
		t29.state = 0
		pt29(CurrentPlayer) = 0
		t30.state = 0
		pt30(CurrentPlayer) = 0
		t31.state = 0
		pt31(CurrentPlayer) = 0
		t32.state = 0
		pt32(CurrentPlayer) = 0
	End Sub

	sub pickamode
		if inamode = 1 Then
			lkcheckmer
		else
			if t12.state = 1 and t12done(currentplayer) = 0 Then
				startquiddich
			end if

			if t13.state = 1 and t13done(currentplayer) = 0 Then
				startgoblet
			end if

			if t14.state = 1 and t14done(currentplayer) = 0 Then
				startcurses
			end if

			if t15.state = 1 and t15done(currentplayer) = 0 Then
				startdeath
			end if
		end if
	end Sub



	sub starttheclock
		modetimeleft.enabled = 1
		if bMultiBallMode = false Then
			GiOn
			gicolor(purple)
		end If
		modelightscheck
	end sub



	'modetimeleft - it's a sec a roll
	
	dim modesecs:modesecs = 0
	dim inamode:inamode = 0

	Sub modetimeleft_timer
		if bMultiBallMode = false Then
			GiOn
			gicolor(purple)
		end If
		modelightscheck
		if indeath = 1 Then
			deathcheck
		end If
		if inbumps = 0 and cineon = 0 Then
			modesecs = modesecs +1
			PuPlayer.LabelSet pBackglass,"modetimernum",45 - modesecs,1,"{'mt':2,'color':15066597, 'size': 4, 'xpos': 61.4, 'xalign': 1, 'ypos': 74.8, 'yalign': 1}"
		end If
		select case modesecs
		case 30
			'PuPlayer.playlistplayex pCallouts,"audiocallouts","timesalmostup.mp3",vovol,3
			playmedia "timesalmostup.mp3","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			pupDMDDisplay "-","Mode Time^Almost Up",dmdnote,3,0,10
		case 40
			'PuPlayer.playlistplayex pCallouts,"audiocallouts","countdown.mp3",vovol,3
			playmedia "countdown.mp3","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)	
		case 45
			endamode
			PuPlayer.LabelSet pBackglass,"modetimernum",0,1,"{'mt':2,'color':15066597, 'size': 4, 'xpos': 61.4, 'xalign': 1, 'ypos': 74.8, 'yalign': 1}"
		End select
	End Sub

	Sub endamode
		PuPlayer.LabelSet pBackglass,"modetimernum",0,1,"{'mt':2,'color':15066597, 'size': 4, 'xpos': 61.4, 'xalign': 1, 'ypos': 74.8, 'yalign': 1}"
		if inamode = 1 Then
			modescompleted(currentplayer) = modescompleted(CurrentPlayer) + 1
		end If
		inamode = 0
		inquid = 0
		ingob = 0
		incurses = 0
		indeath = 0
		DOF 411, DOFOff 'Quidditch - Stars
		DOF 412, DOFOff 'GOF - Stars
		DOF 413, DOFOff 'Curses - Stars
		DOF 414, DOFOff 'Escape DE - Stars
		droppops
		modetimeleft.enabled = 0
		modesecs = 0
		if bMultiBallMode = false then
			playclear pBackglass
			PuPlayer.SetLoop 2,0
			'PuPlayer.playresume 4
			playclear pAudio
			TurnOffmultiLights
			GiOff
			GiOn
			spotson
			gicolor(base)
			resetcolors
			relighttable
		playbgaudio
		end If
		checkmodeeb
		gobjp = 0
		'check if full up and reset
	end Sub

	sub checkmodeeb
		if modescompleted(CurrentPlayer) > 3 Then
			PuPlayer.LabelSet pBackglass,"modenum",0,1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 25.8, 'xalign': 1, 'ypos': 88.8, 'yalign': 1}"
		Else
			PuPlayer.LabelSet pBackglass,"modenum",3-modescompleted(CurrentPlayer),1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 25.8, 'xalign': 1, 'ypos': 88.8, 'yalign': 1}"
		end if
		if modescompleted(currentplayer) = 2 Then
			if modeeb(CurrentPlayer) = 0 Then
				s71.state = 2
				ps71(CurrentPlayer) = 1
				'PuPlayer.playlistplayex pCallouts,"audiocallouts","extra ball is lit.wav",vovol,3
				playmedia "extra ball is lit.wav","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
				pupDMDDisplay "-","Extra Ball^is Lit",dmdnote,3,0,10
				modeeb(CurrentPlayer) = 1
			end If
		end If
		if modescompleted(currentplayer) = 3 Then
			'PuPlayer.playlistplayex pCallouts,"audiocallouts","superorbits.mp3",vovol,1
			playmedia "superorbits.mp3","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			pupDMDDisplay "-","Order of Merlin^Super Orbits",dmdnote,3,0,10
			t8.state = 1
			pt8(CurrentPlayer) = 1
		end If
	end Sub

	sub modelightscheck
		if inquid = 1 Then
			lightquid
		end If
		if ingob = 1 Then
			lightgob
		end If
		if incurses = 1 Then
			lightcurses
		end If
		if indeath = 1 Then
			lightdeath
		end If
		if bMultiBallMode = false Then
			GiOn
			gicolor(purple)
		end If
	end Sub


	'****************
	'	Mode 1 - Quiddich World Cup - t12
	'	Hit the ramp rings to score (maybe left is one team right is another w/ different rewards?)
	'****************

	dim inquid:inquid = 0
	sub startquiddich
		DOF 411, DOFOn 'Quidditch - Stars
		pNote "Mode Start","Quiddich World Cup"
		pupDMDDisplay "-","Quiddich^World Cup",dmdnote,3,0,10
		GiOff
		'PuPlayer.playlistplayex pBackglass,"videoscenes","quiddichworldcup.mp4",vsvol,1
		playmedia "quiddichworldcup.mp4","videoscenes",pBackglass,"cineon",15000,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		PuPlayer.SetLoop 2,1
		'PuPlayer.playpause 4
		playclear pMusic
		vpmtimer.addtimer 15000, "actuallystartquid '"	
		vpmtimer.addtimer 10000, "lightquid '"	
		'vpmtimer.addtimer 14000, "quidaudio '"	
		inquid = 1
	End Sub

	sub quidaudio
		'PuPlayer.playpause 4
		playclear pMusic
		'PuPlayer.playlistplayex pAudio,"audiomodes","quiddich.mp3",100,1
		playmedia "quiddich.mp3","audiomodes",pAudio,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
	end sub
	
	sub lightquid
			s31.state = 0
			s32.state = 0
			s33.state = 0
			s34.state = 0
			s51.state = 0
			s52.state = 0
			s53.state = 0
			s54.state = 0
		if bMultiBallMode = false Then
			s31.state = 2
			s32.state = 2
			s33.state = 2
			s34.state = 2
			s51.state = 2
			s52.state = 2
			s53.state = 2
			s54.state = 2
			SetLightColor s51, purple, -1
			SetLightColor s52, purple, -1
			SetLightColor s53, purple, -1
			SetLightColor s54, purple, -1
			SetLightColor s31, purple, -1
			SetLightColor s32, purple, -1
			SetLightColor s33, purple, -1
			SetLightColor s34, purple, -1
		Else
			s32.state = 2
			s52.state = 2
			SetLightColor s32, purple, -1
			SetLightColor s52, purple, -1	
		end If
	end Sub

	sub quidjp
		DOF 420, DOFPulse 'MX Jackpot Effects
		'PuPlayer.playlistplayex pCallouts,"audiocheers","",vovol,1
		playmedia "","audiocheers",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		'chilloutthemusic
		pNote "Mode Jackpot","900,000"
		pupDMDDisplay "-","Mode Jackpot^900,000",dmdnote,3,0,10
		addscore 900000
		flasherspop purple,"crazy"
		giflash
			'***** LIGHT RUNS *****
			'(CHAOS)randoms
			'(DIRECTIONS)uup|udown|uleft|uright|diagdl|diagdr|diagul|diagur
			'(SWIPES)middleih|middleiv|middleoh|middleov|stripe1h|hatch1h|hatch1v|hatch2h|hatch2v|stripe1v|stripe2h|stripe2v
			'(SPINS)circlein|circleout|clockleft|clockright|screwl|screwr
			'(CURVES)arcbld|arcblu|arcbrd|arcbru|arctld|arctlu|arctrd|arctru|fanld|fanlu|fanrd|fanru|radarl|radarr|wiperl|wiperr
			'(EXAMPLE)lightrun red,arcbld,1  (SYNTAX)lightrun color,direction,times to run
			lightrun purple,stripe1v, 1
	end Sub


	sub actuallystartquid
		dropwall
		if s31.state = 2 Then
		else
			lightquid
		end If
		quidaudio
		lkcheckmer	
	end sub




	'****************
	'	Mode 2 - Goblet of Fire - t13
	'	Spin the cup (put a cup booster in and close the cup)
	'****************

	dim ingob:ingob = 0
	sub startgoblet
		DOF 412, DOFOn 'GOF - Stars
		GiOff
		pNote "Mode Start","Goblet of Fire"
		pupDMDDisplay "-","Goblet^of Fire",dmdnote,3,0,10
		'PuPlayer.playlistplayex pBackglass,"videoscenes","gobletoffire.mp4",vsvol,1
		playmedia "gobletoffire.mp4","videoscenes",pBackglass,"cineon",15000,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		PuPlayer.SetLoop 2,1
		'PuPlayer.playpause 4
		playclear pMusic
		vpmtimer.addtimer 15000, "actuallystartgob '"	
		vpmtimer.addtimer 10000, "lightgob '"	
		'vpmtimer.addtimer 14000, "gobaudio '"	
		ingob = 1
	End Sub

	sub gobaudio
		'PuPlayer.playpause 4
		playclear pmusic
		'PuPlayer.playlistplayex pAudio,"audiomodes","rita.mp3",100,1
		playmedia "rita.mp3","audiomodes",pAudio,"",0,"",1,1
	end sub
	
	sub lightgob
			s31.state = 0
			s32.state = 0
			s33.state = 0
			s34.state = 0
		if bMultiBallMode = false Then
			s31.state = 2
			s32.state = 2
			s33.state = 2
			s34.state = 2
			SetLightColor s31, purple, -1
			SetLightColor s32, purple, -1
			SetLightColor s33, purple, -1
			SetLightColor s34, purple, -1
		Else
			s32.state = 2
			SetLightColor s32, purple, -1	
		end If
	end Sub

	dim gobjp:gobjp =0
	sub gobjpget
		DOF 422, DOFPulse 'MX Jackpot Effects
		flasherspop purple,"crazy"
		'PuPlayer.playlistplayex pCallouts,"audiocheers","",vovol,1
		playmedia "","audiocheers",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)		
		'chilloutthemusic
		gobjp = gobjp + 600000
		pNote "Mode Jackpot",gobjp
		pupDMDDisplay "-","Mode Jackpot^"&gobjp&"",dmdnote,3,0,10
		addscore gobjp
		giflash
			'***** LIGHT RUNS *****
			'(CHAOS)randoms
			'(DIRECTIONS)uup|udown|uleft|uright|diagdl|diagdr|diagul|diagur
			'(SWIPES)middleih|middleiv|middleoh|middleov|stripe1h|hatch1h|hatch1v|hatch2h|hatch2v|stripe1v|stripe2h|stripe2v
			'(SPINS)circlein|circleout|clockleft|clockright|screwl|screwr
			'(CURVES)arcbld|arcblu|arcbrd|arcbru|arctld|arctlu|arctrd|arctru|fanld|fanlu|fanrd|fanru|radarl|radarr|wiperl|wiperr
			'(EXAMPLE)lightrun red,arcbld,1  (SYNTAX)lightrun color,direction,times to run
			lightrun purple,stripe1v, 1
	end Sub


	sub actuallystartgob
		dropwall
		if s31.state = 0 Then
			lightgob
		end If
		gobaudio
		lkcheckmer	
	end sub

	'****************
	'	Mode 3 - Unforgiveable Curses - t14
	'	Clear the table of shots
	'****************

	dim incurses:incurses = 0
	sub startcurses
		DOF 413, DOFOn 'Curses - Stars
		pNote "Mode Start","Unforgiveable Curses"
		pupDMDDisplay "-","Unforgivable^Curses",dmdnote,3,0,10
		GiOff
		'PuPlayer.playlistplayex pBackglass,"videoscenes","unforgiveable curses.mp4",vsvol,1
		playmedia "unforgiveable curses.mp4","videoscenes",pBackglass,"cineon",11000,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		PuPlayer.SetLoop 2,1
		'PuPlayer.playpause 4
		playclear pMusic
		vpmtimer.addtimer 11000, "actuallystartcurses '"	
		vpmtimer.addtimer 8000, "lightcurses '"	
		'vpmtimer.addtimer 10000, "cursesaudio '"	
		incurses = 1
	End Sub

	sub cursesaudio
		'PuPlayer.playpause 4
		playclear pMusic
		'PuPlayer.playlistplayex pAudio,"audiomodes","Frank Dies.mp3",100,1
		playmedia "Frank Dies.mp3","audiomodes",pAudio,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
	end sub
	
	sub lightcurses
			s11.state = 0
			s12.state = 0
			s13.state = 0
			s14.state = 0
		if bMultiBallMode = false Then
			s11.state = 2
			s12.state = 2
			s13.state = 2
			s14.state = 2
			SetLightColor s11, purple, -1
			SetLightColor s12, purple, -1
			SetLightColor s13, purple, -1
			SetLightColor s14, purple, -1
			s61.state = 2
			s62.state = 2
			s63.state = 2
			SetLightColor s61, purple, -1
			SetLightColor s62, purple, -1
			SetLightColor s63, purple, -1
			s91.state = 2
			s92.state = 2
			s93.state = 2
			SetLightColor s91, purple, -1
			SetLightColor s92, purple, -1
			SetLightColor s93, purple, -1
		Else
			s12.state = 2
			SetLightColor s12, purple, -1
			s62.state = 2
			SetLightColor s62, purple, -1
			s92.state = 2
			SetLightColor s92, purple, -1	
		end If
	end Sub

	sub cursesjp
		DOF 424, DOFPulse 'MX Jackpot Effects
		flasherspop purple,"crazy"
		'PuPlayer.playlistplayex pCallouts,"audiocheers","",vovol,1
		playmedia "","audiocheers",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		'chilloutthemusic
		pNote "Mode Jackpot","800,000"
		pupDMDDisplay "-","Mode Jackpot^800,000",dmdnote,3,0,10
		addscore 800000
			'***** LIGHT RUNS *****
			'(CHAOS)randoms
			'(DIRECTIONS)uup|udown|uleft|uright|diagdl|diagdr|diagul|diagur
			'(SWIPES)middleih|middleiv|middleoh|middleov|stripe1h|hatch1h|hatch1v|hatch2h|hatch2v|stripe1v|stripe2h|stripe2v
			'(SPINS)circlein|circleout|clockleft|clockright|screwl|screwr
			'(CURVES)arcbld|arcblu|arcbrd|arcbru|arctld|arctlu|arctrd|arctru|fanld|fanlu|fanrd|fanru|radarl|radarr|wiperl|wiperr
			'(EXAMPLE)lightrun red,arcbld,1  (SYNTAX)lightrun color,direction,times to run
			lightrun purple,stripe1v, 1
		giflash
	end Sub


	sub actuallystartcurses
		dropwall
		cursesaudio
		if s11.state = 0 Then
			lightcurses
		end if
		lkcheckmer	
	end sub

	'****************
	'	Mode 4 - Deatheaters - t15
	'	Hit as many deatheater popups as you can
	'****************

	dim indeath:indeath = 0
	sub startdeath
		DOF 414, DOFOn 'Escape DE - Stars
		GiOff
		pNote "Mode Start","Escape Deatheaters"
		pupDMDDisplay "-","Escape the^Deatheaters",dmdnote,3,0,10
		'PuPlayer.playlistplayex pBackglass,"videoscenes","deatheaters.mp4",vsvol,1
		playmedia "deatheaters.mp4","videoscenes",pBackglass,"cineon",5000,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		PuPlayer.SetLoop 2,1
		'PuPlayer.playpause 4
		playclear pMusic
		vpmtimer.addtimer 5000, "actuallystartdeath '"	
		vpmtimer.addtimer 3000, "lightdeath '"	
		'vpmtimer.addtimer 4900, "deathaudio '"
		popleft
		popright	
		indeath = 1
	End Sub

	sub deathaudio
		'PuPlayer.playpause 4
		playclear pMusic
		'PuPlayer.playlistplayex pAudio,"audiomodes","night.mp3",80,1
		playmedia "night.mp3","audiomodes",pAudio,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
	end sub

	sub deathcheck
		if popl.collidable = False and popr.collidable = false Then
			popleft
			popright
		end If
	end Sub

	sub deaddaball
		if deshit(CurrentPlayer) = 4 then
			'(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority
			playmedia "deatheateraddaball.mp4","videoscenes",pOvervid,"",3000,"",1,1
			select case delvl(CurrentPlayer)
				case 0
					BallsOnPlayfield = BallsOnPlayfield + 1
					BallRelease.CreateSizedball BallSize / 2
					PlaySoundAt SoundFXDOF("mbpc-ballrelease", 114, DOFPulse, DOFContactors), BallRelease
					BallRelease.Kick 90, 41
					bBallSaverActive = False
					EnableBallSaver 5:bBallSaverActive = True
					deshit(CurrentPlayer) = 0
					modesecs = modesecs - 20
				case 1
					BallsOnPlayfield = BallsOnPlayfield + 1
					BallRelease.CreateSizedball BallSize / 2
					PlaySoundAt SoundFXDOF("mbpc-ballrelease", 114, DOFPulse, DOFContactors), BallRelease
					BallRelease.Kick 90, 41
					bBallSaverActive = False
					EnableBallSaver 5:bBallSaverActive = True
					deshit(CurrentPlayer) = 0
					modesecs = modesecs - 10
				case 2
					BallsOnPlayfield = BallsOnPlayfield + 1
					BallRelease.CreateSizedball BallSize / 2
					PlaySoundAt SoundFXDOF("mbpc-ballrelease", 114, DOFPulse, DOFContactors), BallRelease
					BallRelease.Kick 90, 41
					deshit(CurrentPlayer) = 0
					modesecs = modesecs - 5
				case 3
					BallsOnPlayfield = BallsOnPlayfield + 1
					BallRelease.CreateSizedball BallSize / 2
					PlaySoundAt SoundFXDOF("mbpc-ballrelease", 114, DOFPulse, DOFContactors), BallRelease
					BallRelease.Kick 90, 41
					deshit(CurrentPlayer) = 0
				case 4
					BallsOnPlayfield = BallsOnPlayfield + 1
					BallRelease.CreateSizedball BallSize / 2
					PlaySoundAt SoundFXDOF("mbpc-ballrelease", 114, DOFPulse, DOFContactors), BallRelease
					BallRelease.Kick 90, 41
					deshit(CurrentPlayer) = 0
				case 5
					BallsOnPlayfield = BallsOnPlayfield + 1
					BallRelease.CreateSizedball BallSize / 2
					PlaySoundAt SoundFXDOF("mbpc-ballrelease", 114, DOFPulse, DOFContactors), BallRelease
					BallRelease.Kick 90, 41
					deshit(CurrentPlayer) = 0
				case 6
					BallsOnPlayfield = BallsOnPlayfield + 1
					BallRelease.CreateSizedball BallSize / 2
					PlaySoundAt SoundFXDOF("mbpc-ballrelease", 114, DOFPulse, DOFContactors), BallRelease
					BallRelease.Kick 90, 41
					deshit(CurrentPlayer) = 0
				case 7
					BallsOnPlayfield = BallsOnPlayfield + 1
					BallRelease.CreateSizedball BallSize / 2
					PlaySoundAt SoundFXDOF("mbpc-ballrelease", 114, DOFPulse, DOFContactors), BallRelease
					BallRelease.Kick 90, 41
					deshit(CurrentPlayer) = 0
			end Select
			delvl(CurrentPlayer) = delvl(CurrentPlayer) + 1
		end If
	end Sub
	
	sub lightdeath
		if bMultiBallMode = true then exit Sub

		SetLightColor t38, purple, -1
		SetLightColor t39, purple, -1
	end Sub

	sub deathjp
		deaddaball
		if deshit(CurrentPlayer) = 10 then
			DOF 427, DOFPulse 'MX Jackpot Effects
			'(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority
			playmedia "super jackpot.wav","audiocallouts",pCallouts,"",1000,"",1,1:pupDMDDisplay "-","Super Jackpot^6,000,000",dmdnote,3,0,10
			pNote "Super Jackpot","6,000,000"
			addscore 6000000
		Else
			DOF 426, DOFPulse 'MX Jackpot Effects
			playmedia "","audiocheers",pCallouts,"",1500,"",1,1
			pNote "Mode Jackpot","600,000"
			pupDMDDisplay "-","Mode Jackpot^600,000",dmdnote,3,0,10
			addscore 600000
		end if
		flasherspop purple,"crazy"
		giflash
			'***** LIGHT RUNS *****
			'(CHAOS)randoms
			'(DIRECTIONS)uup|udown|uleft|uright|diagdl|diagdr|diagul|diagur
			'(SWIPES)middleih|middleiv|middleoh|middleov|stripe1h|hatch1h|hatch1v|hatch2h|hatch2v|stripe1v|stripe2h|stripe2v
			'(SPINS)circlein|circleout|clockleft|clockright|screwl|screwr
			'(CURVES)arcbld|arcblu|arcbrd|arcbru|arctld|arctlu|arctrd|arctru|fanld|fanlu|fanrd|fanru|radarl|radarr|wiperl|wiperr
			'(EXAMPLE)lightrun red,arcbld,1  (SYNTAX)lightrun color,direction,times to run
			lightrun purple,stripe1v, 1
	end Sub


	sub actuallystartdeath
		dropwall
		if t38.state = 0 Then
			lightdeath
		end if
		popleft
		popright
		deathaudio
		lkcheckmer	
	end sub








'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  BUMPERS
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 


	Sub Bumper1_Hit
		bump
		FlashForMs bumpl4b, 1000, 50, 1:FlashForMs bumpl4a, 1000, 50, 1
		LightEffect 5
		If NOT Tilted Then
			PlaySoundAt SoundFXDOF("bumpleft", 107, DOFPulse, DOFContactors), bumper1
			DOF 302, DOFPulse   'DOF MX - Bumper 1
			AddScore 610
		End If
	End Sub

	Sub Bumper2_Hit
		bump
		FlashForMs bumpl1b, 1000, 50, 1:FlashForMs bumpl1a, 1000, 50, 1
		LightEffect 5
		If NOT Tilted Then
			PlaySoundAt SoundFXDOF("bumpright", 108, DOFPulse, DOFContactors), bumper2
			DOF 303, DOFPulse   'DOF MX - Bumper 2
			AddScore 610
		End If
	End Sub

	Sub Bumper3_Hit
		bump
		FlashForMs bumpl3b, 1000, 50, 1:FlashForMs bumpl3a, 1000, 50, 1
		LightEffect 5
		If NOT Tilted Then
			PlaySoundAt SoundFXDOF("bumpright", 109, DOFPulse, DOFContactors), bumper3
			DOF 304, DOFPulse   'DOF MX - Bumper 3
			AddScore 620
		End If
	End Sub

	Sub Bumper4_Hit
		bump
		FlashForMs bumpl2b, 1000, 50, 1:FlashForMs bumpl2a, 1000, 50, 1
		LightEffect 5
		If NOT Tilted Then
			PlaySoundAt SoundFXDOF("bumpleft", 110, DOFPulse, DOFContactors), bumper4
			DOF 305, DOFPulse   'DOF MX - Bumper 4
			AddScore 620
		End If
	End Sub

	Sub Bumper5_Hit
		bump
		LightEffect 5
		If NOT Tilted Then
			PlaySoundAt SoundFXDOF("bumpleft", 110, DOFPulse, DOFContactors), bumper4
			DOF 305, DOFPulse   'DOF MX - Bumper 5
			AddScore 620
		End If
	End Sub

	Sub bump
		inbumps = 1
		pbumps(CurrentPlayer) = pbumps(currentplayer) + 1
		totalbumps(CurrentPlayer) = totalbumps(CurrentPlayer) + 1
		If totalbumps(CurrentPlayer) < 75 Then
			PuPlayer.LabelSet pBackglass,"deatheaternum",75 - totalbumps(CurrentPlayer),1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 17.1, 'xalign': 1, 'ypos': 88.8, 'yalign': 1}"
		Else
			PuPlayer.LabelSet pBackglass,"deatheaternum",0,1,"{'mt':2,'color':2697513, 'size': 4, 'xpos': 17.1, 'xalign': 1, 'ypos': 88.8, 'yalign': 1}"
			checkmerlinsecond
		end if
		FlashForMs l22, 1000, 50, 0:FlashForMs l20f2, 1000, 50, 0
		vpmtimer.addtimer 1000, "outofbumps '"
		checkspell
		'setspellname
	end Sub


	sub checkmerlinsecond
		if merlinsecond(CurrentPlayer) = 0 Then
			pt7(CurrentPlayer) = 1
			t7.state = 1
			merlinsecond(CurrentPlayer) = 1
		end if
	end sub

	dim spellvo

	
	sub checkspell
		dim bumpsneeded
		bumpsneeded = 0
		select case bumplvl(CurrentPlayer)
			case 0:bumpsneeded = 25
			case 1:bumpsneeded = 55
			case 2:bumpsneeded = 75
			case 3:bumpsneeded = 95
			case 4:bumpsneeded = 105
			case 5:bumpsneeded = 125
			case 6:bumpsneeded = 145
			case 7:bumpsneeded = 165
		end Select
		If pbumps(CurrentPlayer) > bumpsneeded Then
			s22.state = 2
			PuPlayer.LabelSet pBackglass,"spellnum",0,1,"{'mt':2,'color':15066597, 'size': 4, 'xpos': 93.6, 'xalign': 1, 'ypos': 5.4, 'yalign': 1}"
			'PuPlayer.playlistplayex pCallouts,"audiocallouts","get to the book of spells.wav",vovol,1:pupDMDDisplay "-","Video Mode^is Lit",dmdnote,3,0,10
			pupDMDDisplay "-","MiniGame^Ready",dmdnote,3,0,1
		Else
			PuPlayer.LabelSet pBackglass,"spellnum",bumpsneeded - pbumps(CurrentPlayer),1,"{'mt':2,'color':15066597, 'size': 4, 'xpos': 93.6, 'xalign': 1, 'ypos': 5.4, 'yalign': 1}"
		End If
		
	end Sub

	dim inbumps:inbumps = 0

	sub outofbumps
		inbumps = 0
	end Sub

'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  FLIPPER LANES
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 


	Sub LeftInlane_Hit
		startkick
		AddScore 500
		DOF 145, DOFPulse
		DOF 315, DOFPulse   'DOF MX - Left Inner Lane
		if t4.state = 0 Then
			t4.state = 1
			pt4(CurrentPlayer) = 1
		end If
		PlaySoundAt "fx_sensor", ActiveBall
		If bMultiBallMode = False Then
			'PlaySound "lane"
		End If
		If Tilted Then Exit Sub
		LaneBonus = LaneBonus + 1
		'll1.State = 1
		'll8.State = 1
		' Do some sound or light effect
		LastSwitchHit = "lane1"
		checklanes
	End Sub

	Sub LeftInlane1_Hit
		DOF 144, DOFPulse
		DOF 313, DOFPulse   'DOF MX - Left Outer Lane
		AddScore 500
		if t3.state = 0 Then
			t3.state = 1
			pt3(CurrentPlayer) = 1
		end If
		PlaySoundAt "fx_sensor", ActiveBall
		'popleft
		checklanes
	End Sub

	Sub LeftInlane2_Hit
		DOF 147, DOFPulse
		DOF 316, DOFPulse   'DOF MX - Right Inner Lane
		AddScore 500
		if t10.state = 0 Then
			t10.state = 1
			pt10(CurrentPlayer) = 1
		end If
		'popright
		PlaySoundAt "fx_sensor", ActiveBall
		checklanes
	End Sub

	Sub LeftInlane3_Hit
		DOF 148, DOFPulse
		DOF 314, DOFPulse   'DOF MX - Right Outer Lane
		AddScore 500
		if t11.state = 0 Then
			t11.state = 1
			pt11(CurrentPlayer) = 1
		end If
		PlaySoundAt "fx_sensor", ActiveBall
		checklanes
	End Sub

	Sub LeftInlane4_Hit
		DOF 145, DOFPulse
		DOF 315, DOFPulse   'DOF MX - Left Inner Lane
		AddScore 500
		if t5.state = 0 Then
			t5.state = 1
			pt5(CurrentPlayer) = 1
		end If
		PlaySoundAt "fx_sensor", ActiveBall
		'popleft
		checklanes
	End Sub

	Sub RightInlane_Hit
		DOF 147, DOFPulse
		DOF 316, DOFPulse   'DOF MX - Right Inner
		AddScore 500
		if t9.state = 0 Then
			t9.state = 1
			pt9(CurrentPlayer) = 1
		end If
		'popright
		PlaySoundAt "fx_sensor", ActiveBall
		checklanes
	End Sub

	Sub checklanes
		If t3.state + t4.state + t5.state + t9.state + t10.state + t11.state = 6 Then
			If t2.state = 0 Then
				lanesaveopen
				'PuPlayer.playlistplayex pCallouts,"audiocallouts","kickbackactivated.mp3",vovol,1
				playmedia "kickbackactivated.mp3","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
				pupDMDDisplay "-","Kickback^Activated",dmdnote,3,0,10
				t3.state = 0
				t4.state = 0
				t5.state = 0
				t9.state = 0
				t10.state = 0
				t11.state = 0
			end If
		End If
	End Sub

	sub movelanesleft
		Dim TempState
		'flipper lanes
		TempState = t3.State
		t3.State = t4.State
		t4.State = t5.State
		t5.State = t9.State
		t9.State = t10.State
		t10.State = t11.State
		t11.State = TempState
	end Sub

	sub movelanesright
		Dim TempState
		'flipper lanes
		TempState = t11.State
		t11.State = t10.State
		t10.State = t9.State
		t9.State = t5.State
		t5.State = t4.State
		t4.State = t3.State
		t3.State = TempState
	end sub


'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  Dragon Multiball
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 

	Sub Target17_hit
		AddScore 15000
		if pt7(CurrentPlayer) = 1 Then
			AddScore 15000
		end if
		dragonsound
		giflash
		if indragon = 0 Then
			FlashForMs s41, 1000, 50, 0
		end if
		t33.state = 1
		pt33(CurrentPlayer) = 1
		checkdragon
		If indragon = 1 Then
			if s41.state = 2 Then
				dragonjackpot
			end If
		end if
	End Sub

	Sub Target8_hit
		AddScore 15000
		if pt7(CurrentPlayer) = 1 Then
			AddScore 15000
		end if
		dragonsound
		giflash
		if indragon = 0 Then
			FlashForMs s41, 1000, 50, 0
		end if
		If t34.state = 1 Then
			target17_hit
		Else
			t34.state = 1
			pt34(CurrentPlayer) = 1
			checkdragon
		End If
		If indragon = 1 Then
			if s41.state = 2 Then
				dragonjackpot
			end If
		end if
	End Sub

	Sub Target6_hit
		AddScore 15000
		if pt7(CurrentPlayer) = 1 Then
			AddScore 15000
		end if
		dragonsound
		giflash
		if indragon = 0 Then
			FlashForMs s41, 1000, 50, 0
		end if
		t35.state = 1
		pt35(CurrentPlayer) = 1
		checkdragon
		If indragon = 1 Then
			if s41.state = 2 Then
				dragonjackpot
			end If
		end if
	End Sub


	Sub Target18_hit
		AddScore 15000
		if pt7(CurrentPlayer) = 1 Then
			AddScore 15000
		end if
		dragonsound
		giflash
		if indragon = 0 Then
			FlashForMs s41, 1000, 50, 0
		end if
		If t36.state = 1 Then
			target6_hit
		Else
			t36.state = 1
			pt36(CurrentPlayer) = 1
			checkdragon
		end If
		If indragon = 1 Then
			if s41.state = 2 Then
				dragonjackpot
			end If
		end if
	End Sub


	Sub Target19_hit
		AddScore 15000
		if pt7(CurrentPlayer) = 1 Then
			AddScore 15000
		end if
		dragonsound
		giflash
		if indragon = 0 Then
			FlashForMs s41, 1000, 50, 0
		end if
		t37.state = 1
		pt37(CurrentPlayer) = 1
		checkdragon
		If indragon = 1 Then
			if s41.state = 2 Then
				dragonjackpot
			end If
		end if
	End Sub

	Sub giflash
		dim a
		For each a in GI
			FlashForMs a, 1000, 150, 1
		Next
	End Sub


	dim dscream:dscream=0
	dim screampos:screampos=0
	sub dragonsound
			'***** LIGHT RUNS *****
			'(CHAOS)randoms
			'(DIRECTIONS)uup|udown|uleft|uright|diagdl|diagdr|diagul|diagur
			'(SWIPES)middleih|middleiv|middleoh|middleov|stripe1h|hatch1h|hatch1v|hatch2h|hatch2v|stripe1v|stripe2h|stripe2v
			'(SPINS)circlein|circleout|clockleft|clockright|screwl|screwr
			'(CURVES)arcbld|arcblu|arcbrd|arcbru|arctld|arctlu|arctrd|arctru|fanld|fanlu|fanrd|fanru|radarl|radarr|wiperl|wiperr
			'(EXAMPLE)lightrun red,arcbld,1  (SYNTAX)lightrun color,direction,times to run
			lightrun red,udown, 1
			flasherspop red,"top"
		dragonaction
		if inmazemulti = 1 then exit Sub
		if inmermulti = 1 then exit Sub
		if inwandmulti = 1 then exit Sub
		if dscream = 1 then exit Sub
		if inamode = 1 then exit Sub
		dscream = 1
		'PuPlayer.playlistplayex pAudio,"audiodragons","",80,1
		playmedia "","audiodragons",pAudio2,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		'PuPlayer.playlistplayex pBackglass,"videodragonhit","",vsvol,1
		playmedia "","videodragonhit",pBackglass,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		vpmtimer.addtimer 1000, "screamdone '"
		DOF 128, DOFPulse 'Shaker - Dragon
	end Sub

	sub screamdone
		dscream = 0
	end Sub

	Sub cleardragonlights
		t33.state = 0
		pt33(CurrentPlayer) = 0
		t34.state = 0
		pt34(CurrentPlayer) = 0
		t35.state = 0
		pt35(CurrentPlayer) = 0
		t36.state = 0
		pt36(CurrentPlayer) = 0
		t37.state = 0
		pt37(CurrentPlayer) = 0
		s23.state = 0
		leftdug.state = 0
	End Sub



	Sub checkdragon
		dim dragonnum : dragonnum = 0
		dragonnum = t33.state + t34.state + t35.state + t36.state + t37.state
		PuPlayer.LabelSet pBackglass,"egghits",dragonnum & "/" & 5,1,"{'mt':2,'color':2697513, 'size': 3, 'xpos': 35.8, 'xalign': 1, 'ypos': 6.2, 'yalign': 1}"
		If indragon = 1 Then exit sub
			If t33.state + t34.state + t35.state + t36.state + t37.state = 5 Then
				s23.state = 2
				leftdug.state = 2
				vpmtimer.addtimer 2000, "dlready '"
			end If
	end sub

	dim dlcall:dlcall = 0

	sub dlready
		if dlcall = 1 then exit sub
				If dragonlock(CurrentPlayer) = 0 then
					'PuPlayer.playlistplayex pCallouts,"audiocallouts","dragon lock ready 2.wav",vovol,1
					playmedia "dragon lock ready 2.wav","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
					pupDMDDisplay "-","Dragon Lock^is Lit",dmdnote,3,0,10
					'chilloutthemusic
					dlcall = 1
				Else
					t18.state = 2
					'PuPlayer.playlistplayex pCallouts,"audiocallouts","dragon multiball ready.wav",vovol,1
					playmedia "dragon multiball ready.wav","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
					pupDMDDisplay "-","Dragon Multiball^is Lit",dmdnote,3,0,10
					'chilloutthemusic
					dlcall = 1
				End If
	end Sub


	Sub Kicker1_hit
		AddScore 8000
		kicker1.destroyball
		PlaySoundAt SoundFXDOF("mbpc-hole_enter",116,DOFPulse,DOFContactors), kicker1
		If bMultiBallMode = true Then
			vpmtimer.addtimer 10, "kickball '"
		Else
			checkk1eb
		End If
	End Sub

	Sub checkk1eb
			checkk1spell
	End Sub

	dim inminigame:inminigame = 0
	Sub checkk1spell
		if bMultiBallMode = true or inamode = 1 Then
		checkk1lock
		Else
			If s22.state = 2 Then
				s22.state = 0
				playmedia "defenseagainst.mp4","videoscenes",pBackglass,"",0,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
				vpmtimer.addtimer 8000, "PuPGameStartMiniGame '"
				bumplvl(CurrentPlayer) = bumplvl(CurrentPlayer) + 1
				inminigame = 1
				pbumps(CurrentPlayer) = 0
			Else
				checkk1lock
			End If
		end If
	End Sub

	Sub checkk1lock
		EnableBallSaver 1
		PuPlayer.LabelSet pBackglass,"mgscore","",1,""
		If s23.state = 2 Then
			cleardragonlights
			dragonlock(CurrentPlayer) = dragonlock(CurrentPlayer) + 1
			PuPlayer.LabelSet pBackglass,"egglocks",dragonlock(CurrentPlayer),1,"{'mt':2,'color':2697513, 'size': 3, 'xpos': 35.8, 'xalign': 1, 'ypos': 11.9, 'yalign': 1}"
			Select Case dragonlock(CurrentPlayer)
				Case 1
					'pNote "Ball 1","Locked"
					GiOff
					'PuPlayer.playlistplayex pBackglass,"videoscenes","dragonlock.mp4",vsvol,1
					playmedia "dragonlock.mp4","videoscenes",pBackglass,"cineon",5000,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
					vpmtimer.addtimer 5000, "kickball '"
					'PuPlayer.playpause 4
					'vpmtimer.addtimer 6000, "merresumemusic '"
					'vpmtimer.addtimer 2000, "delayedcall '"
					'vpmtimer.addtimer 5000, "kickball '"
					'vpmtimer.addtimer 4000, "gion '"
				Case 2
					dragonlock(CurrentPlayer) = 0
					'vpmtimer.addtimer 10, "kickball '"
					GiOff
					spotsoff
					gicolor(red)
					'PuPlayer.playlistplayex pBackglass,"videodragoncalls","dragon-multi.mp4",vsvol,1
					playmedia "dragon-multi.mp4","videodragoncalls",pBackglass,"cineon",9000,"",1,8  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
					vpmtimer.addtimer 9000, "startdragonmulti '"
					vpmtimer.addtimer 3000, "delayedcall2 '"
					vpmtimer.addtimer 5500, "delayedcall3 '"
					'vpmtimer.addtimer 9000, "startdragonmulti '"
					'if inamode = 1 Then
					'	modetimeleft.enabled = 0
					'	vpmtimer.addtimer 10000, "starttheclock '"
					'end if
					'vpmtimer.addtimer 9000, "kickball '"
					
			End Select
		Else
			vpmtimer.addtimer 10, "kickball '"
		End If
	End Sub

	sub delayedcall
		'PuPlayer.playlistplayex pCallouts,"audiocallouts","ball1locked.mp3",vovol,1
		playmedia "ball1locked.mp3","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		dlcall = 0
		'chilloutthemusic
	end sub

	sub delayedcall2
		'PuPlayer.playlistplayex pCallouts,"audiocallouts","thetriwizard.mp3",vovol,1
		playmedia "thetriwizard.mp3","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		'chilloutthemusic
	end sub

	sub delayedcall3
		'PuPlayer.playlistplayex pCallouts,"audiocallouts","goldeneggmultiball.mp3",vovol,1
		playmedia "goldeneggmultiball.mp3","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		'chilloutthemusic
	end sub

	sub kickball
		'GiOn
		If bMultiBallMode = false Then
			if inamode = 0 Then
				'popright
			end If
		End If
		flasherspop red,"leftkick"
		vpmtimer.addtimer 1000, "actualkick '"
	end Sub

	sub actualkick
		kicker1.CreateBall
		PlaySoundAt SoundFXDOF("mbpc-popper",116,DOFPulse,DOFContactors), kicker1
		DOF 115, DOFPulse 'Strobe
		kicker1.kick 82, 32, 0
		quickcount
	end Sub


	'****************
	'     MULTIBALL
	'****************

	Dim indragon:indragon = 0

	Sub startdragonmulti
		kickball
		lastmb = "startdragonmulti '"
		t18.state = 0
		leftdug.state = 0
		closemaze
		droppops
		stopmer.collidable = 1
		PuPlayer.LabelSet pBackglass,"egglocks",dragonlock(CurrentPlayer) & "/" & 5,1,"{'mt':2,'color':2697513, 'size': 3, 'xpos': 35.8, 'xalign': 1, 'ypos': 11.9, 'yalign': 1}"
		wandclose
		indragon = 1
		dragonjacks(CurrentPlayer) = 0
		DOF 333, DOFPulse   'DOF MX - Flash Bad Men
		'pNote "TriWizard","The Dragon's Egg"
		'PuPlayer.playlistplayex pBackglass,"videodragon","dragon-mb-back.mp4",vsvol,1
		playmedia "dragon-mb-back.mp4","videodragon",pBackglass,"",0,"",1,10  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		PuPlayer.SetLoop 2,1
		'PuPlayer.playpause 4
		playclear pMusic
		'PuPlayer.playlistplayex pAudio,"audiomultiballs","dragon.mp3",100,3
		playmedia "dragon.mp3","audiomultiballs",pAudio,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		bMultiBallMode = True
		doublekick
		'AddMultiball 2
		bBallSaverActive = False
		EnableBallSaver 10:bBallSaverActive = True
		GiOff
		spotsoff
		gicolor(red)
		gispindragon
		runninglights = 0
		lightdragjacks
		dragontimer.enabled = 1
		SetLightColor s51, red, -1
		SetLightColor s31, red, -1
		SetLightColor t2, red, -1
		s41.state = 2
		s31.state = 0
		s51.state = 0
	end sub
	
	sub doublekick
		vpmtimer.addtimer 800, "actualkick '"
		vpmtimer.addtimer 1200, "actualkick '"
		vpmtimer.addtimer 1400, "quickcount '"
	end Sub
	
	dim playingsj:playingsj = 0

	dim drgrdy:drgrdy=0
	Sub dragonjackpot
		if drgrdy=1 then exit sub
		dragonsound
		addscore 1000000
		dragjplights
		dragonjacks(CurrentPlayer) = dragonjacks(currentplayer) + 1
		if playingsj = 1 then exit Sub
		vpmtimer.addtimer 3000, "dragonrestart '"
		Select Case dragonjacks(CurrentPlayer)
			Case 1
				'PuPlayer.playlistplayex pBackglass,"videodragoncalls","jackpot.mp4",vsvol,1
				playmedia "jackpot.mp4","videodragoncalls",pOvervid,"",0,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			Case 2
				'PuPlayer.playlistplayex pBackglass,"videodragoncalls","jackpot.mp4",vsvol,1
				playmedia "jackpot.mp4","videodragoncalls",pOvervid,"",0,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			Case 3
				'PuPlayer.playlistplayex pBackglass,"videodragoncalls","jackpot.mp4",vsvol,1
				playmedia "jackpot.mp4","videodragoncalls",pOvervid,"",0,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			Case 4
				'PuPlayer.playlistplayex pBackglass,"videodragoncalls","jackpot.mp4",vsvol,1
				playmedia "jackpot.mp4","videodragoncalls",pOvervid,"",0,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			Case 5
				'PuPlayer.playlistplayex pBackglass,"videodragoncalls","jackpot.mp4",vsvol,1
				playmedia "jackpot.mp4","videodragoncalls",pOvervid,"",0,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			Case 6
				'PuPlayer.playlistplayex pBackglass,"videodragoncalls","jackpot.mp4",vsvol,1
				playmedia "jackpot.mp4","videodragoncalls",pOvervid,"",0,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			Case 7
				'PuPlayer.playlistplayex pBackglass,"videodragoncalls","jackpot.mp4",vsvol,1
				playmedia "jackpot.mp4","videodragoncalls",pOvervid,"",0,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			Case 8
				t18.state = 1
				pt18(CurrentPlayer) = 1
				addscore 6000000
				playingsj = 1
				'PuPlayer.playlistplayex pBackglass,"videodragoncalls","superjackpot.mp4",vsvol,1
				playmedia "superjackpot.mp4","videodragoncalls",pOvervid,"",0,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
				dragonjacks(CurrentPlayer) = 0
				vpmtimer.addtimer 6000, "dragonrestartsj '"
		End Select
		drgrdy=1
		vpmtimer.addtimer 300, "godgagain '"
	end Sub

	sub godgagain
		drgrdy=0
	end Sub

	Sub dragonrestart
		if playingsj = 1 then exit Sub
		If indragon = 1 Then
			playingsj = 0
			'PuPlayer.playlistplayex pBackglass,"videodragon","dragon-mb-back.mp4",vsvol,1
			playmedia "dragon-mb-back.mp4","videodragon",pBackglass,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			PuPlayer.SetLoop 2,1
		End If
	End Sub

	Sub dragonrestartsj
		If indragon = 1 Then
			playingsj = 0
			'PuPlayer.playlistplayex pBackglass,"videodragon","dragon-mb-back.mp4",vsvol,1
			playmedia "dragon-mb-back.mp4","videodragon",pBackglass,"",0,"",1,10  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			PuPlayer.SetLoop 2,1
		End If
	End Sub


	'MB lighting


	sub lightdragjacks
		TurnOffmultiLights
		if pt18(CurrentPlayer) = 1 Then
			t18.state = 1
		end if
		Select Case dragonjacks(CurrentPlayer)
			Case 0
				s41.state = 2
				s31.state = 2
				s51.state = 2
			Case 1
				s31.state = 2
				s51.state = 2
				s41.state = 0
			Case 2
				s41.state = 2
				s31.state = 0
				s51.state = 0
			Case 3
				s31.state = 2
				s51.state = 2
				s41.state = 0
			Case 4
				s41.state = 2
				s31.state = 0
				s51.state = 0
			Case 5
				s31.state = 2
				s51.state = 2
				s41.state = 0
			Case 6
				s41.state = 2
				s31.state = 0
				s51.state = 0
			Case 7
				s31.state = 2
				s51.state = 2
				s41.state = 0
			Case 8
				s41.state = 2
				s31.state = 0
				s51.state = 0
				t18.state = 1
		End Select
		modelightscheck
	end Sub

	sub dragontimer_timer
		gicolor(red)
		if runninglights = 1 then exit sub
		lightdragjacks
	end Sub

	sub dragjplights
		runninglights = 1
			'***** LIGHT RUNS *****
			'(CHAOS)randoms
			'(DIRECTIONS)uup|udown|uleft|uright|diagdl|diagdr|diagul|diagur
			'(SWIPES)middleih|middleiv|middleoh|middleov|stripe1h|hatch1h|hatch1v|hatch2h|hatch2v|stripe1v|stripe2h|stripe2v
			'(SPINS)circlein|circleout|clockleft|clockright|screwl|screwr
			'(CURVES)arcbld|arcblu|arcbrd|arcbru|arctld|arctlu|arctrd|arctru|fanld|fanlu|fanrd|fanru|radarl|radarr|wiperl|wiperr
			'(EXAMPLE)lightrun red,arcbld,1  (SYNTAX)lightrun color,direction,times to run
			lightrun red,hatch1v, 2
			flasherspop red,"crazy"
		vpmtimer.addtimer 1200, "nolongerrun '"
	End Sub

	Sub gispindragon
		dim a
			for each a in gi
				a.intensity = 300
			next
		gicolor(red)
		LightSeqGi.UpdateInterval = 1
		LightSeqGi.Play SeqMiddleOutVertOn, 90,2000,0
	end Sub


	Sub enddragon
		stopmer.collidable = 0
		dragontimer.enabled = 0
		'ruleshelperon
		playclear pBackglass
		PuPlayer.SetLoop 2,0
		'PuPlayer.playresume 4
		playbgaudio
		cleardragonlights
		checkvoldemort
		gispinstop
		indragon = 0
		TurnOffmultiLights
		GiOff
		GiOn
		spotson
		bMultiBallMode = False
		gicolor(base)
		endamultiball
		resetcolors
		relighttable
		playingsj = 0
		dlcall = 0
		if inamode = 1 Then
			modelightscheck
		end If
	End Sub



'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  Merman Multiball
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 




	Sub Spinner3_Spin
		playerspin
		PlaySoundAt "mbpc-spinner", Spinner1
	End Sub

	Sub Spinner4_Spin
		playerspin
		PlaySoundAt "mbpc-spinner", Spinner1
	End Sub

	Sub Spinner2_Spin
		playerspin
		PlaySoundAt "mbpc-spinner", Spinner2
	End Sub

	sub playerspin
		if pt8(CurrentPlayer) = 1 Then
			AddScore 426		
		Else
			AddScore 213
		end if

		if spinlvl(CurrentPlayer) = 0 Then
			spinnum(CurrentPlayer) = 75
		elseif spinlvl(CurrentPlayer) = 1 Then
			spinnum(CurrentPlayer) = 150
		elseif spinlvl(CurrentPlayer) = 2 Then
			spinnum(CurrentPlayer) = 225
		elseif spinlvl(CurrentPlayer) = 3 Then
			spinnum(CurrentPlayer) = 300
		elseif spinlvl(CurrentPlayer) = 4 Then
			spinnum(CurrentPlayer) = 375
		end if	

		if inmermulti = 1 Then
			merjackpotboost
			dim merjplvl:merjplvl = 150 - mermultispins(CurrentPlayer)
			if merjplvl < 0 Then
				PuPlayer.LabelSet pBackglass,"lakespins",0,1,"{'mt':2,'color':2697513, 'size': 3, 'xpos': 50, 'xalign': 1, 'ypos': 6.2, 'yalign': 1}"
			else
				PuPlayer.LabelSet pBackglass,"lakespins",150 - mermultispins(CurrentPlayer),1,"{'mt':2,'color':2697513, 'size': 3, 'xpos': 50, 'xalign': 1, 'ypos': 6.2, 'yalign': 1}"
			end if 
		Else
			playerspins(CurrentPlayer) = playerspins(CurrentPlayer) + 1
			dim curplynum
			curplynum = spinnum(CurrentPlayer) - playerspins(CurrentPlayer)		
			if curplynum < 0 Then
				PuPlayer.LabelSet pBackglass,"lakespins",0,1,"{'mt':2,'color':2697513, 'size': 3, 'xpos': 50, 'xalign': 1, 'ypos': 6.2, 'yalign': 1}"
				checkmeragain
			else
				PuPlayer.LabelSet pBackglass,"lakespins",spinnum(CurrentPlayer) - playerspins(CurrentPlayer),1,"{'mt':2,'color':2697513, 'size': 3, 'xpos': 50, 'xalign': 1, 'ypos': 6.2, 'yalign': 1}"
			end if 
			select case playerspins(CurrentPlayer)
				Case spinnum(CurrentPlayer)
					merlockready
				end select
		end if 
	end sub

	sub checkmeragain
		If bMultiBallMode = true then exit sub
		if s13.state = 2 Then
		Else
		pupDMDDisplay "-","Lake Rescue^Lock is Lit",dmdnote,3,0,10
		s13.state = 2
		merlock1.enabled = 1
		ps13(currentplayer) = 1
		end If	
	end Sub


	Sub merlockready
		If bMultiBallMode = true then exit sub
		'PuPlayer.playlistplayex pCallouts,"audiocallouts","lake rescue lock ready.wav",vovol,1
		playmedia "lake rescue lock ready.wav","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		pupDMDDisplay "-","Lake Rescue^Lock is Lit",dmdnote,3,0,10
		s13.state = 2
		merlock1.enabled = 1
		ps13(currentplayer) = 1
	end Sub

	Sub merlock1_hit
		If bMultiBallMode = true then exit sub
			'***** LIGHT RUNS *****
			'(CHAOS)randoms
			'(DIRECTIONS)uup|udown|uleft|uright|diagdl|diagdr|diagul|diagur
			'(SWIPES)middleih|middleiv|middleoh|middleov|stripe1h|hatch1h|hatch1v|hatch2h|hatch2v|stripe1v|stripe2h|stripe2v
			'(SPINS)circlein|circleout|clockleft|clockright|screwl|screwr
			'(CURVES)arcbld|arcblu|arcbrd|arcbru|arctld|arctlu|arctrd|arctru|fanld|fanlu|fanrd|fanru|radarl|radarr|wiperl|wiperr
			'(EXAMPLE)lightrun red,arcbld,1  (SYNTAX)lightrun color,direction,times to run
			lightrun blue,arctld, 1
			flasherspop blue,"top"
		playmedia "lakeball1locked.mp4","videoscenes",pBackglass,"cineon",6000,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		vpmtimer.addtimer 6000, "CreateNewBall() '"
		merlock1full = 1
		s73.state = 2
		merlock2.enabled = 1
		t19.state = 2
	end Sub

	sub merresumemusic
		'PuPlayer.playresume 4
		playbgaudio
	end Sub

	Sub merlock2_hit
		If bMultiBallMode = true then exit sub
			'***** LIGHT RUNS *****
			'(CHAOS)randoms
			'(DIRECTIONS)uup|udown|uleft|uright|diagdl|diagdr|diagul|diagur
			'(SWIPES)middleih|middleiv|middleoh|middleov|stripe1h|hatch1h|hatch1v|hatch2h|hatch2v|stripe1v|stripe2h|stripe2v
			'(SPINS)circlein|circleout|clockleft|clockright|screwl|screwr
			'(CURVES)arcbld|arcblu|arcbrd|arcbru|arctld|arctlu|arctrd|arctru|fanld|fanlu|fanrd|fanru|radarl|radarr|wiperl|wiperr
			'(EXAMPLE)lightrun red,arcbld,1  (SYNTAX)lightrun color,direction,times to run
			lightrun blue,arctld, 2
			flasherspop blue,"top"
		'PuPlayer.playlistplayex pCallouts,"audiocallouts","ball2locked.mp3",vovol,1
		'PuPlayer.playlistplayex pBackglass,"videoscenes","lakeball2locked.mp4",vsvol,1
		playmedia "lakeball2locked.mp4","videoscenes",pBackglass,"cineon",4000,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)"
		vpmtimer.addtimer 4000, "CreateNewBall() '"
		merlock2full = 1
		s73.state = 2
		merlock3.enabled = 1
	end Sub
	
	Sub merlock3_hit
		If bMultiBallMode = true then exit sub
			'***** LIGHT RUNS *****
			'(CHAOS)randoms
			'(DIRECTIONS)uup|udown|uleft|uright|diagdl|diagdr|diagul|diagur
			'(SWIPES)middleih|middleiv|middleoh|middleov|stripe1h|hatch1h|hatch1v|hatch2h|hatch2v|stripe1v|stripe2h|stripe2v
			'(SPINS)circlein|circleout|clockleft|clockright|screwl|screwr
			'(CURVES)arcbld|arcblu|arcbrd|arcbru|arctld|arctlu|arctrd|arctru|fanld|fanlu|fanrd|fanru|radarl|radarr|wiperl|wiperr
			'(EXAMPLE)lightrun red,arcbld,1  (SYNTAX)lightrun color,direction,times to run
			lightrun blue,arctld, 3
			flasherspop blue,"top"
		playmedia "lakeball3locked.mp4","videoscenes",pBackglass,"cineon",6000,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		vpmtimer.addtimer 6000, "CreateNewBall() '"
		merlock3full = 1
		s73.state = 2
		s13.state = 0
		ps13(CurrentPlayer) = 0
	end Sub


	Sub ChestHole_hit
		If bMultiBallMode = true Then
			ChestHole.DestroyBall
			ChestOut.CreateBall
			PlaySoundAt SoundFXDOF("mbpc-vuk",117,DOFPulse,DOFContactors), chestout
			DOF 115, DOFPulse 'Strobe
			ChestOut.kick 300, 30, 1.56
			quickcount
		Else
			restofchest
			PlaySoundAt SoundFXDOF("mbpc-kicker_enter",117,DOFPulse,DOFContactors), chesthole
		end If
	End Sub

	sub restofchest
		If bMultiBallMode = true Then
			vpmtimer.addtimer 10, "ChestExit '"
		Else
			lkcheckeb
		End If	
	end sub

	Sub lkcheckeb
		If s71.state = 2 Then
			ps71(currentplayer) = 0
			s71.state = 0
			AwardExtraBall
			'PuPlayer.playlistplayex pBackglass,"videoscenes","extraball.mp4",vsvol,1
			playmedia "extraball.mp4","videoscenes",pBackglass,"cineon",6000,"",1,4  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			vpmtimer.addtimer 6000, "lkcheckmode '"
			vpmtimer.addtimer 5800, "clearebvid '"
			
		Else
			lkcheckmode
		End If
	end Sub

	sub clearebvid
		'playclear pBackglass
	end Sub

	sub lkcheckmode
		If s72.state = 2 Then
			If inamode = 0 Then
				startamode
			Else
				lkcheckmer
			end If
		Else
			lkcheckmer
		end If
	End sub

	Sub lkcheckmer
		If s73.state = 2 Then
			DOF 410, DOFOn 'MX Underwater On
			GiOff
			TurnOffmultiLights
			'PuPlayer.playpause 4
			'PuPlayer.playlistplayex pBackglass,"videodragoncalls","merintro.mp4",100,1
			playmedia "merintro.mp4","videodragoncalls",pBackglass,"cineon",13000,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			vpmtimer.addtimer 13000, "startmermulti '"
			'if inamode = 1 Then
				'modetimeleft.enabled = 0
				'vpmtimer.addtimer 13000, "starttheclock '"
			'end if
			s73.state = 0
		Else
			vpmtimer.addtimer 10, "ChestExit '"
		end If
	end Sub

	Sub ChestExit()
		If bMultiBallMode = false Then
			if inamode = 0 Then
				'popleft
			end If
		End If
		flasherspop purple, "rightkick"
		vpmtimer.addtimer 900, "chestpop '"
		'If B2SOn Then Controller.B2SSetData bsnr,1:Controller.B2SSetData 20,0:Controller.B2SSetData 80,1
		'FlashForMs f16, 1000, 50, 0
	End Sub

	sub chestpop
		ChestHole.DestroyBall
		ChestOut.CreateBall
		PlaySoundAt SoundFXDOF("mbpc-vuk",117,DOFPulse,DOFContactors), chestout
		DOF 115, DOFPulse 'Strobe
		ChestOut.kick 300, 30, 1.56
		quickcount

		If inamode = 1 Then
			starttheclock
		end if

		if awapepper = 1 Then
			doneawarding
			dropwall
			awapepper = 0
		end if

	End Sub



	'****************
	'     MULTIBALL
	'****************

	Sub gispin
		dim a
			for each a in gi
				a.intensity = 300
			next
		gicolor(blue)
		LightSeqGi.UpdateInterval = 1
		LightSeqGi.Play SeqScrewRightOn, 90,2000,0
	end Sub

	Sub gispinstop
		dim a
			for each a in gi
				a.intensity = 80
			next
		gicolor(base)
		LightSeqGi.StopPlay
	end Sub



	dim inmermulti:inmermulti = 0

	Sub emptymerlocks
		merlock1.enabled = 0
		merlock2.enabled = 0
		merlock3.enabled = 0
		merlock1.kick 160, 30, 0
		merlock1full = 0
		merlock2.kick 160, 30, 0
		merlock2full = 0
		merlock3.kick 160, 30, 0
		merlock3full = 0
	end Sub

	sub startmermulti
		lastmb = "startmermulti '"
		t19.state = 0
		closemaze
		droppops
		wandclose
		debug.print "start multi " & BallsOnPlayfield
		inmermulti = 1
		bMultiBallMode = True
		'PuPlayer.playlistplayex pBackglass,"videodragon","mer-mb.mp4",vsvol,1
		playmedia "mer-mb.mp4","videodragon",pBackglass,"",0,"",1,10  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		PuPlayer.SetLoop 2,1
		'PuPlayer.playpause 4
		playclear pMusic
		'PuPlayer.playlistplayex pAudio,"audiomultiballs","lake.mp3",100,3
		playmedia "lake.mp3","audiomultiballs",pAudio,"",0,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)

		If merlock1full = 1 Then
			merlock1full = 0
			merlock1.kick 160, 30, 0
			merlock3.enabled = False
			merlock1.enabled = False
			merlock2.enabled = False
		end If
		If merlock2full = 1 Then
			merlock2full = 0
			merlock2.kick 160, 30, 0
			merlock3.enabled = False
			merlock1.enabled = False
			merlock2.enabled = False
		end If
		If merlock3full = 1 Then
			merlock3full = 0
			merlock3.kick 160, 30, 0
			merlock3.enabled = False
			merlock1.enabled = False
			merlock2.enabled = False
		end If
		debug.print "start multi after math " & BallsOnPlayfield
		vpmtimer.addtimer 10, "ChestExit '"
		GiOn
		gicolor(blue)
		spotsoff
		runninglights = 0
		merlock1full = 0
		merlock2full = 0
		merlock3full = 0
		vpmtimer.addtimer 1000, "lightmerjacks '"
		vpmtimer.addtimer 500, "quickcount '"
		gispin
		mertimer.enabled = 1
		SetLightColor s11, green, -1
		SetLightColor s61, blue, -1
		SetLightColor s91, blue, -1
		SetLightColor s81, blue, -1
		bBallSaverActive = False
		EnableBallSaver 15:bBallSaverActive = True
	end Sub

	sub lightmerjacks
		TurnOffmultiLights
		dim a
		for each a in merjplightcol
			a.state = 2
		next
		SetLightColor s11, green, -1
		SetLightColor s61, blue, -1
		SetLightColor s91, blue, -1
		SetLightColor s81, blue, -1
		modelightscheck
	end Sub

	sub mertimer_timer
		if runninglights = 1 then exit sub
		lightmerjacks
		gicolor(blue)
	end Sub

	sub merjplights
			'***** LIGHT RUNS *****
			'(CHAOS)randoms
			'(DIRECTIONS)uup|udown|uleft|uright|diagdl|diagdr|diagul|diagur
			'(SWIPES)middleih|middleiv|middleoh|middleov|stripe1h|hatch1h|hatch1v|hatch2h|hatch2v|stripe1v|stripe2h|stripe2v
			'(SPINS)circlein|circleout|clockleft|clockright|screwl|screwr
			'(CURVES)arcbld|arcblu|arcbrd|arcbru|arctld|arctlu|arctrd|arctru|fanld|fanlu|fanrd|fanru|radarl|radarr|wiperl|wiperr
			'(EXAMPLE)lightrun red,arcbld,1  (SYNTAX)lightrun color,direction,times to run
			lightrun green,screwl, 2
			flasherspop green,"left"
		runninglights = 1
		vpmtimer.addtimer 700, "nolongerrun '"
	End Sub

	sub merboostlights
			'***** LIGHT RUNS *****
			'(CHAOS)randoms
			'(DIRECTIONS)uup|udown|uleft|uright|diagdl|diagdr|diagul|diagur
			'(SWIPES)middleih|middleiv|middleoh|middleov|stripe1h|hatch1h|hatch1v|hatch2h|hatch2v|stripe1v|stripe2h|stripe2v
			'(SPINS)circlein|circleout|clockleft|clockright|screwl|screwr
			'(CURVES)arcbld|arcblu|arcbrd|arcbru|arctld|arctlu|arctrd|arctru|fanld|fanlu|fanrd|fanru|radarl|radarr|wiperl|wiperr
			'(EXAMPLE)lightrun red,arcbld,1  (SYNTAX)lightrun color,direction,times to run
			lightrun blue,circleout, 1
			flasherspop blue,"top"
		runninglights = 1
		vpmtimer.addtimer 700, "nolongerrun '"
	End sub


	dim mermultivalue:mermultivalue = 1000000
	dim mersjready:mersjready = 0

	sub merjackpotboost
		dim scoreval
		merboostlights
		mermultivalue = mermultivalue + 10000
		'pNote "jackpot value",mermultivalue * BallsOnPlayfield
		scoreval = mermultivalue * BallsOnPlayfield
		PuPlayer.LabelSet pBackglass,"lakejack",scoreval / 1000000 & "m",1,"{'mt':2,'color':2697513, 'size': 3, 'xpos': 50, 'xalign': 1, 'ypos': 11.9, 'yalign': 1}"
		mermultispins(CurrentPlayer) = mermultispins(CurrentPlayer) + 1
		
		If mermultispins(CurrentPlayer) > 150 Then
			mermultispins(CurrentPlayer) = 150
		end if

		select case mermultispins(CurrentPlayer)
			case 150 'super Jackpot

			s11.state = 2
			s12.state = 2
			SetLightColor s11, amber, -1
			SetLightColor s12, amber, -1
			mersjready = 1
		end select
	end sub

	Sub lohit_hit
		checkcombos
		if inmermulti = 1 Then
			merjacks
		end If
		if inwandmulti = 1 Then
			wandjackpot
		end If
		if incurses = 1 Then
			cursesjp
		end if 
		if inmazemulti = 1 Then
			If s11.state = 2 Then
				mazejphit
			end If
		end If
		if bMultiBallMode = 0 and inamode = 0 Then
			'PuPlayer.playlistplayex pBackglass,"videomer","",vsvol,3
			playmedia "","videomer",pBackglass,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
				'***** LIGHT RUNS *****
			'(CHAOS)randoms
			'(DIRECTIONS)uup|udown|uleft|uright|diagdl|diagdr|diagul|diagur
			'(SWIPES)middleih|middleiv|middleoh|middleov|stripe1h|hatch1h|hatch1v|hatch2h|hatch2v|stripe1v|stripe2h|stripe2v
			'(SPINS)circlein|circleout|clockleft|clockright|screwl|screwr
			'(CURVES)arcbld|arcblu|arcbrd|arcbru|arctld|arctlu|arctrd|arctru|fanld|fanlu|fanrd|fanru|radarl|radarr|wiperl|wiperr
			'(EXAMPLE)lightrun red,arcbld,1  (SYNTAX)lightrun color,direction,times to run
			lightrun blue,uleft, 1
		end If
	End Sub

	sub merjacks
		dim merjacktotal
		merjacktotal = mermultivalue * BallsOnPlayfield

		if mersjready = 1 Then
			'PuPlayer.playlistplayex pCallouts,"audiocallouts","super jackpot.wav",vovol,1
			playmedia "super jackpot.wav","audiocallouts",pCallouts,"",0,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			pupDMDDisplay "-","Super^Jackpot",dmdnote,3,0,10
			addscore merjacktotal * 2
			pNote "Super Jackpot!",merjacktotal * 2
			mermultivalue = 1000000
			t19.state = 1
			pt19(CurrentPlayer) = 1
			mersjready = 0
			merjplights
			mermultispins(CurrentPlayer) = 100
		Else
			addscore merjacktotal
			pNote "jackpot!",merjacktotal
			'PuPlayer.playlistplayex pCallouts,"audiocallouts","jackpot.wav",vovol,1
			playmedia "jackpot.wav","audiocallouts",pCallouts,"",0,"",1,4  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			pupDMDDisplay "-","Mermaid^Jackpot",dmdnote,3,0,10
			mermultivalue = 1000000
			merjplights
		end If
	end Sub

	Sub endmermulti
		DOF 410, DOFOff 'MX Underwater Off
		playerspins(CurrentPlayer) = 0
		spinlvl(CurrentPlayer) = spinlvl(CurrentPlayer) + 1
		s13.state = 0
		merlock1.enabled = 0
		ps13(currentplayer) = 0
		mertimer.enabled = 0
		playclear pBackglass
		PuPlayer.SetLoop 2,0
		'PuPlayer.playresume 4
		playbgaudio
		checkvoldemort
		mersjready = 0
		mermultivalue = 1000000
		GiOff
		GiOn
		spotson
		bMultiBallMode = False
		inmermulti = 0
		gispinstop
		gicolor(base)
		endamultiball
		s11.state = 0
		s61.state = 0
		s81.state = 0
		s91.state = 0
		SetLightColor s11, base, -1
		SetLightColor s61, base, -1
		SetLightColor s91, base, -1
		SetLightColor s81, base, -1
		SetLightColor s12, base, -1
		TurnOffmultiLights
		GiOff
		GiOn
		spotson
		bMultiBallMode = False
		gicolor(base)
		endamultiball
		resetcolors
		relighttable
		gispinstop
		if inamode = 1 Then
			modelightscheck
		end If
		playerspin
		playerspins(CurrentPlayer) = 0
	end sub






'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  Wand Multiball
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 


	'****************************
	' COMBOS
	'****************************

	Dim combopos:combopos = 0
	Sub combotimer_timer
		dim a
		if s14.state = 0 then 
			for each a in combolights
				SetLightColor a, white, -1
				a.state = 2
				a.BlinkInterval = 80
				a.intensity = 4
			next
		end If
		combopos = combopos + 1
		select case combopos

		case 6
			stopcombo
		end Select
	End Sub

	Sub stopcombo
		combotimer.enabled = 0
		combopos = 0
		currentcombo(CurrentPlayer) = 0
		dim a
		for each a in combolights
			a.state = 0
		next
	end Sub

  Sub checkcombos
    If skillshotlive = 1 then
    exit Sub
    end if
    If bMultiBallMode = True then
    exit Sub
    end if
    'PuPlayer.playlistplayex pCallouts,"audiocombo","",vovol,1
    currentcombo(CurrentPlayer) = currentcombo(CurrentPlayer) + 1
    totalcombo(CurrentPlayer) = totalcombo(CurrentPlayer) + 1
    If totalcombo(CurrentPlayer) > 9 then
    PuPlayer.LabelSet pBackglass,"combonum",0,1,"{'mt':2,'color':15066597, 'size': 4, 'xpos': 38.9, 'xalign': 1, 'ypos': 74.8, 'yalign': 1}"
    Else
    PuPlayer.LabelSet pBackglass,"combonum",10 - totalcombo(CurrentPlayer),1,"{'mt':2,'color':15066597, 'size': 4, 'xpos': 38.9, 'xalign': 1, 'ypos': 74.8, 'yalign': 1}" 
    End If
    combotimer.enabled = 1
    combopos = 0
    Select Case currentcombo(CurrentPlayer)
    case 1

    case 2
      pNote "Combo","1"
      'pupDMDDisplay "-","Combo^One",dmdnote,3,0,10
      AddScore 8000
    case 3
      pNote "Combo","2"
      'pupDMDDisplay "-","Combo^Two",dmdnote,3,0,10
      AddScore 16000
    case 4
      pNote "Combo","3"
      'pupDMDDisplay "-","Combo Three^50,000",dmdnote,3,0,10
      AddScore 50000
    case 5
      pNote "Combo","4"
      'pupDMDDisplay "-","Combo Four^100,000",dmdnote,3,0,10
      AddScore 100000
    case 6
      pNote "Combo","5"
      pupDMDDisplay "-","Combo Five^200,000",dmdnote,3,0,10
      AddScore 200000
    case 7
      pNote "Combo","6"
      pupDMDDisplay "-","Combo Six^500,000",dmdnote,3,0,10
      AddScore 500000
    case 8
      pNote "Combo","7"
      pupDMDDisplay "-","Combo Seven^1,000,000",dmdnote,3,0,10
      AddScore 1000000
    case 9
      pNote "Combo","8"
      pupDMDDisplay "-","Combo Eight^1,000,000",dmdnote,3,0,10
      AddScore 1000000
    case 10
      pNote "Combo","9"
      pupDMDDisplay "-","Combo Nine^1,000,000",dmdnote,3,0,10
      AddScore 1000000
    End Select

    Select Case totalcombo(CurrentPlayer)
      case 10
        wandlockready
        'PuPlayer.playlistplayex pCallouts,"audiocallouts","wand lock ready.wav",vovol,1
        playmedia "wand lock ready.wav","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
        pupDMDDisplay "-","Wand Lock^Is Lit",dmdnote,3,0,10
      case 11
        totalcombo(CurrentPlayer) = 9
        wandlockready
    end Select
  End Sub


	Sub wandlockready
		If bMultiBallMode = true then exit Sub
		s53.state = 2
		t16.state = 2
		ps53(CurrentPlayer) = 1
		wandopen
		kicker5.enabled = 1
	end sub


	'****************************
	' DIVERT
	'****************************

	dim leftd2:leftd2=0
	sub wandopen
			If bMultiBallMode = true then exit Sub
			leftdivert1.RotateToEnd
			'PlaySoundAt "mbpc-diverter", leftdivert1
			leftd2=1
	End Sub

	Sub wandclose
			leftdivert1.RotateToStart
			'PlaySoundAt "mbpc-diverter", leftdivert1
			leftd2=0
	end Sub



	'****************************
	' LOCK
	'****************************


	sub kicker5_hit
		DOF 131, DOFPulse
		AddScore 8000
		PlaySoundAt "mbpc-magnet", leftmagnet
		PlaySoundAt "magnet", leftmagnet
		if nofunmode = 0 Then
		magiccircle.opacity = 100
		magiccircle.TimerEnabled = 1
		end if
		vpmtimer.addtimer 2500, "offagain '"
		vpmtimer.addtimer 2000, "lockflash '"
		If bMultiBallMode = true Then
			LeftFlipper1.endangle = 0
			LeftFlipper1.rotatetoend
			vpmtimer.addtimer 300, "wandkick '"	
			droppops
		Else
			wandlocks(CurrentPlayer) = wandlocks(CurrentPlayer) + 1
			If wandlocks(CurrentPlayer) = 2 Then
				bMultiBallMode = true
				playmedia "wandmultiballintro.mp4","videoscenes",pBackglass,"cineon",10000,"startwandmulti",1,9  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
				vpmtimer.addtimer 2000, "wandlast '"
			Else
				playmedia "wandball1locked.mp4","videoscenes",pBackglass,"cineon",2500,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)'"
				vpmtimer.addtimer 2500, "wandnext '"
			End If
		End If
	end Sub

	sub wandnext
		kicker5.destroyball
		CreateNewBall()
		wandclose
		s53.state = 0
		t16.state = 0
		ps53(CurrentPlayer) = 0
		totalcombo(CurrentPlayer) = 0
	end Sub

	sub wandlast
		kicker5.destroyball
		'destroycalc
		wandclose
		s53.state = 0
		t16.state = 0
		ps53(CurrentPlayer) = 0
		totalcombo(CurrentPlayer) = 0
	end Sub

	sub lockflash
		PlaySound "wandlock"
		Flasherflash7.opacity = 3000
		FlashForMs Flasherlight7, 500, 50, 0
		vpmtimer.addtimer 200, "lockflashoff '"
	end Sub

	sub lockflashoff 
		Flasherflash7.opacity = 0
	end sub

	sub magiccircle_Timer()
		magiccircle.rotz = magiccircle.rotz +1
		magiccircle.opacity = RndNum(10,90)
	End Sub

	'sub dropkicker
'
'		vpmtimer.addtimer 1000, "offagain '"	
'	end Sub

	sub offagain

		'kicker5.kick 180, 20, 0
		kicker5.enabled = 0
		if nofunmode = 0 Then
		magiccircle.opacity = 0
		magiccircle.TimerEnabled = 0
		end if
	end Sub

	Sub wandlock_hit

	End Sub


	Sub wandkick
		wandlock.createball
		wandlock.kick 70, 40, 0
		vpmtimer.addtimer 400, "wandkick2 '"	
	End Sub

	Sub wandkick2
		wandlock.createball
		wandlock.kick 70, 40, 0
		vpmtimer.addtimer 400, "wandkick3 '"	
	End Sub

	Sub wandkick3
		wandlock.createball
		wandlock.kick 70, 40, 0
		vpmtimer.addtimer 400, "resetflip '"
		quickcount
	End Sub

	sub resetflip
		LeftFlipper1.endangle = 100
		LeftFlipper1.rotatetostart
	end sub

	'****************
	'     MULTIBALL
	'****************

	Dim inwandmulti:inwandmulti = 0

	Sub startwandmulti
		dropwall
		lastmb = "startwandmulti '"
		closemaze
		stopmer.collidable = 1
		LeftFlipper1.endangle = 0
		LeftFlipper1.rotatetoend
		vpmtimer.addtimer 100, "wandkick '"
		'BallsOnPlayfield = 4
		droppops
		'PuPlayer.playlistplayex pBackglass,"videoscenes","wandmulti.mp4",vsvol,1
		playmedia "wandmulti.mp4","videoscenes",pBackglass,"",0,"",1,10  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		PuPlayer.SetLoop 2,1
		'PuPlayer.playpause 4
		playclear pMusic
		'PuPlayer.playlistplayex pAudio,"audiomultiballs","wand.mp3",100,3
		playmedia "wand.mp3","audiomultiballs",pAudio,"",0,"",1,3  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		EnableBallSaver 10:bBallSaverActive = True
		giflasher
		spotsoff
		vpmtimer.addtimer 800, "lightwandjp '"
		vpmtimer.addtimer 1500, "nowinwand '"
	End Sub

	sub nowinwand
		inwandmulti = 1
		bMultiBallMode = true
		quickcount
	end Sub

	dim mbcurrentcolor:mbcurrentcolor = amber

	Sub lightwandjp
		TurnOffmultiLights
		dim a
		for each a in wandjplights
			a.state = 2
			SetLightColor a, mbcurrentcolor, -1
		next
		modelightscheck
	End Sub


	Sub giflasher
		gicolor(mbcurrentcolor)
		giflashtime.enabled = 1
	end Sub

	dim giflashpos:giflashpos = 0

	sub giflashtime_timer
		if runninglights = 1 then exit sub
		lightwandjp
		giflashpos = giflashpos + 1
		select case giflashpos
			case 1
				GiOff
			case 2
				GiOn
				gicolor(mbcurrentcolor)
				giflashpos = 0
		end Select
	end Sub
	
	dim runninglights:runninglights = 0

	sub wandjackpot
		wandjacks(CurrentPlayer) = wandjacks(CurrentPlayer) + 1
		Select case wandjacks(currentplayer)
			case 1 : mbcurrentcolor = yellow
			case 2 : mbcurrentcolor = darkgreen
			case 3 : mbcurrentcolor = green
			case 4 : mbcurrentcolor = blue
			case 5 : mbcurrentcolor = darkblue
			case 6 : mbcurrentcolor = purple
			case 7 : mbcurrentcolor = red
			case 8 : mbcurrentcolor = orange
			case 9 : mbcurrentcolor = amber
			case 10 : mbcurrentcolor = yellow
			case 11 : mbcurrentcolor = darkgreen
			case 12 : mbcurrentcolor = green
			case 13 : mbcurrentcolor = blue
			case 14 : mbcurrentcolor = darkblue
			case 15 : mbcurrentcolor = purple
		end Select

		If wandjacks(currentplayer ) = 15 Then
			addscore 7000000
			pupDMDDisplay "-","Super Jackpot^7,000,000",dmdnote,3,0,10
			'PuPlayer.playlistplayex pCallouts,"audiocallouts","super jackpot.wav",vovol
			playmedia "super jackpot.wav","audiocallouts",pCallouts,"",0,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			wandjacks(CurrentPlayer) = 0
			t16.state = 1
			pt16(CurrentPlayer) = 1
		Else
			addscore 1500000
			pupDMDDisplay "-","Jackpot^1,500,000",dmdnote,3,0,10
			'PuPlayer.playlistplayex pCallouts,"audiojackpot","",vovol,1
			playmedia "","audiojackpot",pCallouts,"",0,"",1,4  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		End if 
			'***** LIGHT RUNS *****
			'(CHAOS)randoms
			'(DIRECTIONS)uup|udown|uleft|uright|diagdl|diagdr|diagul|diagur
			'(SWIPES)middleih|middleiv|middleoh|middleov|stripe1h|hatch1h|hatch1v|hatch2h|hatch2v|stripe1v|stripe2h|stripe2v
			'(SPINS)circlein|circleout|clockleft|clockright|screwl|screwr
			'(CURVES)arcbld|arcblu|arcbrd|arcbru|arctld|arctlu|arctrd|arctru|fanld|fanlu|fanrd|fanru|radarl|radarr|wiperl|wiperr
			'(EXAMPLE)lightrun red,arcbld,1  (SYNTAX)lightrun color,direction,times to run
			lightrun amber,circleout, 2
			flasherspop amber,"crazy"
		runninglights = 1
		vpmtimer.addtimer 700, "nolongerrun '"
	End Sub

	Sub nolongerrun
		runninglights = 0
		LightSeqAttract.StopPlay
	end Sub

	Sub endwandmulti
		stopmer.collidable = 0
		inwandmulti = 0
		playclear pBackglass
		PuPlayer.SetLoop 2,0
		'PuPlayer.playresume 4
		playbgaudio
		checkvoldemort
		gispinstop
		giflashtime.enabled = 0
		TurnOffmultiLights
		GiOff
		GiOn
		spotson
		bMultiBallMode = False
		gicolor(base)
		endamultiball
		resetcolors
		relighttable
		if inamode = 1 Then
			modelightscheck
		end If
		wandlocks(CurrentPlayer) = 0
	end sub




'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  Maze Multiball
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 
	sub checkright
		dim n
		n = slr1.state + slr2.state + slr3.state + slr4.state
		select case n
		case 0
			slr1.state = 1
			pslr1(CurrentPlayer) = 1
		case 1
			slr2.state = 1
			pslr2(CurrentPlayer) = 1
		case 2
			slr3.state = 1
			pslr3(CurrentPlayer) = 1
		case 3
			slr4.state = 1
			pslr4(CurrentPlayer) = 1
		End Select
		checkbothramps
	end Sub

	sub checkleft
		dim n
		n = srr1.state + srr2.state + srr3.state + srr4.state
		select case n
		case 0
			srr1.state = 1
			psrr1(CurrentPlayer) = 1
		case 1
			srr2.state = 1
			psrr2(CurrentPlayer) = 1
		case 2
			srr3.state = 1
			psrr3(CurrentPlayer) = 1
		case 3
			srr4.state = 1
			psrr4(CurrentPlayer) = 1
		End Select
		checkbothramps
	end Sub

	sub checkbothramps
		dim n
		n = srr1.state + srr2.state + srr3.state + srr4.state + slr1.state + slr2.state + slr3.state + slr4.state
		PuPlayer.LabelSet pBackglass,"mazeramp",n & "/" & 8,1,"{'mt':2,'color':2697513, 'size': 3, 'xpos': 64.2, 'xalign': 1, 'ypos': 6.2, 'yalign': 1}"
		select case n
		case 8
			lightmazelock
		end Select
	end Sub

	dim mazecall:mazecall = 0
	sub lightmazelock
		if bMultiBallMode = true then exit sub
		s33.state = 2
		openmaze
		if mazecall = 0 Then
		'PuPlayer.playlistplayex pCallouts,"audiocallouts","maze lock ready.wav",vovol,1
		playmedia "maze lock ready.wav","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		pupDMDDisplay "-","Maze Lock^Is Lit",dmdnote,3,0,10
		end If
		mazecall = 1
	end Sub


	Sub mazeramp_hit
		if inmazemulti = 1 Then
			If s31.state = 2 Then
				mazejphit
			end If
			If slr3.state = 2 Then
				mazesjhit
			end If
		end If
	End Sub



	'****************************
	' LOCK
	'****************************

	

	Sub mazelock_hit
		If bMultiBallMode = true Then
			vpmtimer.addtimer 10, "mazeinstakick '"
		Else
			'debug.print "prenewball " & BallsOnPlayfield
			mazelocks(CurrentPlayer) = mazelocks(CurrentPlayer) + 1
			If mazelocks(CurrentPlayer) = 3 Then
				clearmazelights

					GiOff
					spotsoff
					gicolor(green)
					'PuPlayer.playpause 4
					playclear pMusic
					bMultiBallMode = True
					'PuPlayer.playlistplayex pBackglass,"videoscenes","maze-intro.mp4",vsvol,1
					playmedia "maze-intro.mp4","videoscenes",pBackglass,"cineon",16000,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
					vpmtimer.addtimer 9000, "mazedelayedcall2 '"
					vpmtimer.addtimer 12000, "mazedelayedcall3 '"
					vpmtimer.addtimer 15000, "startmazemulti '"
					'if inamode = 1 Then
					'	modetimeleft.enabled = 0
					'	vpmtimer.addtimer 5000, "starttheclock '"
					'end if
				mazelock.destroyball
				s33.state = 0
			elseIf mazelocks(CurrentPlayer) = 2 Then
				t20.state = 2
				'PuPlayer.playlistplayex pCallouts,"audiocallouts","ball2locked.mp3",vovol,1
				'PuPlayer.playlistplayex pBackglass,"videoscenes","mazeball2locked.mp4",vsvol,1
				playmedia "mazeball2locked.mp4","videoscenes",pBackglass,"cineon",10000,"",100,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
				vpmtimer.addtimer 10000, "CreateNewBall() '"
				'PuPlayer.playpause 4
				'vpmtimer.addtimer 10000, "merresumemusic '"
				mazelock.destroyball
				'vpmtimer.addtimer 10000, "CreateNewBall() '"
			Else
				'PuPlayer.playlistplayex pCallouts,"audiocallouts","ball1locked.mp3",vovol,1
				PuPlayer.playlistplayex pBackglass,"videoscenes","mazeball1locked.mp4",vsvol,1
				playmedia "mazeball1locked.mp4","videoscenes",pBackglass,"cineon",6000,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
				vpmtimer.addtimer 6000, "CreateNewBall() '"
				'PuPlayer.playpause 4
				'vpmtimer.addtimer 10000, "merresumemusic '"
				mazelock.destroyball
				'vpmtimer.addtimer 6000, "CreateNewBall() '"
				
			End If
		End If
	end sub

	sub mazedelayedcall2
		'PuPlayer.playlistplayex pCallouts,"audiocallouts","thetriwizard.mp3",vovol,1
		PuPlayer.SendMSG "{ ""mt"":301, ""SN"": 8, ""FN"":11, ""VL"":"&vovol&" }"
		playmedia "thetriwizard.mp3","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		'chilloutthemusic
	end sub

	sub mazedelayedcall3
		'PuPlayer.playlistplayex pCallouts,"audiocallouts","mazeescape.mp3",vovol,1
		PuPlayer.SendMSG "{ ""mt"":301, ""SN"": 8, ""FN"":11, ""VL"":"&vovol&" }"
		playmedia "mazeescape.mp3","audiocallouts",pCallouts,"",0,"",1,1  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		'chilloutthemusic
	end sub










	Sub mazeinstakick
		mazelock.kick 270, 40, 0	
	End Sub

	Sub clearmazelights
		srr1.state = 0
		srr2.state = 0
		srr3.state = 0
		srr4.state = 0
		slr1.state = 0
		slr2.state = 0
		slr3.state = 0
		slr4.state = 0
		pslr4(CurrentPlayer) = 0
		pslr3(CurrentPlayer) = 0
		pslr2(CurrentPlayer) = 0
		pslr1(CurrentPlayer) = 0
		psrr1(CurrentPlayer) = 0
		psrr2(CurrentPlayer) = 0
		psrr3(CurrentPlayer) = 0
		psrr4(CurrentPlayer) = 0
	End Sub


	'****************************
	' Multiball
	'****************************

	Sub gislide
		dim a
			for each a in gi
				a.intensity = 300
			next
		gicolor(darkgreen)
		LightSeqGi.UpdateInterval = 1
		LightSeqGi.Play SeqHatch1HorizOn, 90,2000,0
	end Sub

	Sub gislidestop
		dim a
			for each a in gi
				a.intensity = 80
			next
		gicolor(base)
		LightSeqGi.StopPlay
	end Sub


	dim inmazemulti:inmazemulti = 0

	Sub startmazemulti
		lastmb = "startmazemulti '"
		t20.state = 0
		droppops
		wandclose
		stopmer.collidable = 1
		mazelock.enabled = 0
		triplekick
		inmazemulti = 1
		mazejacks(CurrentPlayer) = 0
		'PuPlayer.playlistplayex pBackglass,"videoscenes","maze-mb.mp4",vsvol,1
		playmedia "maze-mb.mp4","videoscenes",pBackglass,"",0,"",1,10  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		PuPlayer.SetLoop 2,1
		'PuPlayer.playpause 4
		playclear pMusic
		'PuPlayer.playlistplayex pAudio,"audiomultiballs","maze.mp3",100,3
		playmedia "maze.mp3","audiomultiballs",pAudio,"",0,"",1,3  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		bMultiBallMode = True
		openmaze
		bBallSaverActive = False
		EnableBallSaver 20:bBallSaverActive = True
		GiOn
		
		spotsoff
		gislide
		mazelights
		mazetimer.enabled = 1
	End Sub

	sub triplekick
		mazelock.createball
		mazelock.kick 240, 40, 0
		vpmtimer.addtimer 400, "triplekick2 '"
	end Sub

	sub triplekick2
		mazelock.createball
		mazelock.kick 240, 40, 0
		vpmtimer.addtimer 400, "triplekick3 '"
	end Sub

	sub triplekick3
		mazelock.createball
		mazelock.kick 240, 40, 0
		quickcount
	end Sub

	Sub mazelights
		PuPlayer.LabelSet pBackglass,"mazejacks",mazejacks(CurrentPlayer),1,"{'mt':2,'color':2697513, 'size': 3, 'xpos': 64.2, 'xalign': 1, 'ypos': 11.9, 'yalign': 1}"
		TurnOffmultiLights
		dim a
		for each a in mazejplightcol
			SetLightColor a, darkgreen, -1
		next
		If pt20(CurrentPlayer) = 1 Then
			t20.state = 1
		End If
		If mazesjon = 1 Then
			lightmazesuperj
		end if
		Select case mazejacks(CurrentPlayer)
		Case 0'left
			s91.state = 2:s92.state = 2:s81.state = 2:s61.state = 2:s62.state = 2

		Case 1'right
			s31.state = 2:s32.state = 2:s11.state = 2:s12.state = 2:s51.state = 2:s52.state = 2
		Case 2'center
			s51.state = 2:s52.state = 2:s61.state = 2:s62.state = 2:s31.state = 2:s32.state = 2
		Case 3'left
			s31.state = 2:s32.state = 2:s11.state = 2:s12.state = 2:s51.state = 2:s52.state = 2:lightmazesuperj
		Case 4'center
			s51.state = 2:s52.state = 2:s61.state = 2:s62.state = 2:s31.state = 2:s32.state = 2
		Case 5'right
			s91.state = 2:s92.state = 2:s81.state = 2:s61.state = 2:s62.state = 2
		Case 6
			mazejacks(CurrentPlayer) = 0
		end select
		modelightscheck
	end sub

	dim mazesjon:mazesjon = 0

	sub lightmazesuperj
		mazesjon = 1
		SetLightColor s31, red, -1
		SetLightColor s32, red, -1
		SetLightColor s33, red, -1
		SetLightColor s34, red, -1
		SetLightColor slr1, red, -1
		SetLightColor slr2, red, -1
		SetLightColor slr3, red, -1
		SetLightColor slr4, red, -1
		s31.state = 2
		s32.state = 2
		s33.state = 2
		s34.state = 2
		slr1.state = 2
		slr2.state = 2
		slr3.state = 2
		slr4.state = 2
	End Sub

	sub mazesjhit
		mazesjon = 0
		t20.state = 1
		pt20(CurrentPlayer) = 1
	end Sub

	sub mazetimer_timer
		mazelock.enabled = 0
		if runninglights = 1 then exit sub
		mazelights
	end Sub


	sub mazejphit
		'PuPlayer.playlistplayex pCallouts,"audiojackpot","",vovol,1
		playmedia "","audiojackpot",pCallouts,"",0,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		pupDMDDisplay "-","Jackpot^2,000,000",dmdnote,3,0,10
		addscore 2000000
		mazejacks(CurrentPlayer) = mazejacks(CurrentPlayer) + 1

			'***** LIGHT RUNS *****
			'(CHAOS)randoms
			'(DIRECTIONS)uup|udown|uleft|uright|diagdl|diagdr|diagul|diagur
			'(SWIPES)middleih|middleiv|middleoh|middleov|stripe1h|hatch1h|hatch1v|hatch2h|hatch2v|stripe1v|stripe2h|stripe2v
			'(SPINS)circlein|circleout|clockleft|clockright|screwl|screwr
			'(CURVES)arcbld|arcblu|arcbrd|arcbru|arctld|arctlu|arctrd|arctru|fanld|fanlu|fanrd|fanru|radarl|radarr|wiperl|wiperr
			'(EXAMPLE)lightrun red,arcbld,1  (SYNTAX)lightrun color,direction,times to run
			lightrun darkgreen,udown, 2
			flasherspop green,"crazy"
		runninglights = 1
		vpmtimer.addtimer 700, "nolongerrun '"
	End Sub



	Sub endmazemulti
		mazelocks(CurrentPlayer) = 0
		stopmer.collidable = 0
		inmazemulti = 0
		mazesjon = 0
		playclear pBackglass
		PuPlayer.SetLoop 2,0
		'PuPlayer.playresume 4
		playbgaudio
		checkvoldemort
		mazetimer.enabled = 0
		gislidestop
		TurnOffmultiLights
		closemaze
		GiOff
		GiOn
		spotson
		bMultiBallMode = False
		gicolor(base)
		endamultiball
		resetcolors
		relighttable
		mazelock.enabled = 1
		LightSeqGi.StopPlay
		inmazemulti = 0
		gislidestop
		if inamode = 1 Then
			modelightscheck
		end If
	end sub




'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  WIZARD - VOLDEMORT
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 



	Sub checkvoldemort
	'	If t19.state + t20.state + t18.state + t16.state = 4 Then
	'		swizard.state = 2
	'	End If
	end sub










'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  Minigame
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 



		'*************************
		' PUP MINI GAME (videomode)
		' create a timer (disable default) PuPGameTimer (interval 300)
		' when you want to start game call PuPGameStartMiniGame
		' look at PuPMiniGameEnd to do something when gameover.
		' game music be called PuPMiniGame.exe inside ofr MiniGame folder of puppack!
		' see sample of key_down and key_up in table script!
		'*************************

		DIM PuPGameRunning:PuPGameRunning=false
		DIM PuPGameTimeout
		DIM PuPGameInfo
		DIM PuPGameScore

		Sub PuPGameStartMiniGame
			if PuPGameRunning Then Exit Sub
			'PuPlayer.SendMSG "{ ""mt"":301, ""SN"": 2, ""FN"":16, ""EX"": ""MiniGame\\PuPMiniGame.exe"", ""WT"": ""PupMiniGame"", ""RS"":1 , ""TO"":15 , ""WZ"":0 , ""SH"": 1 , ""FT"":""Visual Pinball Player"" }"    
			'PuPlayer.SendMSG "{ ""mt"":301, ""SN"": 2, ""FN"":3, ""OT"": 0 }"      'this will hide overlay if applicable
			PuPGameTimeout=-3    'check for timeout  every 500 ms
			PuPGameRunning=true	
			PuPGameTimer.enabled=true
			PuPlayer.playpause pBackglass
		End Sub

		Sub PuPMiniGameEnd(gamescore)
			if PuPGameRunning Then Exit Sub
			inminigame = 0
			PuPlayer.playresume pBackglass
			addscore PuPGameScore
			PuPlayer.LabelSet pBackglass,"mgscore",FormatNumber(PuPGameScore,0),1,""
			playmedia "defensescore.mp4","videoscenes",pBackglass,"cineon",4000,"",1,5  '(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
			'msgbox "mini score "&PuPGameScore
			'PuPlayer.SendMSG "{ ""mt"":301, ""SN"": 2, ""FN"":3, ""OT"": 1 }"      'this will showsuccess overlay if applicable
			vpmtimer.addtimer 4000, "clearmgscore '"
			vpmtimer.addtimer 4000, "checkk1lock '"
		End Sub

		sub clearmgscore
			PuPlayer.LabelSet pBackglass,"mgscore","",1,""
		end Sub

		Sub PuPGameTimer_Timer()    
			PuPGameTimeout=PuPGameTimeout+12
			PuPGameInfo= 0 ' PuPlayer.GameUpdate("PupMiniGame", 0 , 0 , "")   '0=game over, 1=game running
			'CHECK GAME OVER
			if PuPGameInfo=0 AND PuPGameTimeOut>12 Then  'gameover if more than 5 seconds passed
			   PuPGameTimer.enabled=false 
			   PupGameRunning=False
			   PuPGameScore=1000000 ' PuPlayer.GameUpdate("PupMiniGame", 6 , 0 , "\MiniGame\gameover.txt")   'grab score from minigame   3=gms 6=godot           
			   'msgbox PuPGameScore  DO something with the score if its over 0!!!
			   PuPMiniGameEnd(PuPGameScore)       
			End If 
		End Sub





'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  UTILITY - BALL FINDER
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 

	dim looktimer:looktimer = 0
	sub ballfinder_timer
		Dim BOT, b
		BOT = GetBalls
		looktimer = looktimer + 1

		' if no balls then no look
		If UBound(BOT) = 1 Then 
			'looktimer = 0
		End If
	
		If bAttractMode = true Then
			looktimer = 0
		end if

		if hsbModeActive = True Then
			looktimer = 0
		end If

		If cineon = 1 Then
			looktimer = 0
		end if

		if inminigame = 1 Then
			looktimer = 0
		end if

		' play the rolling sound for each ball
		For b = 0 to UBound(BOT)
            If BallVel(BOT(b) ) > 1  Then
				looktimer = 0
            End If
		Next

		If ldown = 1 or rdown = 1 Then
			For b = 0 to UBound(BOT)
				if BOT(b).Y > 1775 and BOT(b).Y < 1985 Then			
					if Bot(B).X > 315 and Bot(B).X < 800 then
						'debug.print "being trapped"
						looktimer = 0
					end if
				end if
			Next
		end if

			For b = 0 to UBound(BOT)
				if BOT(b).Y > 1938 and BOT(b).Y < 2077 Then			
					if Bot(B).X > 1014 and Bot(B).X < 1066 then
						'debug.print "in launch lane"
						looktimer = 0
					end if
				end if
			Next

		'debug.print UBound(BOT)
		'debug.print BallsOnPlayfield

		'debug.print "looktimer" & looktimer
		Select Case looktimer
			case 5:debug.print "looktimer 5"
			case 10:debug.print "looktimer 10"
			case 12:bumperrun
			case 15:kickerclear
			case 18:merclear
			case 20:ballstuckoption
		end Select

	end Sub

	sub bumperrun
		Bumper1_Hit
		Nudge 90, 6
		vpmtimer.addtimer 300, "Bumper3_Hit '"
		vpmtimer.addtimer 600, "Bumper4_Hit '"
		vpmtimer.addtimer 700, "forwardbump '"
		vpmtimer.addtimer 900, "Bumper2_Hit '"
	end Sub

	sub forwardbump
		Nudge 0, 7
	end sub

	sub kickerclear
		debug.print "clear the kickers"
		ChestHole.DestroyBall
		'ChestOut.CreateBall
		kicker5.destroyball
		PlaySoundAt SoundFXDOF("mbpc-vuk",117,DOFPulse,DOFContactors), chestout
		DOF 115, DOFPulse 'Strobe
		ChestOut.kick 300, 30, 1.56
		dropwall
		ChestOut.kick 300, 30, 1.56
		kicker1.kick 82, 32, 0
		PlaySoundAt SoundFXDOF("mbpc-popper",116,DOFPulse,DOFContactors), kicker1
		BallRelease.Kick 90, 41
		PlaySoundAt SoundFXDOF("mbpc-ballrelease", 114, DOFPulse, DOFContactors), BallRelease
		Kicker3.Kick 90, 1
		Kicker2.Kick 90, 1
		mazelock.kick 240, 40, 0
	end sub

	Sub merclear
		merlock1.kick 160, 30, 0
		merlock2.kick 160, 30, 0
		merlock3.kick 160, 30, 0
	end sub

	Sub ballstuckoption
		debug.print "ball stuck- add a ball"
		BallRelease.CreateSizedball BallSize / 2
		PlaySoundAt SoundFXDOF("mbpc-ballrelease", 114, DOFPulse, DOFContactors), BallRelease
		BallRelease.Kick 90, 41
		EnableBallSaver 5
	end Sub



'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  UTILITY - Video Manager & skipper
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 

	dim currentqueue
	dim cineon:cineon = 0
	dim skipped:skipped = 0
		
	Dim lastName
	Dim lastPlaylist
	Dim lastCinematic
	Dim lastLength
	Dim lastNextItem
	Dim lastAudiolevel
	Dim lastPriority
	Dim playPupStatus : playPupStatus = 0
			
	sub playclear(chan)
		debug.print "play clear'd " & chan
		if chan = pAudio Then
			'PuPlayer.playlistplayex pAudio,"audioclear","clear.mp3",100,20
			'PuPlayer.playstop pAudio
			playPupStatus = 0
			EndMusic
		End If

		if chan = pMusic Then
			playPupStatus = 0
			EndMusic
			'PuPlayer.playlistplayex pMusic,"audioclear","clear.mp3",100,20
			'PuPlayer.playstop pMusic
			'PuPlayer.SendMSG "{ ""mt"":301, ""SN"": 4, ""FN"":11, ""VL"":0 }"
		End If

		if chan = pBackglass Then
			'PuPlayer.playlistplayex pBackglass,"backglass","clear.mp4",0,20
			PuPlayer.playstop pBackglass
		end if 
	end Sub

	sub playpupmusic(name,playlist,cinematic,length,nextitem,audiolevel,priority)
		lastName = name
		lastPlaylist = playlist
		lastCinematic = cinematic
		lastLength = length
		lastNextItem = nextitem
		lastAudiolevel = audiolevel
		lastPriority = priority
		PlayMusic  "./pupvideos/" & pGameName & "/" & playlist & "/" & name, audiolevel / 100
		playPupStatus = 1
	end sub

	sub playpupvolume(audiolevel)
		If (playPupStatus  > 0) Then
			MusicVolume = audiolevel / 100
		End If
	end sub

	sub Table1_MusicDone
		If (playPupStatus = 1) Then
			playpupmusic lastName, lastPlaylist, lastCinematic, lastLength, lastNextItem, lastAudiolevel, lastPriority
		End If
	end sub

	dim lastvocall:lastvocall=""
	dim noskipper:noskipper=0

	'example playmedia "hs.mp3","audiomultiballs",pAudio,"cineon",10000,"",1,1  // (name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
	sub playmedia(name,playlist,channel,cinematic,length,nextitem,audiolevel,priority)
		if audiolevel = 1 Then
			if channel = pBackglass Then
				audiolevel = vsvol
				currentqueue = " "
			Elseif channel = pCallouts Then
				audiolevel = vovol
			Elseif channel = pMusic Then
				audiolevel = sndtrkvol
			Elseif channel = pAudio Then
				audiolevel = sndtrkvol
			Elseif channel = pAudio2 Then
				audiolevel = sndtrkvol
			Elseif channel = pOvervid Then
				audiolevel = vsvol
			end If
		end If

		if (channel = pMusic) Or (channel = pAudio) Then
			playpupmusic name,playlist,cinematic,length,nextitem,audiolevel,priority
			Exit Sub
		End If


		if channel = pCallouts Then
			if name = "jackpot.mp3" or name ="" or name = "jackpot.wav" Then
			else
				if lastvocall = name then exit sub
			end if
		end if
		

		if nextitem = "" Then
			If cinematic = "cineon" Then
				noskipper=1
				vpmtimer.addtimer length, "nextitems '"
			end If
		Else
			vpmtimer.addtimer length, "nextitems '"
			currentqueue = nextitem
		end If

		If cinematic = "cineon" Then
			skipped=0
			'PuPlayer.playpause 4 ' stop then resume the music
			'PuPlayer.SendMSG "{ ""mt"":301, ""SN"": 4, ""FN"":11, ""VL"":20 }"
			playpupvolume 20
			vpmtimer.addtimer length, "turnitbackupcine '"
			GiOff
			cineon = 1
		end If

		PuPlayer.playlistplayex channel,playlist,name,audiolevel,priority

		If channel = pCallouts Then
			PuPlayer.SendMSG "{ ""mt"":301, ""SN"": 2, ""FN"":11, ""VL"":60 }"
			'PuPlayer.SendMSG "{ ""mt"":301, ""SN"": 4, ""FN"":11, ""VL"":60 }"
			playpupvolume 60
			'PuPlayer.SendMSG "{ ""mt"":301, ""SN"": 7, ""FN"":11, ""VL"":60 }"
			vpmtimer.addtimer length, "turnitbackup'"
		end If

		If channel = pOvervid Then
			PuPlayer.SendMSG "{ ""mt"":301, ""SN"": 2, ""FN"":11, ""VL"":50 }"
			vpmtimer.addtimer length, "turnitbackupvid'"
		end If

			if channel = pCallouts Then
				lastvocall=name
			end if

	end sub

	Sub turnitbackup
		PuPlayer.SendMSG "{ ""mt"":301, ""SN"": 2, ""FN"":11, ""VL"":"&vsvol&" }"
		'PuPlayer.SendMSG "{ ""mt"":301, ""SN"": 4, ""FN"":11, ""VL"":"&sndtrkvol&" }"
		playpupvolume sndtrkvol
		'PuPlayer.SendMSG "{ ""mt"":301, ""SN"": 7, ""FN"":11, ""VL"":"&vovol&" }"
		debug.print "turnitbackup "
		'puplayer.setvolume pMusic sndtrkvol
	End Sub

	Sub turnitbackupvid
		PuPlayer.SendMSG "{ ""mt"":301, ""SN"": 2, ""FN"":11, ""VL"":"&vsvol&" }"
		debug.print "turnitbackupvid "
	End Sub

	Sub turnitbackupcine
		'PuPlayer.SendMSG "{ ""mt"":301, ""SN"": 4, ""FN"":11, ""VL"":"&sndtrkvol&" }"
		playpupvolume sndtrkvol
		debug.print "turnitbackupcine "
	End Sub

	sub holder
	end sub

	sub nextitems
		if skipped = 0 Then
			noskipper=0
			'PuPlayer.playresume 4
			'PuPlayer.SendMSG "{ ""mt"":301, ""SN"": 4, ""FN"":11, ""VL"":"&sndtrkvol&" }"
			playpupvolume sndtrkvol
			gion
			cineon = 0
			looktimer = 0
			execute currentqueue
		Elseif skipped = 1 Then
			'PuPlayer.playresume 4
			'PuPlayer.SendMSG "{ ""mt"":301, ""SN"": 4, ""FN"":11, ""VL"":"&sndtrkvol&" }"
			playpupvolume sndtrkvol
			gion
			cineon = 0
			looktimer = 0
			skipped = 3
			execute currentqueue
			currentqueue = " "
		end If
	end Sub



	sub vidskipper_timer
		if cineon = 1  and noskipper = 0 Then
			if ldown = 1 and rdown = 1 Then
				nextitems
				skipped = 1
			end If
		end If
	end Sub


	'logic for skipping
	' vid starts. is it cinematic?
	' yes cineon = 1



'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  UTILITY - CINEMATIC SKIPPING
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  


	Dim ldown:ldown = 0
	Dim rdown:rdown = 0

	Sub checkdown
		If ldown + rdown = 2 Then
			skipscene
		End If
	End Sub

	Sub skipscene

	End Sub



'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  UTILITY - Light Runs
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  

	dim arcbld:arcbld=1
	dim arcblu:arcblu=2
	dim arcbrd:arcbrd=3
	dim arcbru:arcbru=4
	dim arctld:arctld=5
	dim arctlu:arctlu=6
	dim arctrd:arctrd=7
	dim arctru:arctru=8
	dim circlein:circlein=9
	dim circleout:circleout=10
	dim clockleft:clockleft=11
	dim clockright:clockright=12
	dim diagdl:diagdl=13
	dim diagdr:diagdr=14
	dim diagul:diagul=15
	dim diagur:diagur=16
	dim udown:udown=17
	dim fanld:fanld=18
	dim fanlu:fanlu=19
	dim fanrd:fanrd=20
	dim fanru:fanru=21
	dim hatch1h:hatch1h=22
	dim hatch1v:hatch1v=23
	dim hatch2h:hatch2h=24
	dim hatch2v:hatch2v=25
	dim uleft:uleft=26
	dim middleih:middleih=27
	dim middleiv:middleiv=28
	dim middleoh:middleoh=29
	dim middleov:middleov=30
	dim radarl:radarl=31
	dim radarr:radarr=32
	dim randoms:randoms=33
	dim uright:uright=34
	dim screwl:screwl=35
	dim screwr:screwr=36
	dim stripe1h:stripe1h=37
	dim stripe1v:stripe1v=38
	dim stripe2h:stripe2h=39
	dim stripe2v:stripe2v=40
	dim uup:uup=41
	dim wiperl:wiperl=42
	dim wiperr:wiperr=43

	'***** LIGHT RUNS *****
	'(CHAOS)randoms
	'(DIRECTIONS)uup|udown|uleft|uright|diagdl|diagdr|diagul|diagur
	'(SWIPES)middleih|middleiv|middleoh|middleov|stripe1h|hatch1h|hatch1v|hatch2h|hatch2v|stripe1v|stripe2h|stripe2v
	'(SPINS)circlein|circleout|clockleft|clockright|screwl|screwr
	'(CURVES)arcbld|arcblu|arcbrd|arcbru|arctld|arctlu|arctrd|arctru|fanld|fanlu|fanrd|fanru|radarl|radarr|wiperl|wiperr
	'(EXAMPLE)lightrun red,arcbld,1  (SYNTAX)lightrun color,direction,times to run
	Sub lightrun(colorduring,direction,timenum)
		On Error Resume Next
		dim timefornext
		' color setting
		dim a
		for each a in aLights
			SetLightColor a, colorduring, -1
		next

		if spotstatus = 1 Then
			spotsoff
		end If
	
		if gistatus = 1 Then
			GiOff
		end if

		select case direction
			Case arcbld
				lrseq.UpdateInterval = 5
				timefornext = timenum*1000
				lrseq.Play SeqArcBottomLeftDownOn, 90,timenum,0
				lrseq.Play SeqArcBottomLeftDownOff, 90,timenum,0
			Case arcblu
				lrseq.UpdateInterval = 5
				timefornext = timenum*1000
				lrseq.Play SeqArcBottomLeftUpOn, 90,timenum,0
				lrseq.Play SeqArcBottomLeftUpOff, 90,timenum,0
			Case arcbrd
				lrseq.UpdateInterval = 5
				timefornext = timenum*1000
				lrseq.Play SeqArcBottomRightDownOn, 90,timenum,0
				lrseq.Play SeqArcBottomRightDownOff, 90,timenum,0
			Case arcbru
				lrseq.UpdateInterval = 5
				timefornext = timenum*1000
				lrseq.Play SeqArcBottomRightUpOn, 90,timenum,0
				lrseq.Play SeqArcBottomRightUpOff, 90,timenum,0
			Case arctld
				lrseq.UpdateInterval = 5
				timefornext = timenum*1000
				lrseq.Play SeqArcTopLeftDownOn, 90,timenum,0
				lrseq.Play SeqArcTopLeftDownOff, 90,timenum,0
			Case arctlu
				lrseq.UpdateInterval = 5
				timefornext = timenum*1000
				lrseq.Play SeqArcTopLeftUpOn, 90,timenum,0
				lrseq.Play SeqArcTopLeftUpOff, 90,timenum,0
			Case arctrd
				lrseq.UpdateInterval = 5
				timefornext = timenum*1000
				lrseq.Play SeqArcTopRightDownOn, 90,timenum,0
				lrseq.Play SeqArcTopRightDownOff, 90,timenum,0
			Case arctru
				lrseq.UpdateInterval = 5
				timefornext = timenum*1000
				lrseq.Play SeqArcTopRightUpOn, 90,timenum,0
				lrseq.Play SeqArcTopRightUpOff, 90,timenum,0
			Case circlein
				lrseq.UpdateInterval = 5
				timefornext = timenum*800
				lrseq.Play SeqCircleInOn,50,timenum,0
				lrseq.Play SeqCircleInOff,50,timenum,0
			Case circleout
				lrseq.UpdateInterval = 5
				timefornext = timenum*800
				lrseq.Play SeqCircleOutOn,50,timenum,0
				lrseq.Play SeqCircleOutOff,50,timenum,0
			Case clockleft
				lrseq.UpdateInterval = 2
				timefornext = timenum*800
				lrseq.Play SeqClockLeftOn, 45,timenum,0
				lrseq.Play SeqClockLeftOff, 45,timenum,0
			Case clockright
				lrseq.UpdateInterval = 2
				timefornext = timenum*800
				lrseq.Play SeqClockRightOn,45,timenum,0
				lrseq.Play SeqClockRightOff,45,timenum,0
			Case diagdl
				lrseq.UpdateInterval = 3
				timefornext = timenum*800
				lrseq.Play SeqDiagDownLeftOn, 25,timenum,0
				lrseq.Play SeqDiagDownLeftOff, 25,timenum,0
			Case diagdr
				lrseq.UpdateInterval = 3
				timefornext = timenum*800
				lrseq.Play SeqDiagDownRightOn, 25,timenum,0
				lrseq.Play SeqDiagDownRightOff, 25,timenum,0
			Case diagul
				lrseq.UpdateInterval = 3
				timefornext = timenum*800
				lrseq.Play SeqDiagUpLeftOn, 25,timenum,0
				lrseq.Play SeqDiagUpLeftOff, 25,timenum,0
			Case diagur
				lrseq.UpdateInterval = 3
				timefornext = timenum*800
				lrseq.Play SeqDiagUpRightOn, 25,timenum,0
				lrseq.Play SeqDiagUpRightOff, 25,timenum,0
			Case udown
				lrseq.UpdateInterval = 5
				timefornext = timenum*800
				lrseq.Play SeqDownOn, 15,timenum,0
				lrseq.Play SeqDownOff, 15,timenum,0
			Case fanld
				lrseq.UpdateInterval = 3
				timefornext = timenum*800
				lrseq.Play SeqFanLeftDownOn, 30,timenum,0
				lrseq.Play SeqFanLeftDownOff, 30,timenum,0
			Case fanlu
				lrseq.UpdateInterval = 3
				timefornext = timenum*800
				lrseq.Play SeqFanLeftUpOn, 30,timenum,0
				lrseq.Play SeqFanLeftUpOff, 30,timenum,0
			Case fanrd
				lrseq.UpdateInterval = 3
				timefornext = timenum*800
				lrseq.Play SeqFanRightDownOn, 30,timenum,0
				lrseq.Play SeqFanRightDownOff, 30,timenum,0
			Case fanru
				lrseq.UpdateInterval = 3
				timefornext = timenum*800
				lrseq.Play SeqFanRightUpOn, 30,timenum,0
				lrseq.Play SeqFanRightUpOff, 30,timenum,0
			Case hatch1h
				lrseq.UpdateInterval = 9
				timefornext = timenum*800
				lrseq.Play SeqHatch1HorizOn, 25,timenum,0
				lrseq.Play SeqHatch1HorizOff, 25,timenum,0
			Case hatch1v
				lrseq.UpdateInterval = 9
				timefornext = timenum*800
				lrseq.Play SeqHatch1VertOn, 75,timenum,0
				lrseq.Play SeqHatch1VertOff, 75,timenum,0
			Case hatch2h
				lrseq.UpdateInterval = 9
				timefornext = timenum*800
				lrseq.Play SeqHatch2HorizOn, 25,timenum,0
				lrseq.Play SeqHatch2HorizOff, 25,timenum,0
			Case hatch2v
				lrseq.UpdateInterval = 9
				timefornext = timenum*800
				lrseq.Play SeqHatch2VertOn, 75,timenum,0
				lrseq.Play SeqHatch2VertOff, 75,timenum,0
			Case uleft
				lrseq.UpdateInterval = 5
				timefornext = timenum*800
				lrseq.Play SeqLeftOn, 50,timenum,0
				lrseq.Play SeqLeftOff, 50,timenum,0
			Case middleih
				lrseq.UpdateInterval = 12
				timefornext = timenum*700
				lrseq.Play SeqMiddleInHorizOn, 50,timenum,0
				lrseq.Play SeqMiddleInHorizOff, 50,timenum,0
			Case middleiv
				lrseq.UpdateInterval = 12
				timefornext = timenum*700
				lrseq.Play SeqMiddleInVertOn, 50,timenum,0
				lrseq.Play SeqMiddleInVertOff, 50,timenum,0
			Case middleoh
				lrseq.UpdateInterval = 12
				timefornext = timenum*700
				lrseq.Play SeqMiddleOutHorizOn, 50,timenum,0
				lrseq.Play SeqMiddleOutHorizOff, 50,timenum,0
			Case middleov
				lrseq.UpdateInterval = 12
				timefornext = timenum*700
				lrseq.Play SeqMiddleOutVertOn, 50,timenum,0
				lrseq.Play SeqMiddleOutVertOff, 50,timenum,0
			Case radarl
				lrseq.UpdateInterval = 4
				timefornext = timenum*700
				lrseq.Play SeqRadarLeftOn, 45,timenum,0
				lrseq.Play SeqRadarLeftOff, 45,timenum,0
			Case radarr
				lrseq.UpdateInterval = 4
				timefornext = timenum*700
				lrseq.Play SeqRadarRightOn, 45,timenum,0
				lrseq.Play SeqRadarRightOff, 45,timenum,0
			Case randoms
				lrseq.UpdateInterval = 5
				timefornext = timenum*1000
				lrseq.Play SeqRandom,40,,timefornext
			Case uright
				lrseq.UpdateInterval = 5
				timefornext = timenum*800
				lrseq.Play SeqRightOn, 50,timenum,0
				lrseq.Play SeqRightOff, 50,timenum,0
			Case screwl
				lrseq.UpdateInterval = 2
				timefornext = timenum*500
				lrseq.Play SeqScrewLeftOn, 25,timenum,0
				lrseq.Play SeqScrewLeftOff, 25,timenum,0
			Case screwr
				lrseq.UpdateInterval = 2
				timefornext = timenum*500
				lrseq.Play SeqScrewRightOn, 25,timenum,0
				lrseq.Play SeqScrewRightOff, 25,timenum,0
			Case stripe1h
				lrseq.UpdateInterval = 5
				timefornext = timenum*900
				lrseq.Play SeqStripe1HorizOn, 25,timenum,0
				lrseq.Play SeqStripe1HorizOff, 25,timenum,0
			Case stripe1v
				lrseq.UpdateInterval = 5
				timefornext = timenum*900
				lrseq.Play SeqStripe1VertOn, 50,timenum,0
				lrseq.Play SeqStripe1VertOff, 50,timenum,0
			Case stripe2h
				lrseq.UpdateInterval = 5
				timefornext = timenum*900
				lrseq.Play SeqStripe2HorizOn, 25,timenum,0
				lrseq.Play SeqStripe2HorizOff, 25,timenum,0
			Case stripe2v
				lrseq.UpdateInterval = 5
				timefornext = timenum*900
				lrseq.Play SeqStripe2VertOn, 25,timenum,0
				lrseq.Play SeqStripe2VertOff, 25,timenum,0
			Case uup
				lrseq.UpdateInterval = 5
				timefornext = timenum*800
				lrseq.Play SeqUpOn, 15,timenum,0
				lrseq.Play SeqUpOff, 15,timenum,0
			Case wiperl
				lrseq.UpdateInterval = 5
				timefornext = timenum*900
				lrseq.Play SeqWiperLeftOn, 45,timenum,0
				lrseq.Play SeqWiperLeftOff, 45,timenum,0
			Case wiperr
				lrseq.UpdateInterval = 5
				timefornext = timenum*900
				lrseq.Play SeqWiperRightOn, 45,timenum,0
				lrseq.Play SeqWiperRightOff, 45,timenum,0
		end Select


		runninglights = 1
		vpmtimer.addtimer timefornext, "nolongerrun '"

	end Sub

	Sub nolongerrun
		if spotstatus = 0 Then
			spotson
		end If
	
		if gistatus = 0 Then
			GiOn
		end if
		runninglights = 0
		lrseq.StopPlay
		if bMultiBallMode = 0 and inamode = 0 Then
			relighttable
		end if 
	end Sub




'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  Orbital Scoreboard Code
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X 
	

	'****************************
	' POST SCORES
	'****************************
	Dim osbtemp:osbtemp = osbdefinit
	Dim osbtempscore:osbtempscore = 0
	Sub SubmitOSBScore
		pupDMDDisplay "-","Uploading Your^Score to OSB",dmdnote,3,0,10
		On Error Resume Next
		if osbactive = 1 or osbactive = 2 Then
		Dim objXmlHttpMain, Url, strJSONToSend 

		Url = "https://hook.integromat.com/82bu988v9grj31vxjklh2e4s6h97rnu0"

		strJSONToSend = "{""auth"":""" & osbkey &""",""player id"": """ & osbid & """,""player initials"": """ & osbtemp &""",""score"": " & CStr(osbtempscore) & ",""table"":"""& TableName & """,""version"":""" & myVersion & """}"

		Set objXmlHttpMain = CreateObject("Msxml2.ServerXMLHTTP")
		objXmlHttpMain.open "PUT",Url, False
		objXmlHttpMain.setRequestHeader "Content-Type", "application/json"
		objXmlHttpMain.setRequestHeader "application", "application/json"

		objXmlHttpMain.send strJSONToSend
		end if
	End Sub	



	'****************************
	' GET SCORES
	'****************************
	dim worldscores

	Sub GetScores()
		if osbkey="" then exit sub
		On Error Resume Next
		Dim objXmlHttpMain, Url, strJSONToSend 

		Url = "https://hook.integromat.com/97fgba49iff2ucr2lqy72om9j0cha2wj"

		strJSONToSend = "{""auth"":"""& osbkey &""", ""table"":"""& TableName & """, ""range"":""combo"", ""format"":""csv"", ""number"":""10""}"

		Set objXmlHttpMain = CreateObject("Msxml2.ServerXMLHTTP")
		objXmlHttpMain.open "PUT",Url, False
		objXmlHttpMain.setRequestHeader "Content-Type", "application/json"
		objXmlHttpMain.setRequestHeader "application", "application/json"

		objXmlHttpMain.send strJSONToSend

		worldscores = objXmlHttpMain.responseText
		vpmtimer.addtimer 3000, "showsuccess '"
		debug.print "got the scores"
		splitscores
	End Sub	

	Dim scorevar(40)
	sub emptyscores
		dim i
		For i = 0 to 40
			scorevar(i) = 0
		Next
	End Sub
	emptyscores

	Sub splitscores
		On Error Resume Next
		dim a,x
		a = Split(worldscores,",")
		Dim myNum:myNum = 0
		for each x in a
			myNum = MyNum + 1
			scorevar(MyNum) = x
			'debug.print x
		Next
	end Sub

	sub showsuccess
		pNote "Scoreboard","Updated"
		'pupDMDDisplay "-","Scoreboard^Updated",dmdnote,3,0,10
	end sub

	GetScores





'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXX 3d motion junk XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXX not much need to go down here XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

		flamespinner.enabled = 0
	sub flamestarter_hit
		DOF 130, DOFPulse 'Fan - Goblet Fire
		if nofunmode = 0 Then
		flameson
		end if
	end Sub

	sub flameson
		flamecircle.visible = 1
		flamespinner.enabled = 1
	end Sub
	
	sub flamespinner_timer
		flamecircle.objrotz = flamecircle.objrotz + 40
	end Sub

	sub flamesoff
		if nofunmode = 0 Then
		flamecircle.visible = 0
		flamespinner.enabled = 0
		end if
	end Sub


'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  MADEYE
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 
	Dim eyewiggle:eyewiggle=0
	Dim eyepos:eyepos=6
	Dim currenteyepos:currenteyepos=6


	' smooth eyeball mod

	DIM eyeMoveToX : eyeMoveToX=0
	DIM eyeMoveToY : eyeMoveToY=0
	Dim eyeCurX    : eyeCurX=0 
	Dim eyeCurY    : eyeCurY=0 
	Dim eyeMoving  : eyeMoving=false
	Dim curBallX   : curBallX=0
	Dim curBallY   : curBallY=0


	Function GetEyeAngle()
	 ' Given y and x coords returns atan2
	 ' by Jim Deutch, Syracuse, New York
	 Dim ys
	 Dim xs
	 Dim theta, pi

	 xs=eyeballmod.x-curBallx
	 ys=eyeballmod.y-curBally
	 pi = 3.1415926535897932384626433832795
		If xs <> 0 Then
			theta = Atn(ys / xs)
			If xs < 0 Then
				theta = theta + pi
			End If
		Else
			If ys < 0 Then
				theta = 3 * pi / 2 '90
			Else
				theta = pi / 2 '270
			End If
		End If
	 GetEyeAngle = theta * 180 / pi
	 if GetEyeAngle<0 then GetEyeAngle=360+GetEyeAngle
	End Function

	Sub checkeyeball
    DIM xmov
    DIM ymov
    DIM cAngle
		If (bMultiBallMode = true) then exit sub
        if (eyespin>0) then exit Sub
        cAngle=GetEyeAngle  * 3.141592 / 180  

        xmov=sin(cAngle) * 50.00       
        ymov=cos(cAngle) * -50.00
        
        if xmov>40 then xmov=40

    	eyeMoveToX =  round(xmov)
		eyeMoveToY =  round(ymov)

        eyeCurX=eyeballmod.objrotx
        eyeCurY=eyeballmod.objroty

         if (eyeCurX<>eyeMoveToX) OR (eyeCurY<>eyeMoveToY) Then 
            eyeMoving=true
            if spinningeye.interval<>eyeFollowS  Then spinningeye.interval=eyeFollowS
            spinningeye.enabled=1
         end if
	end Sub

	spinningeye.enabled = 0
	dim eyespin:eyespin = 0


	sub spinningeye_timer
     Dim mAmount     
       if (eyeMoving) and (eyespin=0) Then
          if (eyeCurX>eyeMoveToX) Then
              eyeballmod.objrotx=eyeballmod.objrotx-1
              eyeCurx=eyeCurx-1              
          elseif (eyeCurX<eyeMoveToX) Then  
              eyeballmod.objrotx=eyeballmod.objrotx+1
              eyeCurX=eyeCurX+1               
          end if
          if (eyeCurY>eyeMoveToY) Then
              eyeballmod.objroty=eyeballmod.objroty-1
              eyeCurY=eyeCurY-1               
          elseif (eyeCurY<eyeMoveToY) Then  
              eyeballmod.objroty=eyeballmod.objroty+1
              eyeCurY=eyeCurY+1              
          end if
          if (eyeCurX=eyeMoveToX) AND (eyeCurY=eyeMoveToY) Then 
            eyeMoving=false
            spinningeye.enabled=0
            'spinningeye.interval= 1  'return to normal 
         end if
          
       Else 'if not moving eye to position
        if spinningeye.interval<>1  Then spinningeye.interval=1   
		eyewiggle = 1
		eyespin = eyespin + 1
		eyeballmod.objrotx = eyeballmod.objrotx  + 1
		eyeballmod.objroty = eyeballmod.objroty - 1
		if eyeSpin>1500 Then                				
				eyewiggle = 0
				eyespin = 0
                eyemoving=false
                currenteyepos=-1
                eyepos=1
                eyeballmod.objrotx=eyeCurX
                eyeballmod.objroty=eyeCurY
                eyeMoveToX=eyeCurX  
                eyeMoveToY=eyeCurY  
                curBallx=0
                curBally=0
				spinningeye.enabled = 0
				checkeyeball

		End if
      End if
	End Sub








'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  Death eater popups
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 
	droppops

	sub droppops
		PlaySoundAt SoundFXDOF("fx_TrollDown",118,DOFPulse,DOFContactors), popl
		PlaySoundAt SoundFXDOF("fx_TrollDown",119,DOFPulse,DOFContactors), popr
		mask1.z = -170
		mask11.z = -170
		mask111.z = -170
		mask1111.z = -170
		mask1.collidable = false
		mask11.collidable = false
		mask111.collidable = false
		mask1111.collidable = false
		mask2.z = -170
		mask3.z = -170
		mask4.z = -170
		mask5.z = -170
		mask2.collidable = false
		mask3.collidable = false
		mask4.collidable = false
		mask5.collidable = false
		popl.z = -115
		popl.collidable = false
		popr.z = -115
		popr.collidable = false
	end sub

	sub popdeath
		mask1.z = 0
		mask11.z = 0
		mask111.z = 0
		mask1111.z = 0
		mask1.collidable = true
		mask11.collidable = true
		mask111.collidable = true
		mask1111.collidable = true
		PlaySoundAt SoundFXDOF("fx_TrollUp",118,DOFPulse,DOFContactors), popl
		deup
		popl.z = -23
		popl.collidable = true
		vpmtimer.addtimer 800, "popsecond '"
	end Sub

	dim desnd:desnd = 0
	sub deup
		desnd=desnd+1
		select case desnd
		case 1
			PlaySoundAt "de1", popl	
		case 2
			PlaySoundAt "de2", popl	
		case 3
			PlaySoundAt "de3", popl
			desnd=0
		end select
	end Sub

	sub popleft
		mask1.z = 0
		mask11.z = 0
		mask111.z = 0
		mask1111.z = 0
		mask1.collidable = true
		mask11.collidable = true
		mask111.collidable = true
		mask1111.collidable = true
		PlaySoundAt SoundFXDOF("fx_TrollUp",118,DOFPulse,DOFContactors), popl
		deup
		popl.z = -23
		popl.collidable = true
		t38.state = 2
	end Sub

	sub popright
		mask2.z = 0
		mask3.z = 0
		mask4.z = 0
		mask5.z = 0
		mask2.collidable = true
		mask3.collidable = true
		mask4.collidable = true
		mask5.collidable = true
		PlaySoundAt SoundFXDOF("fx_TrollUp",119,DOFPulse,DOFContactors), popr
		deup
		popr.z = -23
		popr.collidable = true
		t39.state = 2
	end sub

	sub popsecond
		mask2.z = 0
		mask3.z = 0
		mask4.z = 0
		mask5.z = 0
		mask2.collidable = true
		mask3.collidable = true
		mask4.collidable = true
		mask5.collidable = true
		PlaySoundAt SoundFXDOF("fx_TrollUp",119,DOFPulse,DOFContactors), popr
		deup
		popr.z = -23
		popr.collidable = true
	end sub

	Sub mask1_hit
		dropml
	End Sub

	Sub mask11_hit
		dropml
	End Sub

	Sub mask111_hit
		dropml
	End Sub

	Sub mask1111_hit
		dropml
	End Sub

	sub dropml
		addscore 50000
		PlaySoundAt SoundFXDOF("fx_TrollDown",118,DOFPulse,DOFContactors), popl
		PlaySoundAt "frankhit", popl
		dehit
		popl.z = -115
		popl.collidable = false
		mask1.z = -170
		mask11.z = -170
		mask111.z = -170
		mask1111.z = -170
		mask1.collidable = false
		mask11.collidable = false
		mask111.collidable = false
		mask1111.collidable = false
		t38.state = 0
		if indeath = 1 Then
			deathjp
		end If
	end Sub

	sub clearmasks
		popl.z = -115
		popl.collidable = false
		mask1.z = -170
		mask11.z = -170
		mask111.z = -170
		mask1111.z = -170
		mask1.collidable = false
		mask11.collidable = false
		mask111.collidable = false
		mask1111.collidable = false
		t38.state = 0
		mask2.z = -170
		mask3.z = -170
		mask4.z = -170
		mask5.z = -170
		mask2.collidable = false
		mask3.collidable = false
		mask4.collidable = false
		mask5.collidable = false
		popr.z = -115
		popr.collidable = false
		t39.state = 0
	end sub

	Sub mask5_hit
		dropmr
	End Sub
	Sub mask2_hit
		dropmr
	End Sub
	Sub mask3_hit
		dropmr
	End Sub
	Sub mask4_hit
		dropmr
	End Sub

	Sub dropmr
		addscore 50000
		PlaySoundAt SoundFXDOF("fx_TrollDown",119,DOFPulse,DOFContactors), popr
		PlaySoundAt "frankhit", popr
		dehit
		mask2.z = -170
		mask3.z = -170
		mask4.z = -170
		mask5.z = -170
		mask2.collidable = false
		mask3.collidable = false
		mask4.collidable = false
		mask5.collidable = false
		popr.z = -115
		popr.collidable = false
		t39.state = 0
		if indeath = 1 Then
			deathjp
		end If
	end Sub

	dim desndd:desndd = 0
	sub dehit
		deshit(CurrentPlayer) = deshit(CurrentPlayer) + 1
		desndd=desndd+1
		select case desndd
		case 1
			PlaySoundAt "dehit1", popl	
		case 2
			PlaySoundAt "dehit2", popl	
		case 3
			PlaySoundAt "dehit3", popl
			desndd=0
		end select
	end Sub




'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  Harry on launch lane
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 

	sub broom1_hit
'		harrybroom.transy = 0
		launchlight.state = 0
	end Sub

	dim broomdone:broomdone = 0
'	sub broom24_hit
		'harrybroom.transy = 1150
'		broomdone = 1
'		hbreturn.enabled = 1
'	end Sub

	hbreturn.enabled = 1
	sub hbreturn_timer
		If harrybroom.Y >= 1890 Then
			hbreturn.enabled = 0
		Else
			harrybroom.Y = harrybroom.Y + 1.5
		End If
	End sub




'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'  flying horntail
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
'/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/ \/
'\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\ /\
' X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  X  
' 

	Sub dragonaction
		if nofunmode = 1 then exit Sub
		if dragonmod = 0 then exit Sub
		fireball.enabled = True
		flyingdragon.enabled = True
		vpmtimer.addtimer 2000, "dragonend '"
	end Sub

	sub dragonend
		flyingdragon.enabled = False
		rightwing.roty = 0
		leftwing.roty = 0
	end Sub


	dim wingup:wingup = 0
	sub flyingdragon_timer
		if rightwing.roty = -10 Then
			wingup = 1
		end If
		if rightwing.roty = 10 Then
			wingup = 0
		end If
		if wingup = 0 Then
			rightwing.roty = rightwing.roty - 1
			'rightwing.z = rightwing.z + .4
			leftwing.roty = leftwing.roty + 1
			'leftwing.z = leftwing.z - .4
			'dragonbody.rotz = dragonbody.rotz + .1
			'dragonbody.rotx = dragonbody.rotx + .1
			'dragonbody.z = dragonbody.z - .2

		end If
		if wingup = 1 Then
			rightwing.roty = rightwing.roty + 1
			'rightwing.z = rightwing.z - .4
			leftwing.roty = leftwing.roty - 1
			'leftwing.z = leftwing.z + .4
			'dragonbody.rotz = dragonbody.rotz - .1
			'dragonbody.rotx = dragonbody.rotx - .1
			'dragonbody.z = dragonbody.z + .2

		end If			
	end Sub

		flames1.opacity = 0
		flames2.opacity = 0
		flames3.opacity = 0
		flames4.opacity = 0
		flames5.opacity = 0

	dim firepos:firepos = 0
	sub fireball_timer
		flames1.opacity = 0
		flames2.opacity = 0
		flames3.opacity = 0
		flames4.opacity = 0
		flames5.opacity = 0
		firepos = firepos + 1
		select case firepos
			case 1 : flames1.opacity = 1000
			case 2 : flames2.opacity = 1000
			case 3 : flames3.opacity = 1000
			case 4 : flames4.opacity = 1000
			case 5 : flames5.opacity = 1000
			case 6 : flames5.opacity = 0 : firepos = 0 : fireball.enabled = false
		end Select
	end Sub





Sub Table1_Exit()
	
End Sub


'****** DOF Extra Stuff ******

Sub GI_On_DOF_Undercab
	'GI_Off_DOF_Undercab
	If inquid = 1 then DOF 500, DOFOn 'Red Undercab
	If ingob = 1 then DOF 506, DOFOn 'Blue Undercab
	If incurses = 1 then DOF 503, DOFOn 'Orange Undercab
	If indeath = 1 then DOF 504, DOFOn 'Green Undercab
	If inamode = 0 then	DOF 507, DOFOn 'White Undercab
End Sub

Sub GI_Off_DOF_Undercab
	DOF 500, DOFOff 'Red Undercab
	DOF 501, DOFOff 'Yellow Undercab
	DOF 502, DOFOff 'Purple Undercab
	DOF 503, DOFOff 'Orange Undercab
	DOF 504, DOFOff 'Green Undercab
	DOF 505, DOFOff 'Cyan Undercab
	DOF 506, DOFOff 'Blue Undercab
	DOF 507, DOFOff 'White Undercab
End Sub






'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'********************* START OF PUPDMD FRAMEWORK v1.0 *************************XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'******************** DO NOT MODIFY STUFF BELOW   THIS LINE!!!! ***************XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'******************************************************************************XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'*****   Create a PUPPack within PUPPackEditor for layout config!!!  **********XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'******************************************************************************XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
	'
	'
	'  Quick Steps:
	'      1>  create a folder in PUPVideos with Starter_PuPPack.zip and call the folder "yourgame"
	'      2>  above set global variable pGameName="yourgame"
	'      3>  copy paste the settings section above to top of table script for user changes.
	'      4>  on Table you need to create ONE timer only called pupDMDUpdate and set it to 250 ms enabled on startup.
	'      5>  go to your table1_init or table first startup function and call PUPINIT function
	'      6>  Go to bottom on framework here and setup game to call the appropriate events like pStartGame (call that in your game code where needed)...etc
	'      7>  attractmodenext at bottom is setup for you already,  just go to each case and add/remove as many as you want and setup the messages to show.  
	'      8>  Have fun and use pDMDDisplay(xxxx)  sub all over where needed.  remember its best to make a bunch of mp4 with text animations... looks the best for sure!
	'
	'
	'Note:  for *Future Pinball* "pupDMDupdate_Timer()" timer needs to be renamed to "pupDMDupdate_expired()"  and then all is good.
	'       and for future pinball you need to add the follow lines near top
	'Need to use BAM and have com idll enabled.
	'				Dim icom : Set icom = xBAM.Get("icom") ' "icom" is name of "icom.dll" in BAM\Plugins dir
	'				if icom is Nothing then MSGBOX "Error cannot run without icom.dll plugin"
	'				Function CreateObject(className)       
	'   					Set CreateObject = icom.CreateObject(className)   
	'				End Function


	'Const HasDMD = True   'dont set to false as it will break pup

	'Const Default pupscreens
	'Const pTopper=0
	'Const pDMD=1
	'Const pBackglass=2
	'Const pPlayfield=3
	'Const pMusic=4
	'Const pMusic2=5
	'Const pCallouts=6
	'Const pBackglass2=7
	'Const pTopper2=8
	'Const pPopUP=9
	'Const pPopUP2=10


	'pages
	Const pDMDBlank=0
	Const pScores=1
	Const pBigLine=2
	Const pThreeLines=3
	Const pTwoLines=4
	Const pTargerLetters=5

	'dmdType
	Const pDMDTypeLCD=0
	Const pDMDTypeReal=1
	Const pDMDTypeFULL=2






	dim PUPDMDObject  'for realtime mirroring.
	Dim pDMDlastchk: pDMDLastchk= -1    'performance of updates
	Dim pDMDCurPage: pDMDCurPage= 0     'default page is empty.
	Dim pInAttract : pInAttract=false   'pAttract mode




	'*************  starts PUP system,  must be called AFTER b2s/controller running so put in last line of table1_init
	Sub PuPInit

	'Set PuPlayer = CreateObject("PinUpPlayer.PinDisplay")   
	'PuPlayer.B2SInit "", pGameName

	if (PuPDMDDriverType=pDMDTypeReal) and (useRealDMDScale=1) Then 
		   PuPlayer.setScreenEx pDMD,0,0,128,32,0  'if hardware set the dmd to 128,32
	End if

	PuPlayer.LabelInit pDMD


	if PuPDMDDriverType=pDMDTypeReal then
	Set PUPDMDObject = CreateObject("PUPDMDControl.DMD") 
	PUPDMDObject.DMDOpen
	PUPDMDObject.DMDPuPMirror
	PUPDMDObject.DMDPuPTextMirror
	PuPlayer.SendMSG "{ ""mt"":301, ""SN"": 1, ""FN"":33 }"             'set pupdmd for mirror and hide behind other pups
	PuPlayer.SendMSG "{ ""mt"":301, ""SN"": 1, ""FN"":32, ""FQ"":3 }"   'set no antialias on font render if real
	END IF


	pSetPageLayouts

	pDMDSetPage(pDMDBlank)   'set blank text overlay page.
	pDMDStartUP    ' firsttime running for like an startup video...

	End Sub 'end PUPINIT



	'PinUP Player DMD Helper Functions

	Sub pDMDLabelHide(labName)
	PuPlayer.LabelSet pDMD,labName,"",0,""   
	end sub




	Sub pDMDScrollBig(msgText,timeSec,mColor)
	PuPlayer.LabelShowPage pDMD,2,timeSec,""
	PuPlayer.LabelSet pDMD,"Splash",msgText,0,"{'mt':1,'at':2,'xps':1,'xpe':-1,'len':" & (timeSec*1000000) & ",'mlen':" & (timeSec*1000) & ",'tt':0,'fc':" & mColor & "}"
	end sub

	Sub pDMDScrollBigV(msgText,timeSec,mColor)
	PuPlayer.LabelShowPage pDMD,2,timeSec,""
	PuPlayer.LabelSet pDMD,"Splash",msgText,0,"{'mt':1,'at':2,'yps':1,'ype':-1,'len':" & (timeSec*1000000) & ",'mlen':" & (timeSec*1000) & ",'tt':0,'fc':" & mColor & "}"
	end sub


	Sub pDMDSplashScore(msgText,timeSec,mColor)
	PuPlayer.LabelSet pDMD,"MsgScore",msgText,0,"{'mt':1,'at':1,'fq':250,'len':"& (timeSec*1000) &",'fc':" & mColor & "}"
	end Sub

	Sub pDMDSplashScoreScroll(msgText,timeSec,mColor)
	PuPlayer.LabelSet pDMD,"MsgScore",msgText,0,"{'mt':1,'at':2,'xps':1,'xpe':-1,'len':"& (timeSec*1000) &", 'mlen':"& (timeSec*1000) &",'tt':0, 'fc':" & mColor & "}"
	end Sub

	Sub pDMDZoomBig(msgText,timeSec,mColor)  'new Zoom
	PuPlayer.LabelShowPage pDMD,2,timeSec,""
	PuPlayer.LabelSet pDMD,"Splash",msgText,0,"{'mt':1,'at':3,'hstart':5,'hend':80,'len':" & (timeSec*1000) & ",'mlen':" & (timeSec*500) & ",'tt':5,'fc':" & mColor & "}"
	end sub

	Sub pDMDTargetLettersInfo(msgText,msgInfo, timeSec)  'msgInfo = '0211'  0= layer 1, 1=layer 2, 2=top layer3.
	'this function is when you want to hilite spelled words.  Like B O N U S but have O S hilited as already hit markers... see example.
	PuPlayer.LabelShowPage pDMD,5,timeSec,""  'show page 5
	Dim backText
	Dim middleText
	Dim flashText
	Dim curChar
	Dim i
	Dim offchars:offchars=0
	Dim spaces:spaces=" "  'set this to 1 or more depends on font space width.  only works with certain fonts
							  'if using a fixed font width then set spaces to just one space.

	For i=1 To Len(msgInfo)
		curChar="" & Mid(msgInfo,i,1)
		if curChar="0" Then
				backText=backText & Mid(msgText,i,1)
				middleText=middleText & spaces
				flashText=flashText & spaces          
				offchars=offchars+1
		End If
		if curChar="1" Then
				backText=backText & spaces
				middleText=middleText & Mid(msgText,i,1)
				flashText=flashText & spaces
		End If
		if curChar="2" Then
				backText=backText & spaces
				middleText=middleText & spaces
				flashText=flashText & Mid(msgText,i,1)
		End If   
	Next 

	if offchars=0 Then 'all litup!... flash entire string
	   backText=""
	   middleText=""
	   FlashText=msgText
	end if  

	PuPlayer.LabelSet pDMD,"Back5"  ,backText  ,1,""
	PuPlayer.LabelSet pDMD,"Middle5",middleText,1,""
	PuPlayer.LabelSet pDMD,"Flash5" ,flashText ,0,"{'mt':1,'at':1,'fq':150,'len':" & (timeSec*1000) & "}"   
	end Sub


	Sub pDMDSetPage(pagenum)    
		PuPlayer.LabelShowPage pDMD,pagenum,0,""   'set page to blank 0 page if want off
		PDMDCurPage=pagenum
	end Sub

	Sub pHideOverlayText(pDisp)
		PuPlayer.SendMSG "{ ""mt"":301, ""SN"": "& pDisp &", ""FN"": 34 }"             'hideoverlay text during next videoplay on DMD auto return
	end Sub



	Sub pDMDShowLines3(msgText,msgText2,msgText3,timeSec)
	Dim vis:vis=1
	if pLine1Ani<>"" Then vis=0
	PuPlayer.LabelShowPage pDMD,3,timeSec,""
	PuPlayer.LabelSet pDMD,"Splash3a",msgText,vis,pLine1Ani
	PuPlayer.LabelSet pDMD,"Splash3b",msgText2,vis,pLine2Ani
	PuPlayer.LabelSet pDMD,"Splash3c",msgText3,vis,pLine3Ani
	end Sub

	dim msg1
	dim msg2

	Sub pDMDShowLines2(msgText,msgText2,timeSec)
	Dim vis:vis=1
	'msg1=msgText
	'msg2=msgText2
	if pLine1Ani<>"" Then vis=0
	PuPlayer.LabelShowPage pDMD,4,timeSec,""
	'vpmtimer.addtimer 500, "showtext '"
	'dim endtime:endtime=(timesec*1000)-400
	'vpmtimer.addtimer endtime, "hidetext '"
	PuPlayer.LabelSet pDMD,"Splash4a",msgText,vis,pLine1Ani
	PuPlayer.LabelSet pDMD,"Splash4b",msgText2,vis,pLine2Ani
	end Sub

	'need to make a timer and add and remove to it instead of showtext and hide text

	sub showtext
		PuPlayer.LabelSet pDMD,"Splash4a",msg1,1,0
		PuPlayer.LabelSet pDMD,"Splash4b",msg2,1,0
	end Sub

	sub hidetext
		PuPlayer.LabelSet pDMD,"Splash4a","",1,0
		PuPlayer.LabelSet pDMD,"Splash4b","",1,0
	end Sub

	Sub pDMDShowCounter(msgText,msgText2,msgText3,timeSec)
	Dim vis:vis=1
	if pLine1Ani<>"" Then vis=0
	PuPlayer.LabelShowPage pDMD,6,timeSec,""
	PuPlayer.LabelSet pDMD,"Splash6a",msgText,vis, pLine1Ani
	PuPlayer.LabelSet pDMD,"Splash6b",msgText2,vis,pLine2Ani
	PuPlayer.LabelSet pDMD,"Splash6c",msgText3,vis,pLine3Ani
	end Sub


	Sub pDMDShowBig(msgText,timeSec, mColor)
	Dim vis:vis=1
	if pLine1Ani<>"" Then vis=0
	PuPlayer.LabelShowPage pDMD,2,timeSec,""
	PuPlayer.LabelSet pDMD,"Splash",msgText,vis,pLine1Ani
	end sub


	Sub pDMDShowHS(msgText,msgText2,msgText3,timeSec) 'High Score
	Dim vis:vis=1
	if pLine1Ani<>"" Then vis=0
	PuPlayer.LabelShowPage pDMD,7,timeSec,""
	PuPlayer.LabelSet pDMD,"Splash7a",msgText,vis,pLine1Ani
	PuPlayer.LabelSet pDMD,"Splash7b",msgText2,vis,pLine2Ani
	PuPlayer.LabelSet pDMD,"Splash7c",msgText3,vis,pLine3Ani
	end Sub


	Sub pDMDSetBackFrame(fname)
	  PuPlayer.playlistplayex pDMD,"PUPFrames",fname,0,1    
	end Sub

	Sub pDMDStartBackLoop(fPlayList,fname)
	  PuPlayer.playlistplayex pDMD,fPlayList,fname,0,1
	  PuPlayer.SetBackGround pDMD,1
	end Sub

	Sub pDMDStopBackLoop
	  PuPlayer.SetBackGround pDMD,0
	  PuPlayer.playstop pDMD
	end Sub


	Dim pNumLines

	'Theme Colors for Text (not used currenlty,  use the |<colornum> in text labels for colouring.
	Dim SpecialInfo
	Dim pLine1Color : pLine1Color=8454143  
	Dim pLine2Color : pLine2Color=8454143
	Dim pLine3Color :  pLine3Color=8454143
	Dim curLine1Color: curLine1Color=pLine1Color  'can change later
	Dim curLine2Color: curLine2Color=pLine2Color  'can change later
	Dim curLine3Color: curLine3Color=pLine3Color  'can change later


	Dim pDMDCurPriority: pDMDCurPriority =-1
	Dim pDMDDefVolume: pDMDDefVolume = 0   'default no audio on pDMD

	Dim pLine1
	Dim pLine2
	Dim pLine3
	Dim pLine1Ani
	Dim pLine2Ani
	Dim pLine3Ani

	Dim PriorityReset:PriorityReset=-1
	DIM pAttractReset:pAttractReset=-1
	DIM pAttractBetween: pAttractBetween=2000 '1 second between calls to next attract page
	DIM pDMDVideoPlaying: pDMDVideoPlaying=false


	'************************ where all the MAGIC goes,  pretty much call this everywhere  ****************************************
	'*************************                see docs for examples                ************************************************
	'****************************************   DONT TOUCH THIS CODE   ************************************************************
	
	Sub pupDMDDisplay(pEventID, pText, VideoName,TimeSec, pAni,pPriority)
	' pEventID = reference if application,  
	' pText = "text to show" separate lines by ^ in same string
	' VideoName "gameover.mp4" will play in background  "@gameover.mp4" will play and disable text during gameplay.
	' also global variable useDMDVideos=true/false if user wishes only TEXT
	' TimeSec how long to display msg in Seconds
	' animation if any 0=none 1=Flasher
	' also,  now can specify color of each line (when no animation).  "sometext|12345"  will set label to "sometext" and set color to 12345

	pAni = 0
	
	DIM curPos
	if pDMDCurPriority>=pPriority then Exit Sub  'if something is being displayed that we don't want interrupted.  same level will interrupt.
	pDMDCurPriority=pPriority
	if timeSec=0 then timeSec=1 'don't allow page default page by accident


	pLine1=""
	pLine2=""
	pLine3=""
	pLine1Ani=""
	pLine2Ani=""
	pLine3Ani=""


	if pAni=1 Then  'we flashy now aren't we
	pLine1Ani="{'mt':1,'at':1,'fq':150,'len':" & (timeSec*1000) &  "}"  
	pLine2Ani="{'mt':1,'at':1,'fq':150,'len':" & (timeSec*1000) &  "}"  
	pLine3Ani="{'mt':1,'at':1,'fq':150,'len':" & (timeSec*1000) &  "}"  
	end If

	curPos=InStr(pText,"^")   'Lets break apart the string if needed
	if curPos>0 Then 
	   pLine1=Left(pText,curPos-1) 
	   pText=Right(pText,Len(pText) - curPos)
	   
	   curPos=InStr(pText,"^")   'Lets break apart the string
	   if curPOS>0 Then
		  pLine2=Left(pText,curPos-1) 
		  pText=Right(pText,Len(pText) - curPos)

		  curPos=InStr("^",pText)   'Lets break apart the string   
		  if curPos>0 Then
			 pline3=Left(pText,curPos-1) 
		  Else 
			if pText<>"" Then pline3=pText 
		  End if 
	   Else 
		  if pText<>"" Then pLine2=pText
	   End if    
	Else 
	  pLine1=pText  'just one line with no break 
	End if


	'lets see how many lines to Show
	pNumLines=0
	if pLine1<>"" then pNumLines=pNumlines+1
	if pLine2<>"" then pNumLines=pNumlines+1
	if pLine3<>"" then pNumLines=pNumlines+1

	if pDMDVideoPlaying and (VideoName="") Then 
				PuPlayer.playstop pDMD
				pDMDVideoPlaying=False
	End if


	if (VideoName<>"") and (useDMDVideos) Then  'we are showing a splash video instead of the text.
		
		PuPlayer.playlistplayex pDMD,"DMDSplash",VideoName,pDMDDefVolume,pPriority  'should be an attract background (no text is displayed)
		pDMDVideoPlaying=true
	end if 'if showing a splash video with no text

	if StrComp(pEventID,"shownum",1)=0 Then              'check eventIDs
		pDMDShowCounter pLine1,pLine2,pLine3,timeSec
	Elseif StrComp(pEventID,"target",1)=0 Then              'check eventIDs
		pDMDTargetLettersInfo pLine1,pLine2,timeSec
	Elseif StrComp(pEventID,"highscore",1)=0 Then              'check eventIDs
		pDMDShowHS pLine1,pLine2,pline3,timeSec
	Elseif (pNumLines=3) Then                'depends on # of lines which one to use.  pAni=1 will flash.
		pDMDShowLines3 pLine1,pLine2,pLine3,TimeSec
	Elseif (pNumLines=2) Then
		pDMDShowLines2 pLine1,pLine2,TimeSec
	Elseif (pNumLines=1) Then
		pDMDShowBig pLine1,timeSec, curLine1Color
	Else
		pDMDShowBig pLine1,timeSec, curLine1Color
	End if

	PriorityReset=TimeSec*1000
	End Sub 'pupDMDDisplay message

	Sub pupDMDupdate_Timer()
		pDMDUpdateScores    

		if PriorityReset>0 Then  'for splashes we need to reset current prioirty on timer
		   PriorityReset=PriorityReset-pupDMDUpdate.interval
		   if PriorityReset<=0 Then 
				pDMDCurPriority=-1            
				if pInAttract then pAttractReset=pAttractBetween ' pAttractNext  call attract next after 1 second HP no attractmode
				pDMDVideoPlaying=false
				End if
		End if

		if pAttractReset>0 Then  'for splashes we need to reset current prioirty on timer
		   pAttractReset=pAttractReset-pupDMDUpdate.interval
		   if pAttractReset<=0 Then 
				pAttractReset=-1            
				if pInAttract then pAttractNext
				End if
		end if 
	End Sub

	Sub PuPEvent(EventNum)
	if hasPUP=false then Exit Sub
	PuPlayer.B2SData "E"&EventNum,1  'send event to puppack driver  
	End Sub


	'********************* END OF PUPDMD FRAMEWORK v1.0 *************************
	'******************** DO NOT MODIFY STUFF ABOVE THIS LINE!!!! ***************
	'****************************************************************************
